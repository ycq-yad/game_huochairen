(function () {
    'use strict';

    /*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
    /* global Reflect, Promise */

    var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };

    function __extends(d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    }

    function __awaiter(thisArg, _arguments, P, generator) {
        return new (P || (P = Promise))(function (resolve, reject) {
            function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
            function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
            function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
            step((generator = generator.apply(thisArg, _arguments || [])).next());
        });
    }

    function __generator(thisArg, body) {
        var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
        return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
        function verb(n) { return function (v) { return step([n, v]); }; }
        function step(op) {
            if (f) throw new TypeError("Generator is already executing.");
            while (_) try {
                if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
                if (y = 0, t) op = [op[0] & 2, t.value];
                switch (op[0]) {
                    case 0: case 1: t = op; break;
                    case 4: _.label++; return { value: op[1], done: false };
                    case 5: _.label++; y = op[1]; op = [0]; continue;
                    case 7: op = _.ops.pop(); _.trys.pop(); continue;
                    default:
                        if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                        if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                        if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                        if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                        if (t[2]) _.ops.pop();
                        _.trys.pop(); continue;
                }
                op = body.call(thisArg, _);
            } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
            if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
        }
    }

    var CommonScaleComplenet = (function (_super) {
        __extends(CommonScaleComplenet, _super);
        function CommonScaleComplenet() {
            return _super.call(this) || this;
        }
        return CommonScaleComplenet;
    }(CustomScaleComponent));

    var GameConfig = (function () {
        function GameConfig() {
        }
        GameConfig.init = function () {
            var reg = Laya.ClassUtils.regClass;
            reg("script/common/CommonScaleComplenet.ts", CommonScaleComplenet);
        };
        GameConfig.width = 1080;
        GameConfig.height = 1920;
        GameConfig.scaleMode = "fixedwidth";
        GameConfig.screenMode = "none";
        GameConfig.alignV = "top";
        GameConfig.alignH = "left";
        GameConfig.startScene = "levels/type2/Type2GameScene.scene";
        GameConfig.sceneRoot = "";
        GameConfig.debug = false;
        GameConfig.stat = false;
        GameConfig.physicsDebug = false;
        GameConfig.exportSceneToJson = true;
        return GameConfig;
    }());
    GameConfig.init();

    var GameEvent = (function () {
        function GameEvent() {
        }
        GameEvent.ONHIDE = "ONHIDE";
        GameEvent.ONSHOW = "ONSHOW";
        GameEvent.BUFFER_LOAD = "BUFFER_LOAD";
        GameEvent.TIPS_POINT = "TIPS_POINT";
        GameEvent.REFRESH_TOP = "REFRESH_TOP";
        GameEvent.SHOW_TOP = "SHOW_TOP";
        GameEvent.HIDE_TOP = "HIDE_TOP";
        GameEvent.POWER_REPLY_STATUS = "POWER_REPLY_STATUS";
        GameEvent.REFRESH_FREE_POWER = "REFRESH_FREE_POWER";
        GameEvent.OPEN_BUY_PROP = "OPEN_BUY_PROP";
        GameEvent.OPEN_SCENE = "OPEN_SCENE";
        GameEvent.CHANGE_POS = "CHANGE_POS";
        GameEvent.CHOOSE_MODEL = "CHOOSE_MODEL";
        GameEvent.USE_BRUSH = "USE_BRUSH";
        GameEvent.Type2Select = "Type2Select";
        GameEvent.Type2Restart = "Type2Restart";
        GameEvent.Type2Next = "Type2Next";
        GameEvent.Type2GameOver = "Type2GameOver";
        return GameEvent;
    }());
    window['GameEvent'] = GameEvent;

    var GameBufferLoading = (function (_super) {
        __extends(GameBufferLoading, _super);
        function GameBufferLoading() {
            var _this = _super.call(this) || this;
            _this.className_key = "GameBufferLoading";
            _this.bg_img_res = "game_panel_db_png";
            _this.width = Laya.stage.width;
            _this.height = Laya.stage.height;
            _this.init();
            return _this;
        }
        GameBufferLoading.prototype.init = function () {
            if (!this.bg_img) {
                this.bg_img = new Laya.Image(ResUtil.getIntance().getOriginUrlPath(ResUtil.getIntance().getResInfoByName(this.bg_img_res).url));
                this.bg_img.sizeGrid = "3,3,2,2";
                this.bg_img.width = this.width;
                this.bg_img.height = this.height;
                this.bg_img.alpha = 0.7;
                this.addChild(this.bg_img);
                this.mouseEnabled = true;
                this.bg_img.mouseEnabled = true;
                this.bg_img.mouseThrough = false;
            }
            if (!this.img_circle) {
                this.img_circle = new Laya.Image();
                this.img_circle.skin = "resource/assets/loading/loading_circle.png";
                this.img_circle.anchorX = this.img_circle.anchorY = 0.5;
                this.img_circle.centerX = this.img_circle.centerY = 0;
                this.addChild(this.img_circle);
            }
        };
        GameBufferLoading.prototype.setLabelInfo = function (info) {
        };
        GameBufferLoading.prototype.onShow = function () {
            if (this.img_circle) {
                this.img_circle.rotation = 0;
                Laya.Tween.to(this.img_circle, { rotation: 360 }, 500, null, Laya.Handler.create(this, this.onShow));
            }
        };
        GameBufferLoading.prototype.onHidd = function () {
            if (this.img_circle) {
                Laya.Tween.clearAll(this.img_circle);
            }
        };
        return GameBufferLoading;
    }(Laya.Sprite));

    var SoundManager = (function () {
        function SoundManager() {
            this._musicOpen = true;
            this._soundOpen = true;
        }
        Object.defineProperty(SoundManager, "instance", {
            get: function () {
                if (!SoundManager.ins)
                    SoundManager.ins = new SoundManager();
                return SoundManager.ins;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SoundManager.prototype, "musicOpen", {
            get: function () {
                return this._musicOpen;
            },
            set: function (value) {
                this._musicOpen = value;
                if (value) {
                    this.playBgMusic(this.curBgMusic);
                }
                else {
                    this.stopBgMusic();
                }
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SoundManager.prototype, "soundOpen", {
            get: function () {
                return this._soundOpen;
            },
            set: function (_soundOpen) {
                this._soundOpen = _soundOpen;
            },
            enumerable: true,
            configurable: true
        });
        SoundManager.prototype.playBgMusic = function (soundName) {
            return __awaiter(this, void 0, void 0, function () {
                var _url, _a;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            console.log("开始播放Bgm...", soundName, this.curBgMusic);
                            if (!this._musicOpen)
                                return [2];
                            if (!soundName && !this.curBgMusic)
                                return [2];
                            if (!soundName) return [3, 2];
                            this.curBgMusic = soundName;
                            _url = ResUtil.getIntance().defaultOriginUrl + "resource/assets/sound/" + this.curBgMusic + ".mp3";
                            _a = this;
                            return [4, Laya.SoundManager.playMusic(_url, 0)];
                        case 1:
                            _a.soundChannel = _b.sent();
                            return [3, 3];
                        case 2:
                            if (this.soundChannel)
                                this.soundChannel.resume();
                            _b.label = 3;
                        case 3: return [2];
                    }
                });
            });
        };
        SoundManager.prototype.pauseBgMusic = function () {
            if (this.soundChannel)
                this.soundChannel.pause();
        };
        SoundManager.prototype.stopBgMusic = function () {
            console.log("停止播放Bgm...");
            if (this.soundChannel)
                this.soundChannel.stop();
        };
        SoundManager.prototype.playEffect = function (soundName) {
            if (!this._soundOpen || !soundName)
                return;
            var _url;
            if (DeviceUtil.isNative()) {
                _url = "resource/assets/sound/ogg/" + soundName + ".ogg";
            }
            else {
                _url = "resource/assets/sound/" + soundName + ".mp3";
            }
            Laya.SoundManager.playSound(_url, 1);
        };
        return SoundManager;
    }());
    var SoundConst;
    (function (SoundConst) {
        SoundConst["HomeBgm"] = "";
        SoundConst["BtnClick"] = "button";
        SoundConst["GameBgm2"] = "bg";
        SoundConst["Huaxian"] = "huaxian";
        SoundConst["Win2"] = "win";
    })(SoundConst || (SoundConst = {}));

    var localData;
    (function (localData) {
        var SignData = (function () {
            function SignData() {
            }
            return SignData;
        }());
        localData.SignData = SignData;
        var InviteData = (function () {
            function InviteData() {
            }
            return InviteData;
        }());
        localData.InviteData = InviteData;
        var TipsPointData = (function () {
            function TipsPointData() {
            }
            return TipsPointData;
        }());
        localData.TipsPointData = TipsPointData;
        var FreePowerData = (function () {
            function FreePowerData() {
            }
            return FreePowerData;
        }());
        localData.FreePowerData = FreePowerData;
        var PatternData = (function () {
            function PatternData() {
            }
            return PatternData;
        }());
        localData.PatternData = PatternData;
        var ColorData = (function () {
            function ColorData() {
            }
            return ColorData;
        }());
        localData.ColorData = ColorData;
        var SkinData = (function () {
            function SkinData() {
            }
            return SkinData;
        }());
        localData.SkinData = SkinData;
        var BrushData = (function () {
            function BrushData() {
            }
            return BrushData;
        }());
        localData.BrushData = BrushData;
        var LevelData0 = (function () {
            function LevelData0() {
            }
            return LevelData0;
        }());
        localData.LevelData0 = LevelData0;
        var LevelData2 = (function () {
            function LevelData2() {
            }
            return LevelData2;
        }());
        localData.LevelData2 = LevelData2;
    })(localData || (localData = {}));
    var netData;
    (function (netData) {
        var UserInfos = (function () {
            function UserInfos() {
                this.openId = "";
                this.nick = "";
                this.avatarUrl = "";
                this.sex = 0;
                this.sessionKey = "";
                this.accessToken = "";
            }
            return UserInfos;
        }());
        netData.UserInfos = UserInfos;
        var PlayerData = (function () {
            function PlayerData() {
                this.loginTime = null;
                this.gold = 0;
                this.power = 5;
                this.lastPowerTime = null;
                this.shareVideoCount = 0;
            }
            return PlayerData;
        }());
        netData.PlayerData = PlayerData;
        var SignIn = (function () {
            function SignIn() {
                this.total_count = 0;
                this.timeStamp = null;
            }
            return SignIn;
        }());
        netData.SignIn = SignIn;
        var Invite = (function () {
            function Invite() {
                this.inviteId = [];
            }
            return Invite;
        }());
        netData.Invite = Invite;
        var Inviter = (function () {
            function Inviter() {
            }
            return Inviter;
        }());
        netData.Inviter = Inviter;
        var Color = (function () {
            function Color() {
                this.owns = [1];
                this.using = 1;
            }
            return Color;
        }());
        netData.Color = Color;
        var Skin = (function () {
            function Skin() {
                this.owns = [1];
                this.using = 1;
            }
            return Skin;
        }());
        netData.Skin = Skin;
        var Brush = (function () {
            function Brush() {
                this.owns = [1];
                this.using = 1;
            }
            return Brush;
        }());
        netData.Brush = Brush;
    })(netData || (netData = {}));

    var GameConst = (function () {
        function GameConst() {
        }
        GameConst.BASE_INFO = "BASE_INFO";
        GameConst.SIGN_INFO = "SIGN_INFO";
        GameConst.FREE_INFO = "FREE_INFO";
        GameConst.LEVEL_INFO = "LEVEL_INFO";
        GameConst.COLOR_INFO = "COLOR_INFO";
        GameConst.SKIN_INFO = "SKIN_INFO";
        GameConst.BRUSH_INFO = "BRUSH_INFO";
        return GameConst;
    }());

    var GameData = (function () {
        function GameData() {
            this.URL_DELETE_DATA = "https://littlegame.32yx.com/DelMiniGameData.fcgi";
            this.URL_DELETE_DATA_TEST = "https://172.17.3.217:8090/DelMiniGameData.fcgi";
            this.URL_SAVE_DATA = "https://littlegame.32yx.com/MiniGameData.fcgi";
            this.URL_SAVE_DATA_TEST = "http://172.17.3.217:8090/MiniGameData.fcgi";
            this.URL_OF_RANK = "https://littlegame.32yx.com/MiniGameRank.fcgi";
            this.URL_OF_RANK_TEST = "http://172.17.3.217:8090/MiniGameRank.fcgi";
            this.URL_OF_INVITE = "https://littlegame.32yx.com/Invitation.fcgi";
            this.URL_OF_INVITE_TEST = "http://172.17.3.217:8090/Invitation.fcgi";
            this.URL_TIMESTAMP = "https://littlegame.32yx.com/gettime.php";
            this.URL_WX_REQ = "https://yxtest.32yx.com/MiniGame.fcgi";
            this.URL_WX_REQ_TEST = "http://172.17.3.217:8090/MiniGame.fcgi";
            this.MinigameResUrlRoot = 'https://package.32yx.com/ecy_game_small/laya/firePeople2/';
            this.MinigameResAllUrl = 'https://package.32yx.com/ecy_game_small/laya/firePeople2/';
            this.resVersion = '1_1/';
            this.gameId = "";
            this.videoTips = "视频观看完整才能获得奖励哦";
            this.fullScreenOffSet = 100;
            this.gameVersion = 1001;
            this.isConVersion = false;
            this.strogeVersion = '1001';
            this.isTestVersion = true;
            this.isGetOpenid = true;
            this.ttVideoId = ["9143qof69l9jd53hg1"];
            this.ttBannerId = ["1ona7n89mfb15qklcv"];
            this.modelId = -1;
            this.videoOpen = true;
            this._shakeIsOpen = true;
            this.userInfo = new netData.UserInfos();
            this.playerData = new netData.PlayerData();
            this.signIn = new netData.SignIn();
            this.invite = new netData.Invite();
            this.freePower = {};
            this.level = {
                "103": { passLv: 0, curLv: 1 }
            };
            this.color = new netData.Color();
            this.skin = new netData.Skin();
            this.brush = new netData.Brush();
            this.defaultConfigs = {
                defaultPower: 5,
                rePowerCD: 300,
                rePowerLimit: 5,
                maxPower: 99,
                videoBuyPower: 2,
                videoBuyGold: 200,
                powerBag: 1,
                passGold0: 50,
                passGold1: 50,
                passGold2: 50,
                shareRecordAward: 100,
                skinTryCount: 1,
                unlockCost2: 500,
                starTipSec: 8,
                powerCost: 1
            };
        }
        GameData.getInstance = function () {
            if (!GameData.instance) {
                GameData.instance = new GameData();
            }
            return GameData.instance;
        };
        Object.defineProperty(GameData.prototype, "serverConf", {
            set: function (sc) {
                this.serverConf_ = sc;
                this.initServer();
            },
            enumerable: true,
            configurable: true
        });
        GameData.prototype.initServer = function () {
            switch (GameData.instance.serverConf_) {
                case "nts":
                    this.URL_SAVE_DATA = this.URL_SAVE_DATA_TEST;
                    this.URL_OF_RANK = this.URL_OF_RANK_TEST;
                    this.URL_OF_INVITE = this.URL_OF_INVITE_TEST;
                    this.URL_DELETE_DATA = this.URL_DELETE_DATA_TEST;
                    break;
                case "wts":
                    break;
                case "wzs":
                    break;
            }
        };
        GameData.prototype.initConfig = function (res) {
            GameConst.infos = res;
            GameData.getInstance().modelId = GameConst.infos.model;
            if (DeviceUtil.isMiniGame()) {
                GameData.getInstance().serverConf = GameConst.infos.serverConf;
            }
            else {
                GameData.getInstance().serverConf = "nts";
            }
            if (GameData.getInstance().gameVersion > GameConst.infos.version) {
                GameData.getInstance().isConVersion = true;
            }
            else {
                GameData.getInstance().isConVersion = false;
            }
            GameData.getInstance().isTestVersion = GameData.getInstance().gameVersion == 1;
            if (DeviceUtil.isTTMiniGame()) {
                GameData.getInstance().bannerId = this.ttBannerId;
                GameData.getInstance().videoId = this.ttVideoId;
            }
            else {
                GameData.getInstance().bannerId = GameConst.infos.bannerId;
                GameData.getInstance().videoId = GameConst.infos.videoId;
            }
            GameData.getInstance().longVideoId = GameConst.infos.longVideoId;
            GameData.getInstance().intersId = GameConst.infos.intersId;
            GameData.getInstance().isOpen = GameConst.infos.isOpen;
            GameData.getInstance().strogeVersion = GameConst.infos.strogeVersion;
            GameData.getInstance().adConversion = GameConst.infos.adConversion;
            GameData.getInstance().selectDoule = GameConst.infos.selectDoule;
            GameData.getInstance().videoOpen = GameConst.infos.videoOpen;
            GameData.getInstance().touchByMistake = GameConst.infos.touchByMistake;
        };
        Object.defineProperty(GameData.prototype, "shakeIsOpen", {
            get: function () {
                return this._shakeIsOpen;
            },
            set: function (isOpen) {
                this._shakeIsOpen = isOpen;
            },
            enumerable: true,
            configurable: true
        });
        return GameData;
    }());

    var CommonTool = (function () {
        function CommonTool() {
        }
        CommonTool.errorCodeTable = {
            1: "解析数据异常",
            2: "服务器内部错误",
            3: "数据库处理超时",
            4: "数据插入失败",
            5: "查询操作错误",
            6: "数据库没有该数据",
            7: "数据库数据不存在",
            8: "操作频繁",
            9: "名次传递错误",
            10: "没有rankid",
            11: "没有游戏id",
            12: "没有Session_Id",
            13: "没有Session_Key",
            14: "Session_Id超时",
            15: "Session_Id加密错误",
            16: "Session_Id解密失败",
            17: "Session_Id不匹配",
            18: "token验证失败",
            19: "没有保存Id",
            20: "参数错误",
            21: "没有分数",
            22: "数据更新失败",
            23: "数据删除失败",
            24: "无效的游戏Id",
            25: "无存储信息数据"
        };
        return CommonTool;
    }());

    var GameInfoManager = (function () {
        function GameInfoManager() {
            this.URL = GameData.getInstance().URL_SAVE_DATA;
        }
        GameInfoManager.getInstance = function () {
            if (!GameInfoManager.instance_) {
                GameInfoManager.instance_ = new GameInfoManager();
            }
            return GameInfoManager.instance_;
        };
        GameInfoManager.prototype.getTimeStamp = function (callF) {
            var timeStamp;
            var _url = GameData.getInstance().URL_TIMESTAMP;
            HttpMgr.getInstance().sendHttp(_url, null, function (e) {
                timeStamp = e * 1000;
                console.log("获取当前时间戳成功 ->", timeStamp);
                if (callF)
                    callF(timeStamp);
            }, function (e) { });
        };
        GameInfoManager.prototype.selectInfo = function (key, isUseNet) {
            var _this = this;
            if (isUseNet === void 0) { isUseNet = false; }
            return new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {
                var data, onlykey, str;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (!isUseNet) return [3, 2];
                            return [4, this.selectInfoByNet(key)];
                        case 1:
                            data = _a.sent();
                            return [3, 3];
                        case 2:
                            onlykey = key + "_" + GameData.getInstance().userInfo.openId;
                            str = Laya.LocalStorage.getItem(onlykey);
                            if (str) {
                                data = this.decodeData(str, key);
                                console.log("\u67E5\u8BE2\u952E\u4E3A " + key + " \u7684\u6570\u636E\u6210\u529F ->", data);
                            }
                            _a.label = 3;
                        case 3:
                            resolve(data);
                            return [2];
                    }
                });
            }); });
        };
        GameInfoManager.prototype.selectInfoByNet = function (key, callF, isLoading) {
            var _this = this;
            return new Promise(function (resolve, reject) {
                var gameId = GameData.getInstance().gameId;
                var openId = GameData.getInstance().userInfo.openId + "_" + key;
                var msg = {
                    msg_type: "6",
                    msg_data: {
                        gameid: gameId,
                        saveid: openId
                    }
                };
                HttpMgr.getInstance().sendHttp(_this.URL, msg, function (e) {
                    var code = e.msg_data.error_code;
                    var data;
                    if (code == "0") {
                        console.log("\u67E5\u8BE2\u952E\u4E3A " + key + " \u7684\u6570\u636E\u6210\u529F ->", e.msg_data);
                        data = _this.decodeData(e.msg_data.saveinfo, key);
                    }
                    else {
                        var str = CommonTool.errorCodeTable[code];
                        console.warn("\u67E5\u8BE2\u952E\u4E3A " + key + " \u7684\u6570\u636E\u5931\u8D25:" + str);
                    }
                    if (callF) {
                        var obj = { code: code, key: key };
                        callF(obj);
                    }
                    resolve(data);
                }, function (e) { resolve(null); });
            });
        };
        GameInfoManager.prototype.saveInfo = function (key, isUseNet) {
            if (isUseNet === void 0) { isUseNet = false; }
            if (isUseNet) {
                this.saveInfoToNet(key);
            }
            else {
                var str = this.encodeData(key);
                var onlykey = key + "_" + GameData.getInstance().userInfo.openId;
                Laya.LocalStorage.setItem(onlykey, str);
                if (key != GameConst.BASE_INFO) {
                    console.log("\u4FDD\u5B58\u952E\u4E3A " + key + " \u7684\u6570\u636E\u6210\u529F ->");
                }
            }
        };
        GameInfoManager.prototype.saveInfoToNet = function (key, callF) {
            return __awaiter(this, void 0, void 0, function () {
                var _this = this;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, new Promise(function (res, rej) {
                                var str = _this.encodeData(key);
                                var gameId = GameData.getInstance().gameId;
                                var openId = GameData.getInstance().userInfo.openId + "_" + key;
                                var msg = {
                                    msg_type: "8",
                                    msg_data: {
                                        "gameid": gameId,
                                        "saveid": openId,
                                        "saveinfo": str
                                    }
                                };
                                HttpMgr.getInstance().sendHttp(_this.URL, msg, function (e) {
                                    var code = e.msg_data.error_code;
                                    if (code == "0") {
                                        console.log("\u4FDD\u5B58\u952E\u4E3A " + key + " \u7684\u6570\u636E\u6210\u529F ->", e.msg_data);
                                    }
                                    else {
                                        var str_1 = CommonTool.errorCodeTable[code];
                                        console.warn("\u4FDD\u5B58\u952E\u4E3A " + key + " \u7684\u6570\u636E\u5931\u8D25\uFF1A" + str_1);
                                    }
                                    if (callF) {
                                        var obj = { code: code, key: key };
                                        callF(obj);
                                    }
                                    res();
                                }, function (e) { res(); });
                            })];
                        case 1:
                            _a.sent();
                            return [2];
                    }
                });
            });
        };
        GameInfoManager.prototype.selectAllGameInfo = function (canUseNet) {
            var _this = this;
            if (canUseNet === void 0) { canUseNet = false; }
            return new Promise(function (res) { return __awaiter(_this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (!canUseNet) return [3, 8];
                            return [4, this.selectSingleInfo(GameConst.BASE_INFO, false)];
                        case 1:
                            _a.sent();
                            return [4, this.selectSingleInfo(GameConst.SIGN_INFO, false)];
                        case 2:
                            _a.sent();
                            return [4, this.selectSingleInfo(GameConst.FREE_INFO, false)];
                        case 3:
                            _a.sent();
                            return [4, this.selectSingleInfo(GameConst.LEVEL_INFO, false)];
                        case 4:
                            _a.sent();
                            return [4, this.selectSingleInfo(GameConst.COLOR_INFO, false)];
                        case 5:
                            _a.sent();
                            return [4, this.selectSingleInfo(GameConst.SKIN_INFO, false)];
                        case 6:
                            _a.sent();
                            return [4, this.selectSingleInfo(GameConst.BRUSH_INFO, false)];
                        case 7:
                            _a.sent();
                            return [3, 16];
                        case 8: return [4, this.selectInfo(GameConst.BASE_INFO)];
                        case 9:
                            _a.sent();
                            return [4, this.selectInfo(GameConst.SIGN_INFO)];
                        case 10:
                            _a.sent();
                            return [4, this.selectInfo(GameConst.FREE_INFO)];
                        case 11:
                            _a.sent();
                            return [4, this.selectInfo(GameConst.LEVEL_INFO)];
                        case 12:
                            _a.sent();
                            return [4, this.selectInfo(GameConst.COLOR_INFO)];
                        case 13:
                            _a.sent();
                            return [4, this.selectInfo(GameConst.SKIN_INFO)];
                        case 14:
                            _a.sent();
                            return [4, this.selectInfo(GameConst.BRUSH_INFO)];
                        case 15:
                            _a.sent();
                            _a.label = 16;
                        case 16:
                            res();
                            return [2];
                    }
                });
            }); });
        };
        GameInfoManager.prototype.selectSingleInfo = function (key, isLoading) {
            var _this = this;
            if (isLoading === void 0) { isLoading = true; }
            return new Promise(function (res) {
                _this.selectInfoByNet(key, function (obj) {
                    if (obj.code == "0") {
                        res(obj.code);
                    }
                    else if (obj.code == "6" || obj.code == "25") {
                        _this.saveInfoToNet(key, function (obj1) {
                            if (obj1.code != "0") {
                                var str = CommonTool.errorCodeTable[obj1.code];
                            }
                            res(obj1.code);
                        });
                    }
                    else {
                        var str = CommonTool.errorCodeTable[obj.code];
                        res(obj.code);
                    }
                }, isLoading);
            });
        };
        GameInfoManager.prototype.deleteData = function () {
            return __awaiter(this, void 0, void 0, function () {
                var i, msg_data;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            i = 1;
                            _a.label = 1;
                        case 1:
                            if (!(i <= 3)) return [3, 4];
                            msg_data = {
                                "msg_type": "18",
                                "msg_data": {
                                    "gameid": GameData.getInstance().gameId,
                                    "datatype": i + ""
                                }
                            };
                            return [4, HttpMgr.getInstance().sendHttp(GameData.getInstance().URL_DELETE_DATA, msg_data, function () {
                                    console.log("清理数据成功...");
                                })];
                        case 2:
                            _a.sent();
                            _a.label = 3;
                        case 3:
                            i++;
                            return [3, 1];
                        case 4: return [2];
                    }
                });
            });
        };
        GameInfoManager.prototype.decodeData = function (data, key) {
            var obj = JSON.parse(data);
            if (obj) {
                switch (key) {
                    case GameConst.BASE_INFO:
                        GameData.getInstance().playerData = obj;
                        break;
                    case GameConst.SIGN_INFO:
                        GameData.getInstance().signIn = obj;
                        break;
                    case GameConst.FREE_INFO:
                        GameData.getInstance().freePower = obj;
                        break;
                    case GameConst.LEVEL_INFO:
                        GameData.getInstance().level = obj;
                        break;
                    case GameConst.COLOR_INFO:
                        GameData.getInstance().color = obj;
                        break;
                    case GameConst.SKIN_INFO:
                        GameData.getInstance().skin = obj;
                        break;
                    case GameConst.BRUSH_INFO:
                        GameData.getInstance().brush = obj;
                        break;
                }
            }
            return obj;
        };
        GameInfoManager.prototype.encodeData = function (key) {
            var obj;
            switch (key) {
                case GameConst.BASE_INFO:
                    obj = GameData.getInstance().playerData;
                    break;
                case GameConst.SIGN_INFO:
                    obj = GameData.getInstance().signIn;
                    break;
                case GameConst.FREE_INFO:
                    obj = GameData.getInstance().freePower;
                    break;
                case GameConst.LEVEL_INFO:
                    obj = GameData.getInstance().level;
                    break;
                case GameConst.COLOR_INFO:
                    obj = GameData.getInstance().color;
                    break;
                case GameConst.SKIN_INFO:
                    obj = GameData.getInstance().skin;
                    break;
                case GameConst.BRUSH_INFO:
                    obj = GameData.getInstance().brush;
                    break;
            }
            if (key != GameConst.BASE_INFO) {
                console.log("\u7F16\u8BD1\u952E\u4E3A " + key + " \u7684\u6570\u636E ->", obj);
            }
            var str = JSON.stringify(obj);
            return str;
        };
        GameInfoManager.prototype.selectLevelDataById = function (level) {
            var onlykey = "Level_" + level + "_" + GameData.getInstance().userInfo.openId;
            var str = Laya.LocalStorage.getItem(onlykey);
            if (str) {
                return JSON.parse(str);
            }
            else {
                return null;
            }
        };
        GameInfoManager.prototype.saveLevelDataById = function (level, arr) {
            var onlykey = "Level_" + level + "_" + GameData.getInstance().userInfo.openId;
            var str = JSON.stringify(arr);
            Laya.LocalStorage.setItem(onlykey, str);
            console.log("\u4FDD\u5B58\u6210\u529F" + level);
        };
        return GameInfoManager;
    }());

    var MiniManeger = (function () {
        function MiniManeger() {
            this.hideTime = 0;
            this.showTime = 0;
            this.defaultMssage = {};
            this.shareInfo = [];
            this.sucTime = 0;
            this.canShowBanner = true;
            this.maxMakeVideoTime = 120;
            this.isAutoStopShare = false;
            this.startTime = 0;
            this.moreGamesIsShow = false;
        }
        Object.defineProperty(MiniManeger, "instance", {
            get: function () {
                return MiniManeger.ins;
            },
            enumerable: true,
            configurable: true
        });
        MiniManeger.prototype.initMiniGame = function () {
        };
        MiniManeger.prototype.loginGame = function () {
            return __awaiter(this, void 0, void 0, function () { return __generator(this, function (_a) {
                return [2];
            }); });
        };
        MiniManeger.prototype.login = function () {
            return __awaiter(this, void 0, void 0, function () { return __generator(this, function (_a) {
                return [2];
            }); });
        };
        MiniManeger.prototype.getToken = function () {
            return __awaiter(this, void 0, void 0, function () { return __generator(this, function (_a) {
                return [2];
            }); });
        };
        MiniManeger.prototype.getUserInfo = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    return [2];
                });
            });
        };
        MiniManeger.prototype.initUserInfo = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    return [2];
                });
            });
        };
        MiniManeger.prototype.userButtonSize = function (percentTop, pectendSize, percentLeft) {
        };
        MiniManeger.prototype.createUserButton = function (style, isFullScene) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    return [2];
                });
            });
        };
        MiniManeger.prototype.onShow = function (callBack) {
        };
        MiniManeger.prototype.onHide = function (callBack) {
        };
        MiniManeger.prototype.onAudioInterruptionBegin = function (callBack) {
        };
        MiniManeger.prototype.onAudioInterruptionEnd = function (callBack) {
        };
        MiniManeger.prototype.getUpdateManager = function () {
        };
        MiniManeger.prototype.getShareInfo = function (query) {
        };
        MiniManeger.prototype.shareAppMessage = function (data) {
        };
        MiniManeger.prototype.showMoreGame = function (data) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    return [2];
                });
            });
        };
        MiniManeger.prototype.playViderAd = function (data) {
        };
        MiniManeger.prototype.createBanner = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    return [2];
                });
            });
        };
        MiniManeger.prototype.showBannerAdSp = function () {
        };
        MiniManeger.prototype.showBannerAd = function (offset) {
        };
        MiniManeger.prototype.hideBanner = function () {
        };
        MiniManeger.prototype.showInsertAd = function (data) { };
        MiniManeger.prototype.vibrateShort = function (data) {
        };
        MiniManeger.prototype.vibrateLong = function () {
        };
        MiniManeger.prototype.adaptImgToClientRect = function (collec_img, stage) {
        };
        MiniManeger.prototype.sendDataToWxOpen = function (data) {
        };
        MiniManeger.prototype.removeOpenData = function (data) {
        };
        MiniManeger.prototype.addOpenWxData = function (data) {
        };
        MiniManeger.prototype.makeVideo = function () {
        };
        MiniManeger.prototype.loopTime = function () {
        };
        MiniManeger.prototype.startGameRecord = function () {
        };
        MiniManeger.prototype.stopGameRecord = function () {
        };
        MiniManeger.prototype.pauseGameRecord = function () {
        };
        MiniManeger.prototype.resumeGameRecord = function () {
        };
        MiniManeger.prototype.shareGameVideo = function (data) {
        };
        MiniManeger.prototype.initGameRecordListener = function (callBack) {
        };
        MiniManeger.prototype.showMoreGamesModal = function (data) {
        };
        MiniManeger.prototype.appName = function () {
            var self = this;
            if (!self.systemInfo) {
                self.systemInfo = platform.getSystemInfoSync();
            }
            return self.systemInfo.appName;
        };
        return MiniManeger;
    }());

    var ConfigManager = (function () {
        function ConfigManager() {
            this.randomVersion = "";
            this.URL = "resource/assets/configs/";
            if (!DeviceUtil.isNative()) {
                this.randomVersion = "?v=" + new Date().getTime();
            }
        }
        Object.defineProperty(ConfigManager, "instance", {
            get: function () {
                if (!ConfigManager.ins)
                    ConfigManager.ins = new ConfigManager();
                return ConfigManager.ins;
            },
            enumerable: true,
            configurable: true
        });
        ConfigManager.prototype.getSignConfig = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _a;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            if (!!this.signConfig) return [3, 2];
                            _a = this;
                            return [4, this.loadCongigs(this.URL + "SignConfig.json")];
                        case 1:
                            _a.signConfig = (_b.sent());
                            _b.label = 2;
                        case 2: return [2, this.signConfig];
                    }
                });
            });
        };
        ConfigManager.prototype.getFreePowerConfig = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _a;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            if (!!this.freePowerConfig) return [3, 2];
                            _a = this;
                            return [4, this.loadCongigs(this.URL + "FreePowerConfig.json")];
                        case 1:
                            _a.freePowerConfig = (_b.sent());
                            _b.label = 2;
                        case 2: return [2, this.freePowerConfig];
                    }
                });
            });
        };
        ConfigManager.prototype.getPatternConfig = function () {
            return __awaiter(this, void 0, void 0, function () {
                var configs;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (!!this.patternConfig) return [3, 2];
                            return [4, this.loadCongigs(this.URL + "PatternConfig.json")];
                        case 1:
                            configs = (_a.sent());
                            configs.sort(function (a, b) {
                                return a.sort - b.sort;
                            });
                            this.patternConfig = this.arrToObjById(configs);
                            _a.label = 2;
                        case 2: return [2, this.patternConfig];
                    }
                });
            });
        };
        ConfigManager.prototype.getColorConfig = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _a, _b;
                return __generator(this, function (_c) {
                    switch (_c.label) {
                        case 0:
                            if (!!this.colorConfig) return [3, 2];
                            _a = this;
                            _b = this.arrToObjById;
                            return [4, this.loadCongigs(this.URL + "ColorConfig.json")];
                        case 1:
                            _a.colorConfig = _b.apply(this, [_c.sent()]);
                            _c.label = 2;
                        case 2: return [2, this.colorConfig];
                    }
                });
            });
        };
        ConfigManager.prototype.getColorPriceConfig = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _a, _b;
                return __generator(this, function (_c) {
                    switch (_c.label) {
                        case 0:
                            if (!!this.colorPriceConfig) return [3, 2];
                            _a = this;
                            _b = this.arrToObjById;
                            return [4, this.loadCongigs(this.URL + "ColorPriceConfig.json")];
                        case 1:
                            _a.colorPriceConfig = _b.apply(this, [_c.sent()]);
                            _c.label = 2;
                        case 2: return [2, this.colorPriceConfig];
                    }
                });
            });
        };
        ConfigManager.prototype.getVideoColorConfig = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _a, _b;
                return __generator(this, function (_c) {
                    switch (_c.label) {
                        case 0:
                            if (!!this.videoColorConfig) return [3, 2];
                            _a = this;
                            _b = this.arrToObjById;
                            return [4, this.loadCongigs(this.URL + "VideoColorConfig.json")];
                        case 1:
                            _a.videoColorConfig = _b.apply(this, [_c.sent()]);
                            _c.label = 2;
                        case 2: return [2, this.videoColorConfig];
                    }
                });
            });
        };
        ConfigManager.prototype.getSkinConfig = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _a, _b;
                return __generator(this, function (_c) {
                    switch (_c.label) {
                        case 0:
                            if (!!this.skinConfig) return [3, 2];
                            _a = this;
                            _b = this.arrToObjById;
                            return [4, this.loadCongigs(this.URL + "SkinConfig.json")];
                        case 1:
                            _a.skinConfig = _b.apply(this, [_c.sent()]);
                            _c.label = 2;
                        case 2: return [2, this.skinConfig];
                    }
                });
            });
        };
        ConfigManager.prototype.getBrushConfig = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _a, _b;
                return __generator(this, function (_c) {
                    switch (_c.label) {
                        case 0:
                            if (!!this.brushConfig) return [3, 2];
                            _a = this;
                            _b = this.arrToObjById;
                            return [4, this.loadCongigs(this.URL + "BrushConfig.json")];
                        case 1:
                            _a.brushConfig = _b.apply(this, [_c.sent()]);
                            _c.label = 2;
                        case 2: return [2, this.brushConfig];
                    }
                });
            });
        };
        ConfigManager.prototype.getAniConf = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _a;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            if (!!this.aniConf) return [3, 2];
                            _a = this;
                            return [4, this.loadCongigs(this.URL + "game/type1/" + "aniConf.json")];
                        case 1:
                            _a.aniConf = _b.sent();
                            _b.label = 2;
                        case 2: return [2, this.aniConf];
                    }
                });
            });
        };
        ConfigManager.prototype.getLevelConf = function (level) {
            return __awaiter(this, void 0, void 0, function () {
                var _a;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            _a = this;
                            return [4, this.loadCongigs(this.URL + "game/type1/" + "level" + level + ".json")];
                        case 1:
                            _a.levelConf = _b.sent();
                            return [2, this.levelConf];
                    }
                });
            });
        };
        ConfigManager.prototype.getLevelConf2 = function (level) {
            return __awaiter(this, void 0, void 0, function () {
                var _a;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            _a = this;
                            return [4, this.loadCongigs(this.URL + "game/type2/" + "level" + level + ".json")];
                        case 1:
                            _a.levelConf2 = _b.sent();
                            return [2, this.levelConf2];
                    }
                });
            });
        };
        ConfigManager.prototype.initConfigs = function () {
            var _this = this;
            return new Promise(function (resolve) { return __awaiter(_this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.initConfig()];
                        case 1:
                            _a.sent();
                            resolve();
                            return [2];
                    }
                });
            }); });
        };
        ConfigManager.prototype.initConfig = function () {
            return __awaiter(this, void 0, void 0, function () {
                var conf;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.loadCongigs("configs/configs.json")];
                        case 1:
                            conf = _a.sent();
                            GameData.getInstance().defaultConfigs = conf.gameConf;
                            MiniManeger.instance.shareInfo = conf.shareInfo;
                            return [2];
                    }
                });
            });
        };
        ConfigManager.prototype.loadCongigs = function (url) {
            var _this = this;
            return new Promise(function (resolve) {
                var jsonUrl = url;
                Laya.loader.load(jsonUrl + _this.randomVersion, Laya.Handler.create(_this, function (res) {
                    resolve(Utils.copy(res));
                }));
            });
        };
        ConfigManager.prototype.arrToObjById = function (arr) {
            var obj = {};
            if (arr == null)
                return obj;
            for (var i = 0, len = arr.length; i < len; i++) {
                if (arr[i].id) {
                    obj[arr[i].id] = arr[i];
                }
                else if (arr[i].ID) {
                    obj[arr[i].ID] = arr[i];
                }
                else if (arr[i].itemid) {
                    obj[arr[i].itemid] = arr[i];
                }
            }
            return obj;
        };
        return ConfigManager;
    }());

    var SignManager = (function () {
        function SignManager() {
        }
        Object.defineProperty(SignManager, "instance", {
            get: function () {
                if (SignManager.ins == null) {
                    SignManager.ins = new SignManager();
                }
                return SignManager.ins;
            },
            enumerable: true,
            configurable: true
        });
        SignManager.prototype.getSignDataUglify = function () {
            return __awaiter(this, void 0, void 0, function () {
                var signConfig, signIn, curCanSign, len, dataArr, i, sign, canSign, signed, data;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, ConfigManager.instance.getSignConfig()];
                        case 1:
                            signConfig = _a.sent();
                            signIn = GameData.getInstance().signIn;
                            curCanSign = this.checkSign();
                            len = signConfig.length;
                            if (curCanSign) {
                                if (signIn.total_count >= len) {
                                    signIn.total_count = 0;
                                }
                                GameData.getInstance().signIn = signIn;
                            }
                            dataArr = [];
                            for (i = 0; i < len; i++) {
                                sign = signConfig[i];
                                canSign = false;
                                signed = false;
                                if (i == signIn.total_count && curCanSign)
                                    canSign = true;
                                if (i < signIn.total_count)
                                    signed = true;
                                data = new localData.SignData();
                                data.id = sign.id;
                                data.name = sign.name;
                                data.reward = sign.reward;
                                data.canSign = canSign;
                                data.isSigned = signed;
                                dataArr.push(data);
                            }
                            return [2, dataArr];
                    }
                });
            });
        };
        SignManager.prototype.checkSign = function () {
            var signIn = GameData.getInstance().signIn;
            var lastTime = signIn.timeStamp;
            var currTime = (new Date()).getTime();
            var isOneDay = Utils.judgeIsOnTheSameDay(lastTime, currTime);
            return !isOneDay;
        };
        SignManager.prototype.updateSignDay = function () {
            GameData.getInstance().signIn.timeStamp += 24 * 3600 * 1000;
            GameInfoManager.getInstance().saveInfo(GameConst.SIGN_INFO);
        };
        return SignManager;
    }());
    window["SignManager"] = SignManager;

    var PatternMgr = (function () {
        function PatternMgr() {
        }
        Object.defineProperty(PatternMgr, "instance", {
            get: function () {
                if (!PatternMgr.ins)
                    PatternMgr.ins = new PatternMgr();
                return PatternMgr.ins;
            },
            enumerable: true,
            configurable: true
        });
        PatternMgr.prototype.getLevelData2Uglify = function () {
            return __awaiter(this, void 0, void 0, function () {
                var configs, config, netData, dataArr, i, data;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, ConfigManager.instance.getPatternConfig()];
                        case 1:
                            configs = _a.sent();
                            config = configs["103"];
                            netData = GameData.getInstance().level["103"];
                            dataArr = [];
                            for (i = 0; i < config.maxnum; i++) {
                                data = new localData.LevelData2();
                                data.id = i + 1;
                                data.unlock = data.id <= netData.curLv;
                                data.isCur = data.id == netData.passLv + 1;
                                dataArr.push(data);
                            }
                            return [2, dataArr];
                    }
                });
            });
        };
        PatternMgr.prototype.getPatternConfBySort = function (sort) {
            return __awaiter(this, void 0, void 0, function () {
                var configs, key, element;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, ConfigManager.instance.getPatternConfig()];
                        case 1:
                            configs = _a.sent();
                            for (key in configs) {
                                element = configs[key];
                                if (element.sort == sort) {
                                    return [2, element];
                                }
                            }
                            return [2];
                    }
                });
            });
        };
        PatternMgr.prototype.getTotLevelUglify = function () {
            var data = GameData.getInstance().level;
            var num = 0;
            for (var key in data) {
                if (data[key].passLv)
                    num += data[key].passLv;
            }
            return num;
        };
        PatternMgr.prototype.unlockPatternUglify = function (curPattern, curLv) {
            return __awaiter(this, void 0, void 0, function () {
                var configs, config, nextP, pattern;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, ConfigManager.instance.getPatternConfig()];
                        case 1:
                            configs = _a.sent();
                            config = configs[curPattern];
                            if (curLv < config.openLN)
                                return [2];
                            return [4, this.getPatternConfBySort(config.sort + 1)];
                        case 2:
                            nextP = _a.sent();
                            if (!nextP)
                                return [2];
                            pattern = nextP.ID;
                            if (GameData.getInstance().level[pattern])
                                return [2];
                            switch (pattern) {
                                case 101:
                                    GameData.getInstance().level[pattern] = { passLv: 0, curLv: 1 };
                                    break;
                                case 102:
                                    GameData.getInstance().level[pattern] = { passLv: 0, curLv: 1, lv: { 1: { star: 0 } } };
                                    break;
                                case 103:
                                    GameData.getInstance().level[pattern] = { passLv: 0, curLv: 1 };
                                    break;
                            }
                            return [2];
                    }
                });
            });
        };
        PatternMgr.prototype.updateLevelUglify = function (data) {
            return __awaiter(this, void 0, void 0, function () {
                var configs, config, next, pa1, pa2;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, ConfigManager.instance.getPatternConfig()];
                        case 1:
                            configs = _a.sent();
                            config = configs[data.pattern];
                            next = data.curLv + 1;
                            if (next > config.maxnum) {
                                next = config.maxnum;
                            }
                            switch (data.pattern) {
                                case 101:
                                case 103:
                                    pa1 = GameData.getInstance().level[data.pattern];
                                    if (data.curLv > pa1.passLv)
                                        GameData.getInstance().level[data.pattern] = { passLv: data.curLv, curLv: next };
                                    break;
                                case 102:
                                    pa2 = GameData.getInstance().level[data.pattern];
                                    pa2.passLv = data.curLv;
                                    pa2.curLv = next;
                                    if (pa2.lv[data.curLv]) {
                                        if (data.star > pa2.lv[data.curLv].star)
                                            pa2.lv[data.curLv].star = data.star;
                                    }
                                    else {
                                        pa2.lv[data.curLv] = { star: data.star };
                                    }
                                    if (!pa2.lv[next])
                                        pa2.lv[next] = { star: 0 };
                                    GameData.getInstance().level[data.pattern] = pa2;
                                    break;
                            }
                            return [4, this.unlockPatternUglify(data.pattern, data.curLv)];
                        case 2:
                            _a.sent();
                            GameInfoManager.getInstance().saveInfo(GameConst.LEVEL_INFO);
                            return [2, next];
                    }
                });
            });
        };
        return PatternMgr;
    }());
    window['PatternMgr'] = PatternMgr;

    var PowerMgr = (function () {
        function PowerMgr() {
            this.powerLimit = GameData.getInstance().defaultConfigs.rePowerLimit;
            this.powerRestoreTime = GameData.getInstance().defaultConfigs.rePowerCD * 1000;
        }
        Object.defineProperty(PowerMgr, "instance", {
            get: function () {
                if (!PowerMgr.ins)
                    PowerMgr.ins = new PowerMgr();
                return PowerMgr.ins;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(PowerMgr.prototype, "power", {
            get: function () {
                return GameData.getInstance().playerData.power;
            },
            set: function (num) {
                GameData.getInstance().playerData.power = num;
                if (GameData.getInstance().playerData.power > GameData.getInstance().defaultConfigs.maxPower) {
                    GameData.getInstance().playerData.power = GameData.getInstance().defaultConfigs.maxPower;
                }
            },
            enumerable: true,
            configurable: true
        });
        PowerMgr.prototype.spaceTimeRestorePowerUglify = function () {
            var showTime = 0;
            if (this.power >= this.powerLimit) {
                return showTime;
            }
            else {
                var powerTime = GameData.getInstance().playerData.lastPowerTime;
                if (powerTime != null && powerTime != 0) {
                    var nowTime = new Date().getTime();
                    var disTime = nowTime - powerTime;
                    if (disTime >= 0) {
                        var count = Math.floor(disTime / this.powerRestoreTime);
                        var diffTime = disTime % this.powerRestoreTime;
                        if (count > 0) {
                            this.power += count;
                        }
                        if (this.power >= this.powerLimit) {
                            console.warn("体力达自然恢复上限！");
                            GameData.getInstance().playerData.lastPowerTime = 0;
                        }
                        else {
                            showTime = this.powerRestoreTime - diffTime;
                        }
                    }
                }
                else {
                    showTime = this.powerRestoreTime;
                    GameData.getInstance().playerData.lastPowerTime = new Date().getTime();
                }
                GameInfoManager.getInstance().saveInfo(GameConst.BASE_INFO);
                return showTime;
            }
        };
        PowerMgr.prototype.changePowerUglify = function (data) {
            var count = data.count;
            var isNatural = data.isNatural;
            if (count < 0) {
                if (this.power + count < 0) {
                    EventMgr.getInstance().sendEvent(GameEvent.OPEN_BUY_PROP, { type: 1 });
                    return;
                }
                else {
                    data.success && data.success();
                    if (this.power < this.powerLimit) {
                        this.power += count;
                    }
                    else {
                        if (this.power + count < this.powerLimit) {
                            console.warn("开始自然恢复");
                            this.power += count;
                            GameData.getInstance().playerData.lastPowerTime = new Date().getTime();
                            EventMgr.getInstance().sendEvent(GameEvent.POWER_REPLY_STATUS, 2);
                        }
                        else {
                            this.power += count;
                        }
                    }
                }
            }
            else {
                this.power += count;
                if (this.power >= this.powerLimit) {
                    console.warn("体力达自然恢复上限！");
                    GameData.getInstance().playerData.lastPowerTime = 0;
                    EventMgr.getInstance().sendEvent(GameEvent.POWER_REPLY_STATUS, 1);
                }
                else {
                    if (isNatural) {
                        GameData.getInstance().playerData.lastPowerTime = new Date().getTime();
                    }
                }
            }
            EventMgr.getInstance().sendEvent(GameEvent.REFRESH_TOP);
            GameInfoManager.getInstance().saveInfo(GameConst.BASE_INFO);
        };
        PowerMgr.prototype.checkPowerIsOrNotEnoughUglify = function (value) {
            var isEnough = value <= this.power ? true : false;
            return isEnough;
        };
        PowerMgr.prototype.getFreePowerDataUglify = function () {
            return __awaiter(this, void 0, void 0, function () {
                var configs, netData, dataArr, totLv, i, len, element, data;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, ConfigManager.instance.getFreePowerConfig()];
                        case 1:
                            configs = _a.sent();
                            netData = GameData.getInstance().freePower;
                            dataArr = [];
                            totLv = PatternMgr.instance.getTotLevelUglify();
                            for (i = 0, len = configs.length; i < len; i++) {
                                element = configs[i];
                                data = new localData.FreePowerData();
                                data.id = element.id;
                                data.name = element.name;
                                data.rewardNum = element.reward;
                                data.icon = element.icon;
                                data.param = element.param;
                                data.isGeted = !!netData[data.id];
                                if (data.id == 1) {
                                    data.canGet = !SignManager.instance.checkSign();
                                }
                                else {
                                    data.canGet = totLv >= element.param;
                                }
                                dataArr.push(data);
                            }
                            return [2, dataArr];
                    }
                });
            });
        };
        return PowerMgr;
    }());

    var TopBar = (function (_super) {
        __extends(TopBar, _super);
        function TopBar() {
            var _this = _super.call(this) || this;
            _this.className_key = "TopBar";
            _this.name = "TopBar";
            _this.skin = "skins/uiView/TopBar.json";
            return _this;
        }
        TopBar.prototype.adaptationStage = function () {
            this.size(580, 77);
        };
        TopBar.prototype.onAddStage = function () {
            _super.prototype.onAddStage.call(this);
            if (this.isCreate) {
                this.initView();
                this.addEvent();
            }
        };
        TopBar.prototype.addEvent = function () {
            this.btn_power.on(Laya.Event.CLICK, this, this.onPower);
            this.btn_gold.on(Laya.Event.CLICK, this, this.onGold);
            EventMgr.getInstance().addEvent(GameEvent.REFRESH_TOP, this, this.refresh);
            EventMgr.getInstance().addEvent(GameEvent.POWER_REPLY_STATUS, this, this.updataShow);
            EventMgr.getInstance().addEvent(GameEvent.ONSHOW, this, this.updatePower);
        };
        TopBar.prototype.initView = function () {
            this.pos(30, 30);
            if (DeviceUtil.getIsIphoneX())
                this.y += GameData.getInstance().fullScreenOffSet;
            this.updatePower();
            this.refresh();
        };
        TopBar.prototype.refresh = function () {
            this.lab_power.text = PowerMgr.instance.power + "/" + GameData.getInstance().defaultConfigs.rePowerLimit;
            this.lab_gold.text = GameData.getInstance().playerData.gold + "";
        };
        TopBar.prototype.updatePower = function () {
            var surTime = PowerMgr.instance.spaceTimeRestorePowerUglify();
            this.surplusTime = Math.floor(surTime / 1000);
            console.log("updatePower", this.surplusTime);
            if (this.surplusTime) {
                this.lab_time.text = Utils.formatTime(this.surplusTime);
                this.downTime();
            }
            else {
                Laya.timer.clearAll(this);
                this.lab_time.text = "";
            }
        };
        TopBar.prototype.downTime = function () {
            var _this = this;
            Laya.timer.clearAll(this);
            Laya.timer.loop(1000, this, function () {
                _this.surplusTime--;
                if (_this.surplusTime) {
                    _this.lab_time.text = Utils.formatTime(_this.surplusTime);
                }
                else {
                    _this.lab_time.text = "";
                    Laya.timer.clearAll(_this);
                    PowerMgr.instance.changePowerUglify({ count: 1, isNatural: true });
                    _this.updatePower();
                }
            });
        };
        TopBar.prototype.updataShow = function (type) {
            if (type == 1) {
                this.lab_time.text = "";
                Laya.timer.clearAll(this);
            }
            else {
                this.updatePower();
            }
        };
        TopBar.prototype.onPower = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            EventMgr.getInstance().sendEvent(GameEvent.OPEN_BUY_PROP, { type: 1 });
        };
        TopBar.prototype.onGold = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            EventMgr.getInstance().sendEvent(GameEvent.OPEN_BUY_PROP, { type: 2 });
        };
        TopBar.prototype.removeEvent = function () {
            this.btn_power.off(Laya.Event.CLICK, this, this.onPower);
            this.btn_gold.off(Laya.Event.CLICK, this, this.onGold);
            EventMgr.getInstance().removeEvent(GameEvent.REFRESH_TOP, this, this.refresh);
            EventMgr.getInstance().removeEvent(GameEvent.POWER_REPLY_STATUS, this, this.updataShow);
            EventMgr.getInstance().removeEvent(GameEvent.ONSHOW, this, this.updatePower);
        };
        TopBar.prototype.onRemoved = function () {
            _super.prototype.onRemoved.call(this);
            this.removeEvent();
        };
        return TopBar;
    }(BaseSceneUISkin));

    var PopManager = (function () {
        function PopManager() {
            this.isPoping = false;
            this.popArray = [];
        }
        Object.defineProperty(PopManager, "instance", {
            get: function () {
                if (!this.ins) {
                    this.ins = new PopManager();
                }
                return this.ins;
            },
            enumerable: true,
            configurable: true
        });
        PopManager.prototype.showPopView = function (data) {
            if (data != null) {
                this.popArray.push(data);
            }
            if (this.isPoping) {
                return;
            }
            if (this.popArray.length == 0)
                return;
            var showData = this.popArray.shift();
            this.isPoping = true;
            ViewManager.getInstance().showView(showData.className, showData.data);
        };
        return PopManager;
    }());

    var PopBaseScene = (function (_super) {
        __extends(PopBaseScene, _super);
        function PopBaseScene() {
            var _this = _super !== null && _super.apply(this, arguments) || this;
            _this.className_key = 'PopBaseScene';
            _this.showEnterType = BasePopAnimationEnterType.SCALE_MODE_BACK_MORE;
            _this.isResume = true;
            return _this;
        }
        PopBaseScene.prototype.childrenCreated = function () {
            _super.prototype.childrenCreated.call(this);
            this.showBackType = null;
        };
        PopBaseScene.prototype.onAddStage = function () {
            _super.prototype.onAddStage.call(this);
            if (this.isCreate) {
                this.initView();
                this.addEvent();
            }
        };
        PopBaseScene.prototype.setData = function (data) {
            this.viewData_ = data;
            if (this.isCreate) {
                this.initView();
                this.addEvent();
            }
        };
        PopBaseScene.prototype.pauseTime = function () {
            EventMgr.getInstance().sendEvent(GameEvent.ONHIDE);
        };
        PopBaseScene.prototype.initView = function () {
        };
        PopBaseScene.prototype.addEvent = function () {
        };
        PopBaseScene.prototype.resumeTime = function () {
            this.isResume && EventMgr.getInstance().sendEvent(GameEvent.ONSHOW);
        };
        PopBaseScene.prototype.removeSelf = function () {
            Laya.timer.clearAll(this);
            var node = _super.prototype.removeSelf.call(this);
            return node;
        };
        PopBaseScene.prototype.removeEvent = function () {
        };
        PopBaseScene.prototype.enableView = function (enable) {
            this.mouseEnabled = enable;
            ViewManager.getInstance().popLayer["mouseThrough"] = enable;
        };
        PopBaseScene.prototype.showCloseBtn = function (target) {
            target.visible = false;
            Laya.timer.once(3000, this, function () {
                target.visible = true;
            });
        };
        PopBaseScene.prototype.showBanner = function () {
            if (DeviceUtil.isWXMiniGame() || DeviceUtil.isTTMiniGame() || DeviceUtil.isQQMiniGame() || DeviceUtil.isMZMiniGame()) {
                var phone = MiniManeger.instance.systemInfo;
                var offset = { w: phone.screenWidth / 2, h: phone.screenHeight };
                MiniManeger.instance.showBannerAd(offset);
            }
        };
        PopBaseScene.prototype.hideBanner = function () {
            MiniManeger.instance.hideBanner();
        };
        return PopBaseScene;
    }(BaseSceneUISkinPopView));

    var PopLastScene = (function (_super) {
        __extends(PopLastScene, _super);
        function PopLastScene() {
            var _this = _super !== null && _super.apply(this, arguments) || this;
            _this.className_key = "PopScene";
            return _this;
        }
        PopLastScene.prototype.removeSelf = function () {
            var node = _super.prototype.removeSelf.call(this);
            PopManager.instance.isPoping = false;
            PopManager.instance.showPopView();
            return node;
        };
        return PopLastScene;
    }(PopBaseScene));

    var Prop;
    (function (Prop) {
        Prop[Prop["Power"] = 1001] = "Power";
        Prop[Prop["Gold"] = 1002] = "Gold";
    })(Prop || (Prop = {}));
    var GameMgr = (function () {
        function GameMgr() {
        }
        Object.defineProperty(GameMgr, "instance", {
            get: function () {
                if (!GameMgr.ins)
                    GameMgr.ins = new GameMgr();
                return GameMgr.ins;
            },
            enumerable: true,
            configurable: true
        });
        GameMgr.prototype.initData = function () {
            return new Promise(function (resolve) {
                var curTime = (new Date()).getTime();
                var isOneDay = Utils.judgeIsOnTheSameDay(GameData.getInstance().playerData.loginTime, curTime);
                if (!isOneDay) {
                    GameData.getInstance().playerData.loginTime = curTime;
                    GameData.getInstance().freePower[1] = false;
                    GameData.getInstance().playerData.shareVideoCount = 0;
                    GameInfoManager.getInstance().saveInfo(GameConst.BASE_INFO);
                }
                resolve();
            });
        };
        GameMgr.prototype.updateBaseData = function (id, value) {
            switch (id) {
                case Prop.Gold:
                    GameData.getInstance().playerData.gold += value;
                    if (GameData.getInstance().playerData.gold >= Number.MAX_VALUE) {
                        GameData.getInstance().playerData.gold = Number.MAX_VALUE;
                    }
                    EventMgr.getInstance().sendEvent(GameEvent.REFRESH_TOP);
                    GameInfoManager.getInstance().saveInfo(GameConst.BASE_INFO);
                    break;
                case Prop.Power:
                    PowerMgr.instance.changePowerUglify({ count: value });
                    break;
                default:
                    console.warn("参数错误 ->", id);
            }
        };
        GameMgr.prototype.getIconUrlById = function (id) {
            if (id == Prop.Power) {
                return "resource/assets/imgs/public/mianinterface_icon_1.png";
            }
            else if (id == Prop.Gold) {
                return "resource/assets/imgs/public/mianinterface_icon_2.png";
            }
            return "";
        };
        return GameMgr;
    }());
    window['GameMgr'] = GameMgr;

    var BuyPropScene = (function (_super) {
        __extends(BuyPropScene, _super);
        function BuyPropScene(data_) {
            var _this = _super.call(this) || this;
            _this.className_key = "BuyPropScene";
            _this.viewData_ = data_;
            _this.skin = "skins/uiView/pop/BuyPropView.json";
            return _this;
        }
        BuyPropScene.prototype.removeEvent = function () {
            this.btn_close.off(Laya.Event.CLICK, this, this.onCloseUglify);
            this.btn_get.off(Laya.Event.CLICK, this, this.onGetUglify);
        };
        BuyPropScene.prototype.onRemoved = function () {
            _super.prototype.onRemoved.call(this);
            this.removeEvent();
            this.viewData_ = null;
        };
        BuyPropScene.prototype.showInsertAd = function () {
            MiniManeger.instance.showInsertAd({
                successFun: function () {
                },
                closeFun: function () {
                },
                errorFun: function () {
                }
            });
        };
        BuyPropScene.prototype.onGetUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            var self = this;
            self.grp_center.mouseEnabled = false;
            if (GameData.getInstance().videoOpen || DeviceUtil.isMZMiniGame()) {
                MiniManeger.instance.playViderAd({
                    successFun: function () {
                        self.getAwardUglify();
                    },
                    failFun: function () {
                        self.grp_center.mouseEnabled = true;
                    },
                    errorFun: function () {
                        self.grp_center.mouseEnabled = true;
                    }
                });
            }
            else {
                MiniManeger.instance.shareAppMessage({
                    sucFun: function () {
                        self.getAwardUglify();
                    },
                    failFun: function () {
                        self.grp_center.mouseEnabled = true;
                    }
                });
            }
        };
        BuyPropScene.prototype.getAwardUglify = function () {
            var data = this.viewData_;
            if (data.type == 1) {
                GameMgr.instance.updateBaseData(Prop.Power, GameData.getInstance().defaultConfigs.videoBuyPower);
            }
            else {
                GameMgr.instance.updateBaseData(Prop.Gold, GameData.getInstance().defaultConfigs.videoBuyGold);
            }
            this.grp_center.mouseEnabled = true;
        };
        BuyPropScene.prototype.onCloseUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            EventMgr.getInstance().sendEvent(GameEvent.SHOW_TOP, true);
            this.removeSelf();
        };
        BuyPropScene.prototype.childrenCreated = function () {
            _super.prototype.childrenCreated.call(this);
            if (GameData.getInstance().videoOpen) {
                this.btn_get.getChildByName("icon").skin = "resource/assets/imgs/public/game_icon_4.png";
            }
            else {
                this.btn_get.getChildByName("icon").skin = "resource/assets/imgs/public/settlement_icon_5.png";
            }
        };
        BuyPropScene.prototype.addEvent = function () {
            this.btn_close.on(Laya.Event.CLICK, this, this.onCloseUglify);
            this.btn_get.on(Laya.Event.CLICK, this, this.onGetUglify);
        };
        BuyPropScene.prototype.initView = function () {
            if (DeviceUtil.isMZMiniGame())
                this.showInsertAd();
            this.showCloseBtn(this.btn_close);
            EventMgr.getInstance().sendEvent(GameEvent.SHOW_TOP, false);
            if (!this.viewData_)
                return;
            var data = this.viewData_;
            if (data.type == 1) {
                this.img_bg.skin = "resource/assets/imgs/home/main/buy_baseboard_1.png";
                this.lab_title.text = "来点体力吧！";
                this.img_icon.skin = "resource/assets/imgs/public/mianinterface_icon_1.png";
                this.lab_num.text = "+" + GameData.getInstance().defaultConfigs.videoBuyPower;
            }
            else {
                this.img_bg.skin = "resource/assets/imgs/home/main/buy_baseboard_2.png";
                this.lab_title.text = "来点金币吧！";
                this.img_icon.skin = "resource/assets/imgs/public/mianinterface_icon_2.png";
                this.lab_num.text = "+" + GameData.getInstance().defaultConfigs.videoBuyGold;
            }
        };
        return BuyPropScene;
    }(PopLastScene));

    var SignItem = (function (_super) {
        __extends(SignItem, _super);
        function SignItem(data) {
            var _this = _super.call(this) || this;
            _this.className_key = "SignItem";
            _this.viewData_ = data;
            _this.skin = "skins/uiView/sign/SignItem.json";
            return _this;
        }
        SignItem.prototype.onRemoved = function () {
            _super.prototype.onRemoved.call(this);
            this.viewData_ = null;
        };
        SignItem.prototype.setData = function (data) {
            this.viewData_ = data;
            if (this.isCreate) {
                this.initView();
            }
        };
        SignItem.prototype.initView = function () {
            var _this = this;
            if (!this.viewData_)
                return;
            var data = this.viewData_;
            this.img_signed.visible = data.isSigned;
            this.lab_day.text = data.name;
            this.box_award1.visible = this.box_award2.visible = false;
            this.box_can.visible = data.canSign;
            if (data.id < 7) {
                this.size(255, 290);
                this.box_can.size(210, 290);
                this.img_bg.skin = data.canSign ? "resource/assets/imgs/home/sign/sign_baseboard_4.png" : "resource/assets/imgs/home/sign/sign_baseboard_3.png";
                this.box_award1.visible = true;
                var img_icon = this.box_award1.getChildByName("img_icon");
                img_icon.skin = GameMgr.instance.getIconUrlById(data.reward[0].type);
                this.box_award1.getChildByName("lab_num").text = "+" + data.reward[0].num;
            }
            else {
                this.size(790, 290);
                this.box_can.size(550, 290);
                this.img_bg.skin = data.canSign ? "resource/assets/imgs/home/sign/sign_baseboard_6.png" : "resource/assets/imgs/home/sign/sign_baseboard_5.png";
                this.box_award2.visible = true;
                data.reward.forEach(function (v, i) {
                    var img_icon = _this.box_award2.getChildByName("img_icon" + (i + 1));
                    var lab_num = _this.box_award2.getChildByName("lab_num" + (i + 1));
                    img_icon.skin = GameMgr.instance.getIconUrlById(v.type);
                    lab_num.text = "+" + v.num;
                });
            }
        };
        SignItem.prototype.adaptationStage = function () {
        };
        SignItem.prototype.onAddStage = function () {
            _super.prototype.onAddStage.call(this);
            if (this.isCreate) {
                this.initView();
            }
        };
        return SignItem;
    }(BaseSceneUISkin));

    var AnimationManager = (function () {
        function AnimationManager() {
        }
        Object.defineProperty(AnimationManager, "instance", {
            get: function () {
                if (AnimationManager.ins == null) {
                    AnimationManager.ins = new AnimationManager();
                }
                return AnimationManager.ins;
            },
            enumerable: true,
            configurable: true
        });
        AnimationManager.prototype.pendulumAni = function (target, caller, range, duration) {
            var ani = function () {
                Laya.Tween.to(target, { rotation: range }, duration, null, Laya.Handler.create(caller, function () {
                    Laya.Tween.to(target, { rotation: range * -1 }, duration * 2, null, Laya.Handler.create(caller, function () {
                        Laya.Tween.to(target, { rotation: 0 }, duration, null, Laya.Handler.create(caller, function () {
                            ani();
                        }));
                    }));
                }));
            };
            ani();
        };
        AnimationManager.prototype.runaroundTween = function (target, caller, duration) {
            if (duration === void 0) { duration = 2000; }
            target.visible = true;
            target.rotation = 0;
            var tw = Laya.Tween.to(target, { rotation: 360 }, duration, null, null, 0, false, false);
            tw.repeat = 0;
        };
        AnimationManager.prototype.btnScaleAniLoop = function (target, caller, startScale, endScale, duration, ease) {
            if (startScale === void 0) { startScale = 1; }
            if (endScale === void 0) { endScale = 1.2; }
            if (duration === void 0) { duration = 500; }
            target.scale(startScale, startScale);
            var fun = function () {
                Laya.Tween.to(target, { scaleX: endScale, scaleY: endScale }, duration, ease, Laya.Handler.create(caller, function () {
                    Laya.Tween.to(target, { scaleX: startScale, scaleY: startScale }, duration, ease, Laya.Handler.create(caller, function () {
                        fun();
                    }));
                }));
            };
            fun();
        };
        AnimationManager.prototype.tipPointShake = function (target, play) {
            var _this = this;
            if (play) {
                Laya.Tween.clearAll(target);
                Laya.timer.clearAll(target);
                target.rotation = 0;
                var ani_1 = function (num) {
                    Laya.Tween.to(target, { rotation: 10 }, 100, null, Laya.Handler.create(_this, function () {
                        Laya.Tween.to(target, { rotation: -10 }, 200, null, Laya.Handler.create(_this, function () {
                            Laya.Tween.to(target, { rotation: 0 }, 100, null, Laya.Handler.create(_this, function () {
                                num--;
                                if (num) {
                                    ani_1(num);
                                }
                                else {
                                    var time = Utils.getRandom(1000, 3000);
                                    Laya.timer.once(time, target, function () { ani_1(2); });
                                }
                            }));
                        }));
                    }));
                };
                var delay = Utils.getRandom(500, 1000);
                Laya.timer.once(delay, target, function () { ani_1(2); });
            }
            else {
                Laya.timer.clearAll(target);
                Laya.Tween.clearAll(target);
                target.rotation = 0;
            }
        };
        AnimationManager.prototype.scaleTween = function (target, caller, duration, complete, props, ease) {
            if (duration === void 0) { duration = 500; }
            target.visible = true;
            target.scale(0.8, 0.8);
            Laya.Tween.to(target, { scaleX: 1, scaleY: 1 }, duration, ease, Laya.Handler.create(caller, function () {
                complete && complete();
            }));
        };
        AnimationManager.prototype.creatBoonAnimation = function (url) {
            var _this = this;
            return new Promise(function (resolve) {
                var boomAnimation = new Laya.Skeleton();
                boomAnimation.load(url, Laya.Handler.create(_this, function () {
                    if (!boomAnimation.player) {
                        resolve(null);
                    }
                    else {
                        boomAnimation.player.playbackRate = 1;
                        resolve(boomAnimation);
                    }
                }));
            });
        };
        AnimationManager.prototype.getAtlasAnimation = function (url, fex) {
            url = url + fex;
            return new Promise(function (resolve) {
                var roleAni = new Laya.Animation();
                roleAni.loadAtlas(url, Laya.Handler.create(null, function () {
                    resolve(roleAni);
                }));
            });
        };
        AnimationManager.prototype.scaleBTween = function (target, caller, duration, complete, props, ease) {
            if (duration === void 0) { duration = 500; }
            target.scale(1.1, 1.1);
            Laya.Tween.to(target, { scaleX: 1, scaleY: 1 }, duration, ease, Laya.Handler.create(caller, function () {
                complete && complete();
            }));
        };
        AnimationManager.prototype.show2dBoonAnimation = function (url, dbBox, index, loop, rate, x, y, rotation) {
            var _this = this;
            return new Promise(function (resolve) {
                var self = _this;
                dbBox.removeChildren();
                var boomAnimation = new Laya.Skeleton();
                boomAnimation.load(url, Laya.Handler.create(self, function () {
                    if (!boomAnimation.player) {
                        resolve();
                        return;
                    }
                    boomAnimation.player.playbackRate = rate;
                    boomAnimation.player.once(Laya.Event.STOPPED, self, function () {
                        resolve();
                    });
                    boomAnimation.scale(2, 2);
                    dbBox.addChild(boomAnimation);
                    boomAnimation.x = x;
                    boomAnimation.y = y;
                    boomAnimation.rotation = rotation;
                    boomAnimation.play(index, loop);
                }));
            });
        };
        AnimationManager.prototype.displayTwinkle = function (target, prefix, caller) {
            var index = 1;
            Laya.timer.loop(500, caller, function () {
                target.skin = prefix + index + ".png";
                index = index == 1 ? 2 : 1;
            });
        };
        AnimationManager.prototype.frameAni = function (target, prefix, caller, frameNum, time) {
            if (time === void 0) { time = 100; }
            var index = 1;
            Laya.timer.loop(time, caller, function () {
                target.skin = prefix + index + ".png";
                index++;
                if (index > frameNum)
                    index = 1;
            });
        };
        return AnimationManager;
    }());

    var SignScene = (function (_super) {
        __extends(SignScene, _super);
        function SignScene() {
            var _this = _super.call(this) || this;
            _this.className_key = "SignScene";
            _this.pointArr = [[0, 0], [260, 0], [520, 0], [0, 303], [260, 303], [520, 303], [0, 603]];
            _this.signData = [];
            _this.skin = "skins/uiView/sign/SignView.json";
            return _this;
        }
        SignScene.prototype.removeEvent = function () {
            this.btn_close.off(Laya.Event.CLICK, this, this.onCloseUglify);
            this.btn_sign.off(Laya.Event.CLICK, this, this.onSignUglify);
            this.box_double.off(Laya.Event.CLICK, this, this.onSelectUglify);
        };
        SignScene.prototype.onRemoved = function () {
            _super.prototype.onRemoved.call(this);
            this.removeEvent();
            Laya.Tween.clearAll(this.btn_sign);
        };
        SignScene.prototype.refreshStateUglify = function () {
            var curCanSign = SignManager.instance.checkSign();
            if (curCanSign) {
                this.btn_sign.visible = true;
                this.lab_tip.visible = false;
                if (GameData.getInstance().isConVersion || !GameData.getInstance().videoOpen) {
                    this.showDoubleUglify(false);
                    this.box_double.visible = false;
                }
                else {
                    this.box_double.visible = true;
                    this.showDoubleUglify(GameData.getInstance().selectDoule);
                    AnimationManager.instance.btnScaleAniLoop(this.btn_sign, this);
                }
            }
            else {
                this.btn_sign.visible = this.box_double.visible = false;
                this.lab_tip.visible = true;
                Laya.Tween.clearAll(this.btn_sign);
            }
        };
        SignScene.prototype.refreshSignUglify = function () {
            return __awaiter(this, void 0, void 0, function () {
                var signData, box_sign, count, i, item;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, SignManager.instance.getSignDataUglify()];
                        case 1:
                            signData = _a.sent();
                            this.signData = signData;
                            box_sign = this.box_sign;
                            count = signData.length;
                            for (i = 0; i < count; i++) {
                                item = this.box_sign.getChildAt(i);
                                if (item) {
                                    item.setData(this.signData[i]);
                                }
                                else {
                                    item = new SignItem(this.signData[i]);
                                    item.x = this.pointArr[i][0];
                                    item.y = this.pointArr[i][1];
                                    this.box_sign.addChild(item);
                                }
                            }
                            return [2];
                    }
                });
            });
        };
        SignScene.prototype.showDoubleUglify = function (show) {
            this.img_select.visible = show;
            var desc = this.btn_sign.getChildByName("desc");
            desc.text = show ? "双倍奖励" : "单倍奖励";
        };
        SignScene.prototype.showInsertAd = function () {
            MiniManeger.instance.showInsertAd({
                successFun: function () {
                },
                closeFun: function () {
                },
                errorFun: function () {
                }
            });
        };
        SignScene.prototype.onSignUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            var self = this;
            if (self.img_select.visible) {
                self.grp_center.mouseEnabled = false;
                MiniManeger.instance.playViderAd({
                    successFun: function () {
                        self.getAwardUglify(2);
                    },
                    failFun: function () {
                        self.grp_center.mouseEnabled = true;
                    },
                    errorFun: function () {
                        self.grp_center.mouseEnabled = true;
                    }
                });
            }
            else {
                self.getAwardUglify(1);
            }
        };
        SignScene.prototype.getAwardUglify = function (mul) {
            if (mul === void 0) { mul = 1; }
            for (var index = 0; index < this.signData.length; index++) {
                var element = this.signData[index];
                if (element.canSign) {
                    var data = element;
                    data.reward.forEach(function (v) {
                        var awardId = v.type;
                        if (awardId < 10000) {
                            GameMgr.instance.updateBaseData(awardId, v.num * mul);
                        }
                    });
                    GameData.getInstance().signIn.timeStamp = (new Date()).getTime();
                    GameData.getInstance().signIn.total_count += 1;
                    GameInfoManager.getInstance().saveInfo(GameConst.SIGN_INFO);
                    break;
                }
            }
            this.initView();
            this.grp_center.mouseEnabled = true;
        };
        SignScene.prototype.onSelectUglify = function () {
            if (this.img_select.visible) {
                this.showDoubleUglify(false);
            }
            else {
                this.showDoubleUglify(true);
            }
        };
        SignScene.prototype.onCloseUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            this.removeSelf();
        };
        SignScene.prototype.childrenCreated = function () {
            _super.prototype.childrenCreated.call(this);
        };
        SignScene.prototype.addEvent = function () {
            this.btn_close.on(Laya.Event.CLICK, this, this.onCloseUglify);
            this.btn_sign.on(Laya.Event.CLICK, this, this.onSignUglify);
            this.box_double.on(Laya.Event.CLICK, this, this.onSelectUglify);
        };
        SignScene.prototype.initView = function () {
            if (DeviceUtil.isMZMiniGame())
                this.showInsertAd();
            this.showCloseBtn(this.btn_close);
            this.refreshSignUglify();
            this.refreshStateUglify();
        };
        return SignScene;
    }(PopBaseScene));

    var AwardScene = (function (_super) {
        __extends(AwardScene, _super);
        function AwardScene(data_) {
            var _this = _super.call(this) || this;
            _this.className_key = "AwardScene";
            _this.clickCount = 0;
            _this.flag = false;
            _this.viewData_ = data_;
            _this.skin = "skins/uiView/pop/AwardView.json";
            return _this;
        }
        AwardScene.prototype.removeEvent = function () {
            this.btn_get.off(Laya.Event.CLICK, this, this.onVideoUglify);
            this.lab_get.off(Laya.Event.CLICK, this, this.onGetUglify);
            this.btn_open.off(Laya.Event.CLICK, this, this.onOpenUglify);
        };
        AwardScene.prototype.onRemoved = function () {
            _super.prototype.onRemoved.call(this);
            this.removeEvent();
            if (this.viewData_.type == 1) ;
            this.viewData_ = null;
            Laya.Tween.clearAll(this.img_light);
            Laya.Tween.clearAll(this.btn_get);
            Laya.Tween.clearAll(this.btn_open);
        };
        AwardScene.prototype.onVideoUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            var self = this;
            self.grp_center.mouseEnabled = false;
            if (GameData.getInstance().videoOpen) {
                MiniManeger.instance.playViderAd({
                    successFun: function () {
                        self.getAwardUglify(2);
                    },
                    failFun: function () {
                        self.grp_center.mouseEnabled = true;
                    },
                    errorFun: function () {
                        self.grp_center.mouseEnabled = true;
                    }
                });
            }
            else {
                MiniManeger.instance.shareAppMessage({
                    sucFun: function () {
                        self.getAwardUglify(2);
                    },
                    failFun: function () {
                        self.grp_center.mouseEnabled = true;
                    }
                });
            }
        };
        AwardScene.prototype.onGetUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            this.getAwardUglify(1);
        };
        AwardScene.prototype.getAwardUglify = function (mult) {
            var data = this.viewData_;
            if (data.type == 1) {
                GameMgr.instance.updateBaseData(data.data.id, data.data.num * mult);
                if (data.data && data.data.fun)
                    data.data.fun();
            }
            this.grp_center.mouseEnabled = true;
            this.removeSelf();
        };
        AwardScene.prototype.onOpenUglify = function () {
            var _this = this;
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            Laya.timer.clear(this, this.onTimerUglify);
            this.clickCount++;
            this.progressUglify();
            var viewData = this.viewData_.data;
            if (this.clickCount >= 10) {
                this.btn_open.mouseEnabled = false;
                this.removeSelf();
                ViewManager.getInstance().showView(AwardScene, {
                    type: 1,
                    data: {
                        id: Prop.Power,
                        num: GameData.getInstance().defaultConfigs.powerBag,
                        fun: viewData.fun,
                        flag: true
                    }
                });
            }
            else {
                Laya.timer.loop(700, this, this.onTimerUglify);
                if (this.clickCount == 6) {
                    if (!this.flag) {
                        this.btn_open.visible = false;
                        MiniManeger.instance.showBannerAdSp();
                        Laya.Tween.to(this.btn_open, { bottom: 425 }, 500, null, Laya.Handler.create(this, function () {
                            _this.btn_open.visible = true;
                        }));
                    }
                    this.flag = true;
                }
            }
        };
        AwardScene.prototype.onTimerUglify = function () {
            this.clickCount--;
            this.progressUglify();
            if (this.clickCount <= 0) {
                Laya.timer.clear(this, this.onTimerUglify);
            }
        };
        AwardScene.prototype.progressUglify = function () {
            this.img_prog.width = 840 * this.clickCount / 10;
            this.img_expression.skin = this.clickCount % 2 ? "resource/assets/imgs/home/reward/reward_icon_2.png" : "resource/assets/imgs/home/reward/reward_icon_3.png";
        };
        AwardScene.prototype.childrenCreated = function () {
            _super.prototype.childrenCreated.call(this);
            this.grp_center.width = Laya.stage.width;
            this.grp_center.height = Laya.stage.height;
            if (GameData.getInstance().videoOpen) {
                this.btn_get.getChildByName("icon").skin = "resource/assets/imgs/public/game_icon_4.png";
            }
            else {
                this.btn_get.getChildByName("icon").skin = "resource/assets/imgs/public/settlement_icon_5.png";
            }
        };
        AwardScene.prototype.addEvent = function () {
            this.btn_get.on(Laya.Event.CLICK, this, this.onVideoUglify);
            this.lab_get.on(Laya.Event.CLICK, this, this.onGetUglify);
            this.btn_open.on(Laya.Event.CLICK, this, this.onOpenUglify);
        };
        AwardScene.prototype.initView = function () {
            return __awaiter(this, void 0, void 0, function () {
                var data;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (!this.viewData_)
                                return [2];
                            this.btn_get.visible = this.btn_open.visible = this.lab_get.visible = false;
                            this.lab_num.visible = this.img_expression.visible = this.img_progdb.visible = false;
                            AnimationManager.instance.runaroundTween(this.img_light, this);
                            data = this.viewData_;
                            if (!(data.type == 1)) return [3, 1];
                            this.lab_title.text = "获得奖励";
                            this.img_icon.skin = GameMgr.instance.getIconUrlById(data.data.id);
                            this.img_icon.scale(3, 3);
                            this.lab_num.visible = true;
                            this.lab_num.text = "+" + data.data.num;
                            this.btn_get.visible = true;
                            this.showCloseBtn(this.lab_get);
                            AnimationManager.instance.btnScaleAniLoop(this.btn_get, this);
                            return [3, 4];
                        case 1:
                            this.lab_title.text = "体力书包";
                            this.img_icon.skin = "resource/assets/imgs/home/reward/reward_icon_1.png";
                            this.img_icon.scale(1.5, 1.5);
                            this.img_expression.visible = true;
                            this.img_progdb.visible = true;
                            this.clickCount = 0;
                            this.progressUglify();
                            this.btn_open.bottom = 100;
                            this.btn_open.visible = true;
                            this.btn_open.mouseEnabled = true;
                            this.flag = false;
                            if (!(DeviceUtil.isWXMiniGame() ||
                                (DeviceUtil.isMZMiniGame() && GameData.getInstance().touchByMistake))) return [3, 3];
                            this.hideBanner();
                            this.btn_open.bottom = 100;
                            this.btn_open.visible = false;
                            return [4, MiniManeger.instance.createBanner()];
                        case 2:
                            _a.sent();
                            this.btn_open.visible = true;
                            return [3, 4];
                        case 3:
                            this.btn_open.bottom = 425;
                            _a.label = 4;
                        case 4: return [2];
                    }
                });
            });
        };
        return AwardScene;
    }(PopLastScene));

    var PowerItem = (function (_super) {
        __extends(PowerItem, _super);
        function PowerItem(data) {
            var _this = _super.call(this) || this;
            _this.className_key = "PowerItem";
            _this.viewData_ = data;
            _this.skin = "skins/uiView/power/PowerItem.json";
            return _this;
        }
        PowerItem.prototype.removeEvent = function () {
            this.btn_get.off(Laya.Event.CLICK, this, this.onGetUglify);
        };
        PowerItem.prototype.onRemoved = function () {
            _super.prototype.onRemoved.call(this);
            this.removeEvent();
            this.viewData_ = null;
        };
        PowerItem.prototype.setData = function (data) {
            this.viewData_ = data;
            if (this.isCreate) {
                this.initView();
            }
        };
        PowerItem.prototype.initView = function () {
            if (!this.viewData_)
                return;
            var data = this.viewData_;
            this.img_icon.skin = data.id == 1 ? "resource/assets/imgs/home/main/mianinterface_icon_3.png" : "resource/assets/imgs/home/power/" + data.icon + ".png";
            this.lab_name.text = data.name;
            this.lab_num.text = "+" + data.rewardNum;
            this.btn_get.visible = false;
            this.img_geted.visible = this.lab_tip.visible = false;
            if (data.isGeted) {
                if (data.id == 1) {
                    this.lab_tip.visible = true;
                }
                else {
                    this.img_geted.visible = true;
                }
            }
            else {
                this.btn_get.visible = true;
                var desc = this.btn_get.getChildByName("desc");
                if (data.canGet) {
                    this.btn_get.skin = "resource/assets/imgs/public/free_button_1.png";
                    desc.text = "领取";
                    this.btn_get.mouseEnabled = true;
                }
                else {
                    this.btn_get.skin = "resource/assets/imgs/public/free_button_2.png";
                    desc.text = "未完成";
                    this.btn_get.mouseEnabled = false;
                }
            }
        };
        PowerItem.prototype.onGetUglify = function () {
            var _this = this;
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            PopManager.instance.showPopView({
                className: AwardScene,
                data: {
                    type: 1,
                    data: {
                        id: Prop.Power,
                        num: this.viewData_.rewardNum,
                        fun: function () {
                            GameData.getInstance().freePower[_this.viewData_.id] = true;
                            GameInfoManager.getInstance().saveInfo(GameConst.FREE_INFO);
                            EventMgr.getInstance().sendEvent(GameEvent.REFRESH_FREE_POWER);
                        }
                    }
                }
            });
        };
        PowerItem.prototype.adaptationStage = function () {
        };
        PowerItem.prototype.onAddStage = function () {
            _super.prototype.onAddStage.call(this);
            if (this.isCreate) {
                this.initView();
                this.addEvent();
            }
        };
        PowerItem.prototype.addEvent = function () {
            this.btn_get.on(Laya.Event.CLICK, this, this.onGetUglify);
        };
        return PowerItem;
    }(BaseSceneUISkin));

    var PowerScene = (function (_super) {
        __extends(PowerScene, _super);
        function PowerScene() {
            var _this = _super.call(this) || this;
            _this.className_key = "PowerScene";
            _this.skin = "skins/uiView/power/PowerView.json";
            return _this;
        }
        PowerScene.prototype.removeEvent = function () {
            this.btn_close.off(Laya.Event.CLICK, this, this.onCloseUglify);
            EventMgr.getInstance().removeEvent(GameEvent.REFRESH_FREE_POWER, this, this.refreshUIUglify);
        };
        PowerScene.prototype.onRemoved = function () {
            _super.prototype.onRemoved.call(this);
            this.removeEvent();
            this.viewData_ = null;
        };
        PowerScene.prototype.showInsertAd = function () {
            MiniManeger.instance.showInsertAd({
                successFun: function () {
                },
                closeFun: function () {
                },
                errorFun: function () {
                }
            });
        };
        PowerScene.prototype.refreshUIUglify = function () {
            return __awaiter(this, void 0, void 0, function () {
                var dataArr, count, i, item;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, PowerMgr.instance.getFreePowerDataUglify()];
                        case 1:
                            dataArr = _a.sent();
                            this.viewData_ = dataArr;
                            count = dataArr.length;
                            for (i = 0; i < count; i++) {
                                item = this.panel_free.getChildAt(i);
                                if (item) {
                                    item.setData(dataArr[i]);
                                }
                                else {
                                    item = new PowerItem(dataArr[i]);
                                    item.y = (27 + 138) * i;
                                    this.panel_free.addChild(item);
                                }
                            }
                            return [2];
                    }
                });
            });
        };
        PowerScene.prototype.onCloseUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            this.removeSelf();
        };
        PowerScene.prototype.childrenCreated = function () {
            _super.prototype.childrenCreated.call(this);
            this.panel_free.vScrollBarSkin = "";
        };
        PowerScene.prototype.addEvent = function () {
            this.btn_close.on(Laya.Event.CLICK, this, this.onCloseUglify);
            EventMgr.getInstance().addEvent(GameEvent.REFRESH_FREE_POWER, this, this.refreshUIUglify);
        };
        PowerScene.prototype.initView = function () {
            if (DeviceUtil.isMZMiniGame())
                this.showInsertAd();
            this.showCloseBtn(this.btn_close);
            this.refreshUIUglify();
        };
        return PowerScene;
    }(PopBaseScene));

    var SkinMgr = (function () {
        function SkinMgr() {
        }
        Object.defineProperty(SkinMgr, "instance", {
            get: function () {
                if (!SkinMgr.ins)
                    SkinMgr.ins = new SkinMgr();
                return SkinMgr.ins;
            },
            enumerable: true,
            configurable: true
        });
        SkinMgr.prototype.getBrushDataUglify = function () {
            return __awaiter(this, void 0, void 0, function () {
                var configs, netData, dataArr, key, config, data;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, ConfigManager.instance.getBrushConfig()];
                        case 1:
                            configs = _a.sent();
                            netData = GameData.getInstance().brush;
                            dataArr = [];
                            for (key in configs) {
                                config = configs[key];
                                data = {
                                    id: config.ID,
                                    icon: config.icon,
                                    unlock: netData.owns.indexOf(config.ID) > -1,
                                    use: netData.using == config.ID,
                                    weight: config.weight
                                };
                                dataArr.push(data);
                            }
                            return [2, dataArr];
                    }
                });
            });
        };
        SkinMgr.prototype.useBrushUglify = function (id) {
            GameData.getInstance().brush.using = id;
            GameInfoManager.getInstance().saveInfo(GameConst.BRUSH_INFO);
        };
        SkinMgr.prototype.unlockBrushUglify = function (id) {
            GameData.getInstance().brush.owns.push(id);
            GameInfoManager.getInstance().saveInfo(GameConst.BRUSH_INFO);
        };
        SkinMgr.prototype.getCurBrushDataUglify = function () {
            return __awaiter(this, void 0, void 0, function () {
                var configs;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, ConfigManager.instance.getBrushConfig()];
                        case 1:
                            configs = _a.sent();
                            return [2, configs[GameData.getInstance().brush.using]];
                    }
                });
            });
        };
        return SkinMgr;
    }());

    var BrushItem = (function (_super) {
        __extends(BrushItem, _super);
        function BrushItem(_data) {
            var _this = _super.call(this) || this;
            _this.className_key = "BrushItem";
            _this.viewData_ = _data;
            _this.skin = "skins/game/type2/brush/BrushItem.json";
            return _this;
        }
        BrushItem.prototype.onRemoved = function () {
            _super.prototype.onRemoved.call(this);
            this.off(Laya.Event.CLICK, this, this.onUse);
            this.viewData_ = null;
        };
        BrushItem.prototype.initView = function () {
            if (!this.viewData_)
                return;
            var data = this.viewData_;
            this.off(Laya.Event.CLICK, this, this.onUse);
            this.img_mask.visible = false;
            this.img_brush.skin = data.unlock ? "resource/assets/imgs/game/type2/brush/brush_brush/" + data.icon + "_2.png" : "resource/assets/imgs/game/type2/brush/brush_brush/" + data.icon + "_1.png";
            this.img_bg.skin = data.unlock ? "resource/assets/imgs/game/type2/brush/brush_baseboard_2.png" : "resource/assets/imgs/game/type2/brush/brush_baseboard_4.png";
            this.btn_use.visible = data.use;
            if (data.unlock)
                this.on(Laya.Event.CLICK, this, this.onUse);
        };
        BrushItem.prototype.showOrHideMask = function (isShow) {
            this.img_mask.visible = isShow;
        };
        BrushItem.prototype.onUse = function () {
            if (this.viewData_.use)
                return;
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            SkinMgr.instance.useBrushUglify(this.viewData_.id);
            EventMgr.getInstance().sendEvent(GameEvent.USE_BRUSH);
        };
        BrushItem.prototype.childrenCreated = function () {
            _super.prototype.childrenCreated.call(this);
        };
        BrushItem.prototype.adaptationStage = function () {
        };
        BrushItem.prototype.onAddStage = function () {
            if (this.isCreate) {
                this.initView();
            }
        };
        BrushItem.prototype.setData = function (data) {
            this.viewData_ = data;
            if (this.isCreate) {
                this.initView();
            }
        };
        return BrushItem;
    }(BaseSceneUISkin));

    var ObjectUtil = (function () {
        function ObjectUtil() {
        }
        ObjectUtil.isEmpty = function (obj, unsafe) {
            if (unsafe === void 0) { unsafe = true; }
            return unsafe && (obj === undefined || obj === null) ? true : this.isEqual({}, obj);
        };
        ObjectUtil.isEqual = function (oldVal, newVal) {
            return !this.compare(oldVal, newVal, { strict: true }).flag;
        };
        ObjectUtil.copy = function (obj) {
            return this.compare({}, obj).result;
        };
        ObjectUtil.minus = function (oldVal, newVal) {
            return this.compare(oldVal, newVal, { strict: false }).result;
        };
        ObjectUtil.merge = function (oldVal, newVal, data) {
            if (!data)
                data = { full: true, strict: true, repeat: true };
            var val = this.compare(oldVal, newVal, { strict: data.strict, merge: true, full: data.full, repeat: data.repeat });
            return (val.flag ? val.result : this.copy(oldVal));
        };
        ObjectUtil.compare = function (oldVal, newVal, data) {
            var _this = this;
            var result, flag = false;
            if (!data)
                data = { strict: false, merge: false, full: false, repeat: false };
            switch ([oldVal, newVal].filter(function (item) { return item instanceof Object; }).length) {
                case 2:
                    if (!data.strict && oldVal instanceof Array && newVal instanceof Array) {
                        result = data.merge && data.full ? this.copy(oldVal) : [];
                        newVal.forEach(function (item) {
                            if (data.merge) {
                                if (data.repeat) {
                                    result.push(_this.copy(item));
                                }
                                else {
                                    if (!result.some(function (res) { return _this.isEqual(res, item); })) {
                                        result.push(_this.copy(item));
                                    }
                                }
                                flag = true;
                            }
                            else {
                                if (!oldVal.some(function (old) { return _this.isEqual(old, item); })) {
                                    result.push(_this.copy(item));
                                    flag = true;
                                }
                            }
                        });
                    }
                    else {
                        var oldKey_1 = Object.keys(oldVal), newKey_1 = Object.keys(newVal);
                        switch ([oldVal, newVal].filter(function (item) { return item instanceof Array; }).length) {
                            case 1:
                                result = newVal instanceof Array ? [] : {};
                                newKey_1.forEach(function (item) {
                                    result[item] = _this.copy(newVal[item]);
                                });
                                flag = true;
                                break;
                            default:
                                result = data.merge && data.full ? this.copy(oldVal) : newVal instanceof Array ? [] : {};
                                (data.merge ? newKey_1 : oldKey_1).forEach(function (item) {
                                    if (data.merge && !data.full) {
                                        result[item] = _this.copy(newVal[item]);
                                        flag = true;
                                    }
                                    else {
                                        var temp = _this.compare(oldVal[item], newVal[item], { strict: data.strict, merge: data.merge, full: data.full, repeat: data.repeat });
                                        if (temp.flag) {
                                            if (newKey_1.indexOf(item) === -1) {
                                                delete result[item];
                                            }
                                            else {
                                                result[item] = temp.result;
                                            }
                                            flag = true;
                                        }
                                    }
                                });
                                !data.merge && newKey_1.forEach(function (item) {
                                    if (oldKey_1.indexOf(item) === -1) {
                                        result[item] = _this.copy(newVal[item]);
                                        flag = true;
                                    }
                                });
                        }
                    }
                    break;
                case 1:
                    result = newVal instanceof Object ? this.copy(newVal) : newVal;
                    flag = true;
                    break;
                default:
                    if (oldVal !== newVal) {
                        result = newVal;
                        flag = true;
                    }
            }
            return {
                result: result,
                flag: flag
            };
        };
        return ObjectUtil;
    }());

    var ArrayUtil = (function () {
        function ArrayUtil() {
        }
        ArrayUtil.upset = function (arr) {
            var newArr = arr.sort(function () { return 0.5 - Math.random(); });
            return newArr;
        };
        ArrayUtil.unique = function (arr) {
            var newArr = [];
            arr.forEach(function (item) {
                if (newArr.indexOf(item) < 0) {
                    newArr.push(item);
                }
            });
            return newArr;
        };
        ArrayUtil.getRandomUniqueArr = function (arr, num) {
            var newArr = ObjectUtil.copy(arr);
            var result = [];
            for (var i = 0; i < num; i++) {
                if (newArr.length > 0) {
                    var arrIndex = Math.floor(Math.random() * newArr.length);
                    result[i] = newArr[arrIndex];
                    newArr.splice(arrIndex, 1);
                }
                else {
                    break;
                }
            }
            return result;
        };
        ArrayUtil.getIndexByWeight = function (arr) {
            var sum = 0;
            var rand = 0;
            var result = 0;
            for (var i in arr) {
                sum += Number(arr[i]);
            }
            for (var i in arr) {
                rand = Math.floor(Math.random() * sum + 1);
                if (arr[i] >= rand) {
                    result = Number(i);
                    break;
                }
                else {
                    sum -= arr[i];
                }
            }
            return result;
        };
        return ArrayUtil;
    }());

    var PageRadio = (function (_super) {
        __extends(PageRadio, _super);
        function PageRadio(num, space) {
            var _this = _super.call(this) || this;
            _this.space = 0;
            _this._selectIndex = 0;
            _this.radioNum = num;
            _this.space = space;
            _this.initView();
            return _this;
        }
        Object.defineProperty(PageRadio.prototype, "selectIndex", {
            get: function () {
                return this._selectIndex;
            },
            set: function (value) {
                this._selectIndex = value;
                this.updateSelectIndex();
            },
            enumerable: true,
            configurable: true
        });
        PageRadio.prototype.initView = function () {
            for (var i = 0; i < this.radioNum; i++) {
                var box_radio = new Laya.Box();
                box_radio.size(39, 38);
                var selectImg = new Laya.Image();
                selectImg.skin = this.selectIndex == i ? "resource/assets/imgs/game/type2/brush/brush_round_1.png" : "resource/assets/imgs/game/type2/brush/brush_round_2.png";
                selectImg.autoSize = true;
                box_radio.addChild(selectImg);
                selectImg.centerX = selectImg.centerY = 0;
                box_radio.x = 0 + (this.space + 39) * i;
                this.addChild(box_radio);
            }
        };
        PageRadio.prototype.updateSelectIndex = function () {
            for (var i = 0; i < this.numChildren; i++) {
                var box_radio = this.getChildAt(i);
                var selectImg = box_radio.getChildAt(0);
                selectImg.skin = this.selectIndex == i ? "resource/assets/imgs/game/type2/brush/brush_round_1.png" : "resource/assets/imgs/game/type2/brush/brush_round_2.png";
            }
        };
        return PageRadio;
    }(Laya.Box));

    var BrushScene = (function (_super) {
        __extends(BrushScene, _super);
        function BrushScene(data) {
            var _this = _super.call(this) || this;
            _this.className_key = "BrushScene";
            _this.showEnterType = null;
            _this.curPage = 1;
            _this.maxPage = 3;
            _this.aniArr = [];
            _this.lockArr = [];
            _this.curPageArr = [];
            _this.weightArr = [];
            _this.isPlaying = false;
            _this.distance = 773 + 20;
            _this.price = 100;
            _this.viewData_ = data;
            _this.skin = "skins/game/type2/brush/BrushView.json";
            return _this;
        }
        BrushScene.prototype.removeEvent = function () {
            this.btn_get.off(Laya.Event.CLICK, this, this.onGet);
            this.btn_gold.off(Laya.Event.CLICK, this, this.onGoldUglify);
            this.btn_close.off(Laya.Event.CLICK, this, this.onCloseUglify);
            this.box_brush.off(Laya.Event.MOUSE_DOWN, this, this.mouseDown);
            this.box_brush.off(Laya.Event.MOUSE_UP, this, this.mouseUp);
            this.box_brush.off(Laya.Event.MOUSE_OUT, this, this.mouseUp);
            EventMgr.getInstance().removeEvent(GameEvent.USE_BRUSH, this, this.useBrush);
        };
        BrushScene.prototype.onRemoved = function () {
            _super.prototype.onRemoved.call(this);
            this.removeEvent();
            if (this.viewData_.type == 1) {
                EventMgr.getInstance().sendEvent(GameEvent.CHANGE_POS, { _x: 30, _y: 30 });
            }
            else {
                EventMgr.getInstance().sendEvent(GameEvent.HIDE_TOP);
            }
            this.brushData = null;
            this.viewData_ = null;
        };
        BrushScene.prototype.initView = function () {
            return __awaiter(this, void 0, void 0, function () {
                var lab;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (DeviceUtil.isMZMiniGame())
                                this.showInsertAd();
                            if (this.viewData_.type == 1) ;
                            else if (this.viewData_.type == 2) ;
                            EventMgr.getInstance().sendEvent(GameEvent.SHOW_TOP);
                            EventMgr.getInstance().sendEvent(GameEvent.CHANGE_POS, { _x: 30, _y: 30 });
                            this.lab_test.visible = false;
                            this.img_baseBoard.visible = true;
                            this.img_baseBoard.mask = this.lab_test;
                            lab = this.btn_gold.getChildByName("num");
                            lab.text = "+" + GameData.getInstance().defaultConfigs.videoBuyGold;
                            return [4, this.refreshUIUglify()];
                        case 1:
                            _a.sent();
                            this.refreshPageUglify();
                            this.updateBrushUglify();
                            return [2];
                    }
                });
            });
        };
        BrushScene.prototype.showInsertAd = function () {
            MiniManeger.instance.showInsertAd({
                successFun: function () {
                },
                closeFun: function () {
                },
                errorFun: function () {
                }
            });
        };
        BrushScene.prototype.updateBrushUglify = function () {
            return __awaiter(this, void 0, void 0, function () {
                var data;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, SkinMgr.instance.getCurBrushDataUglify()];
                        case 1:
                            data = _a.sent();
                            if (!data)
                                return [2];
                            this.img_baseBoard.skin = "resource/assets/imgs/game/type2/brushs/" + data.icon + ".png";
                            return [2];
                    }
                });
            });
        };
        BrushScene.prototype.refreshUIUglify = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _a, i, box_1, start, box, i, len, data, item;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            _a = this;
                            return [4, SkinMgr.instance.getBrushDataUglify()];
                        case 1:
                            _a.brushData = _b.sent();
                            this.maxPage = Math.ceil(this.brushData.length / 9);
                            for (i = 0; i < this.maxPage; i++) {
                                box_1 = this.box_brush.getChildAt(i);
                                if (!box_1) {
                                    box_1 = new Laya.Box();
                                    box_1.size(773, 700);
                                    box_1.x = (773 + 20) * i;
                                    this.box_brush.addChild(box_1);
                                }
                            }
                            start = (this.curPage - 1) * 9;
                            this.curPageArr = this.brushData.slice(start, start + 9);
                            this.weightArr = [];
                            this.lockArr = [];
                            box = this.box_brush.getChildAt(this.curPage - 1);
                            for (i = 0, len = this.curPageArr.length; i < len; i++) {
                                data = this.curPageArr[i];
                                if (!data.unlock) {
                                    this.weightArr.push(data.weight);
                                    this.lockArr.push(data);
                                }
                                item = box.getChildAt(i);
                                if (item) {
                                    item.setData(data);
                                }
                                else {
                                    item = new BrushItem(data);
                                    item.x = (i % 3) * (209 + 73);
                                    item.y = Math.floor(i / 3) * (230 + 5);
                                    box.addChild(item);
                                }
                            }
                            this.refreshBtnUglify();
                            return [2];
                    }
                });
            });
        };
        BrushScene.prototype.refreshBtnUglify = function () {
            if (this.lockArr.length) {
                this.btn_comp.visible = false;
                this.btn_get.visible = true;
                var lab = this.btn_get.getChildByName("num");
                lab.text = GameData.getInstance().defaultConfigs.unlockCost2 + "";
                this.price = GameData.getInstance().defaultConfigs.unlockCost2;
            }
            else {
                this.btn_comp.visible = true;
                this.btn_get.visible = false;
                this.btn_comp.disabled = true;
            }
        };
        BrushScene.prototype.refreshPageUglify = function () {
            if (!this.com_page) {
                this.com_page = new PageRadio(this.maxPage, 30);
                this.com_page.centerX = 0;
                this.com_page.y = 1350;
                this.box_content.addChild(this.com_page);
            }
            this.com_page.selectIndex = this.curPage - 1;
        };
        BrushScene.prototype.onGet = function () {
            var _this = this;
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            if (this.price <= GameData.getInstance().playerData.gold) {
                GameMgr.instance.updateBaseData(Prop.Gold, -this.price);
                this.enableView(false);
                var randIndex_1 = ArrayUtil.getIndexByWeight(this.weightArr);
                this.aniArr = [];
                console.log("随机到的画笔 = ", this.lockArr[randIndex_1]);
                var len = this.curPageArr.length;
                for (var i = 0; i < len - 1; i++) {
                    var index1 = this.getIndexByRandom();
                    this.aniArr.push(index1);
                }
                this.aniArr.push(randIndex_1);
                console.log("this.aniArr ->", this.aniArr);
                this.playAnimation().then(function () {
                    _this.aniArr = [];
                    var data = _this.lockArr[randIndex_1];
                    SkinMgr.instance.unlockBrushUglify(data.id);
                    _this.refreshUIUglify();
                    _this.enableView(true);
                });
            }
            else {
                TipsManager.getInstance().showDefaultTips("金币不足");
            }
        };
        BrushScene.prototype.playAnimation = function () {
            var _this = this;
            return new Promise(function (resolve) {
                var index = 0;
                var len = _this.aniArr.length;
                var box = _this.box_brush.getChildAt(_this.curPage - 1);
                box.getChildAt(_this.aniArr[index]).showOrHideMask(true);
                Laya.timer.loop(150, _this.box_brush, function () {
                    box.getChildAt(_this.aniArr[index]).showOrHideMask(false);
                    index++;
                    if (index > len - 1) {
                        Laya.timer.clearAll(_this.box_brush);
                        resolve();
                    }
                    else {
                        box.getChildAt(_this.aniArr[index]).showOrHideMask(true);
                    }
                });
            });
        };
        BrushScene.prototype.getIndexByRandom = function () {
            var len = this.curPageArr.length;
            var index = Math.floor(Math.random() * len);
            var isHas = false;
            for (var i = 0; i < this.aniArr.length; i++) {
                if (index == this.aniArr[i]) {
                    isHas = true;
                    break;
                }
            }
            if (!isHas) {
                return index;
            }
            else {
                return this.getIndexByRandom();
            }
        };
        BrushScene.prototype.mouseDown = function (evt) {
            if (this.isPlaying || this.maxPage == 1)
                return;
            this.box_brush.on(Laya.Event.MOUSE_UP, this, this.mouseUp);
            this.box_brush.on(Laya.Event.MOUSE_OUT, this, this.mouseUp);
            this.startX = evt.stageX;
        };
        BrushScene.prototype.mouseUp = function (evt) {
            if (this.isPlaying || !this.startX)
                return;
            this.box_brush.off(Laya.Event.MOUSE_UP, this, this.mouseUp);
            this.box_brush.off(Laya.Event.MOUSE_OUT, this, this.mouseUp);
            var a = evt.stageX - this.startX;
            this.startX = null;
            if (a > 0 && Math.abs(a) >= 100) {
                if (this.curPage == 1)
                    return;
                this.listAni(1);
            }
            else if (a < 0 && Math.abs(a) >= 100) {
                if (this.curPage == this.maxPage)
                    return;
                this.listAni(-1);
            }
        };
        BrushScene.prototype.listAni = function (direction, time) {
            if (time === void 0) { time = 300; }
            return __awaiter(this, void 0, void 0, function () {
                var _this = this;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            this.isPlaying = true;
                            this.enableView(false);
                            this.curPage += direction * -1;
                            return [4, this.refreshUIUglify()];
                        case 1:
                            _a.sent();
                            return [4, Promise.all(Array.apply(void 0, Array(this.maxPage)).map(function (v, i) {
                                    return _this.singleAni(i, direction, time);
                                }))];
                        case 2:
                            _a.sent();
                            this.refreshPageUglify();
                            this.isPlaying = false;
                            this.enableView(true);
                            return [2];
                    }
                });
            });
        };
        BrushScene.prototype.singleAni = function (index, direction, time) {
            var _this = this;
            return new Promise(function (resolve) {
                var item = _this.box_brush.getChildAt(index);
                var pos = { x: item.x + _this.distance * direction };
                Laya.Tween.to(item, pos, time, null, Laya.Handler.create(_this, function () {
                    resolve();
                }));
            });
        };
        BrushScene.prototype.useBrush = function () {
            this.refreshUIUglify();
            this.updateBrushUglify();
        };
        BrushScene.prototype.onGoldUglify = function () {
            var _this = this;
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            this.enableView(false);
            if (GameData.getInstance().videoOpen) {
                MiniManeger.instance.playViderAd({
                    successFun: function () {
                        GameMgr.instance.updateBaseData(Prop.Gold, GameData.getInstance().defaultConfigs.videoBuyGold);
                        _this.enableView(true);
                    },
                    failFun: function () {
                        _this.enableView(true);
                    },
                    errorFun: function () {
                        _this.enableView(true);
                    }
                });
            }
            else {
                MiniManeger.instance.shareAppMessage({
                    sucFun: function () {
                        GameMgr.instance.updateBaseData(Prop.Gold, GameData.getInstance().defaultConfigs.videoBuyGold);
                        _this.enableView(true);
                    },
                    failFun: function () {
                        _this.enableView(true);
                    }
                });
            }
        };
        BrushScene.prototype.onCloseUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            this.removeSelf();
        };
        BrushScene.prototype.childrenCreated = function () {
            _super.prototype.childrenCreated.call(this);
            DeviceUtil.adaptationBgImg(this.img_bg);
            this.box_brush.scrollRect = new Laya.Rectangle(0, 0, 773, 700);
            if (GameData.getInstance().videoOpen) {
                this.btn_gold.getChildByName("icon").skin = "resource/assets/imgs/public/game_icon_4.png";
            }
            else {
                this.btn_gold.getChildByName("icon").skin = "resource/assets/imgs/public/settlement_icon_5.png";
            }
        };
        BrushScene.prototype.addEvent = function () {
            this.btn_get.on(Laya.Event.CLICK, this, this.onGet);
            this.btn_gold.on(Laya.Event.CLICK, this, this.onGoldUglify);
            this.btn_close.on(Laya.Event.CLICK, this, this.onCloseUglify);
            this.box_brush.on(Laya.Event.MOUSE_DOWN, this, this.mouseDown);
            EventMgr.getInstance().addEvent(GameEvent.USE_BRUSH, this, this.useBrush);
        };
        return BrushScene;
    }(PopBaseScene));

    var HomeScene = (function (_super) {
        __extends(HomeScene, _super);
        function HomeScene() {
            var _this = _super.call(this) || this;
            _this.className_key = "HomeScene";
            _this.skin = "skins/uiView/HomeView.json";
            return _this;
        }
        HomeScene.prototype.rollBgUglify = function () {
            var _this = this;
            Laya.timer.loop(50, this.box_bg, function () {
                for (var i = 0; i < 3; i++) {
                    var img = _this.box_bg.getChildAt(i);
                    img.y -= 5;
                }
                var start = _this.box_bg.getChildAt(0);
                var end = _this.box_bg.getChildAt(2);
                if (start.y <= -1920) {
                    _this.box_bg.removeChild(start);
                    start.y = end.y + 1920;
                    _this.box_bg.addChild(start);
                }
            });
        };
        HomeScene.prototype.showAniUglify = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _a;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            if (!!this.mainSke) return [3, 2];
                            _a = this;
                            return [4, AnimationManager.instance.creatBoonAnimation("resource/assets/db/mianinterface.sk")];
                        case 1:
                            _a.mainSke = _b.sent();
                            this.box_ani.addChild(this.mainSke);
                            this.mainSke.scale(2, 2);
                            this.mainSke.pos(540, 400);
                            _b.label = 2;
                        case 2:
                            this.mainSke.play(0, true);
                            return [2];
                    }
                });
            });
        };
        HomeScene.prototype.onPowerUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            EventMgr.getInstance().sendEvent(GameEvent.BUFFER_LOAD, true);
            ResUtil.getIntance().loadGroups(["power"], function () {
                EventMgr.getInstance().sendEvent(GameEvent.BUFFER_LOAD, false);
                ViewManager.getInstance().showView(PowerScene);
            });
        };
        HomeScene.prototype.onSignUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            EventMgr.getInstance().sendEvent(GameEvent.BUFFER_LOAD, true);
            ResUtil.getIntance().loadGroups(["sign"], function () {
                EventMgr.getInstance().sendEvent(GameEvent.BUFFER_LOAD, false);
                ViewManager.getInstance().showView(SignScene);
            });
        };
        HomeScene.prototype.onStartUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            var modelId = GameData.getInstance().modelId;
            var classData;
            switch (modelId) {
                case 0:
                    classData = { type: 1 };
                    break;
            }
            EventMgr.getInstance().sendEvent(GameEvent.CHOOSE_MODEL, { type: modelId, data: classData });
        };
        HomeScene.prototype.onSkinUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            EventMgr.getInstance().sendEvent(GameEvent.BUFFER_LOAD, true);
            ResUtil.getIntance().loadGroups(["skin2"], function () {
                EventMgr.getInstance().sendEvent(GameEvent.BUFFER_LOAD, false);
                ViewManager.getInstance().showView(BrushScene, { type: 1 });
            });
        };
        HomeScene.prototype.removeEvent = function () {
            this.btn_power.off(Laya.Event.CLICK, this, this.onPowerUglify);
            this.btn_sign.off(Laya.Event.CLICK, this, this.onSignUglify);
            this.btn_start.off(Laya.Event.CLICK, this, this.onStartUglify);
            this.btn_skin.off(Laya.Event.CLICK, this, this.onSkinUglify);
        };
        HomeScene.prototype.addEvent = function () {
            this.btn_power.on(Laya.Event.CLICK, this, this.onPowerUglify);
            this.btn_sign.on(Laya.Event.CLICK, this, this.onSignUglify);
            this.btn_start.on(Laya.Event.CLICK, this, this.onStartUglify);
            this.btn_skin.on(Laya.Event.CLICK, this, this.onSkinUglify);
        };
        HomeScene.prototype.onRemoved = function () {
            _super.prototype.onRemoved.call(this);
            this.removeEvent();
            Laya.Tween.clearAll(this.btn_start);
            Laya.timer.clearAll(this.box_bg);
            this.mainSke && this.mainSke.stop();
        };
        HomeScene.prototype.initView = function () {
            MiniManeger.instance.showBannerAd(null);
            SoundManager.instance.playBgMusic(SoundConst.GameBgm2);
            EventMgr.getInstance().sendEvent(GameEvent.SHOW_TOP);
            AnimationManager.instance.btnScaleAniLoop(this.btn_start, this);
            this.rollBgUglify();
            this.showAniUglify();
        };
        HomeScene.prototype.onAddStage = function () {
            _super.prototype.onAddStage.call(this);
            if (this.isCreate) {
                this.initView();
                this.addEvent();
            }
        };
        HomeScene.prototype.childrenCreated = function () {
            _super.prototype.childrenCreated.call(this);
            ResUtil.getIntance().loadGroups(["reward"], function () {
                console.log("懒加载完成");
            });
            if (GameData.getInstance().isConVersion) {
                this.btn_power.visible = this.btn_sign.visible = false;
            }
            if (DeviceUtil.isMZMiniGame() || DeviceUtil.isNative()) {
                this.img_title.skin = "resource/assets/imgs/home/main/mianinterface_logo_1.png";
            }
            else {
                this.img_title.skin = "resource/assets/imgs/home/main/mianinterface_logo_1_1.png";
            }
        };
        return HomeScene;
    }(BaseSceneUISkin));

    var SettlementScene2 = (function (_super) {
        __extends(SettlementScene2, _super);
        function SettlementScene2(data) {
            var _this = _super.call(this) || this;
            _this.className_key = "SettlementScene2";
            _this.showEnterType = null;
            _this.viewData_ = data;
            _this.skin = "skins/game/type2/SettlementView2.json";
            return _this;
        }
        SettlementScene2.prototype.removeEvent = function () {
            this.btn_home.off(Laya.Event.CLICK, this, this.onHomeUglify);
            this.box_double.off(Laya.Event.CLICK, this, this.onSelect);
            this.btn_restart.off(Laya.Event.CLICK, this, this.onRestartUglify);
            this.btn_get.off(Laya.Event.CLICK, this, this.onGetUglify);
            this.btn_shareVideo.off(Laya.Event.CLICK, this, this.onShareVideo);
            this.btn_next.off(Laya.Event.CLICK, this, this.onNextUglify);
        };
        SettlementScene2.prototype.onRemoved = function () {
            _super.prototype.onRemoved.call(this);
            this.removeEvent();
            EventMgr.getInstance().sendEvent(GameEvent.HIDE_TOP);
            this.viewData_ = null;
        };
        SettlementScene2.prototype.initView = function () {
            return __awaiter(this, void 0, void 0, function () {
                var data, _a;
                var _this = this;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            this.hideBanner();
                            EventMgr.getInstance().sendEvent(GameEvent.SHOW_TOP);
                            EventMgr.getInstance().sendEvent(GameEvent.CHANGE_POS, { _x: 30, _y: 30 });
                            SoundManager.instance.playEffect(SoundConst.Win2);
                            if (!this.viewData_)
                                return [2];
                            data = this.viewData_;
                            this.btn_get.visible = true;
                            this.btn_restart.visible = this.btn_next.visible = false;
                            this.lab_award.text = "+" + GameData.getInstance().defaultConfigs.passGold2;
                            if (DeviceUtil.isTTMiniGame()) {
                                this.btn_shareVideo.visible = true;
                                this.btn_shareVideo.disabled = false;
                                this.btn_get.centerX = -220;
                            }
                            else {
                                this.btn_shareVideo.visible = false;
                                this.btn_get.centerX = 0;
                            }
                            if (GameData.getInstance().isConVersion || !GameData.getInstance().videoOpen) {
                                this.showDouble(false);
                                this.box_double.visible = false;
                            }
                            else {
                                this.box_double.visible = true;
                                this.showDouble(GameData.getInstance().selectDoule);
                            }
                            _a = this;
                            return [4, PatternMgr.instance.updateLevelUglify({ pattern: 103, curLv: data.level })];
                        case 1:
                            _a.nextId = _b.sent();
                            if (!(DeviceUtil.isMZMiniGame() && GameData.getInstance().touchByMistake)) return [3, 3];
                            this.box_double.y = 46;
                            this.box_bottom.bottom = 150;
                            return [4, MiniManeger.instance.createBanner()];
                        case 2:
                            _b.sent();
                            Laya.timer.once(1000, this, function () {
                                MiniManeger.instance.showBannerAdSp();
                                Laya.Tween.to(_this.box_bottom, { bottom: 400 }, 500);
                            });
                            return [3, 4];
                        case 3:
                            this.box_double.y = 0;
                            this.box_bottom.bottom = 400;
                            this.showBanner();
                            _b.label = 4;
                        case 4:
                            this.showLevelAniUglify();
                            this.showAniUglify();
                            return [2];
                    }
                });
            });
        };
        SettlementScene2.prototype.showLevelAniUglify = function () {
            var _this = this;
            var lv = this.nextId;
            if (this.viewData_.level == lv) {
                this.lab_tip.visible = true;
                this.box_lvAni.visible = false;
            }
            else {
                this.lab_tip.visible = false;
                var url = "resource/assets/imgs/levels/type2/" + lv + "/level" + lv + ".sk";
                if (!this.levelSke) {
                    this.levelSke = new Laya.Skeleton();
                    this.box_lvAni.addChild(this.levelSke);
                }
                this.levelSke.load(url, Laya.Handler.create(this, function () {
                    if (!_this.levelSke.player)
                        return;
                    _this.levelSke.player.playbackRate = 1;
                    _this.levelSke.scale(1, 1);
                    _this.levelSke.pos(390, 330);
                    _this.box_lvAni.visible = true;
                    _this.levelSke.play(0, true);
                }));
            }
        };
        SettlementScene2.prototype.showAniUglify = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _a;
                var _this = this;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            if (!!this.succSke) return [3, 2];
                            _a = this;
                            return [4, AnimationManager.instance.creatBoonAnimation("resource/assets/db/victory1.sk")];
                        case 1:
                            _a.succSke = _b.sent();
                            this.box_ani.addChild(this.succSke);
                            this.succSke.scale(2, 2);
                            this.succSke.pos(540, 400);
                            _b.label = 2;
                        case 2:
                            this.box_ani.visible = true;
                            this.succSke.player.once(Laya.Event.STOPPED, this, function () {
                                _this.box_ani.visible = false;
                            });
                            this.succSke.play(0, false);
                            return [2];
                    }
                });
            });
        };
        SettlementScene2.prototype.onHomeUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            EventMgr.getInstance().sendEvent(GameEvent.OPEN_SCENE, { name: "HomeScene" });
            this.removeSelf();
        };
        SettlementScene2.prototype.onSelect = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            if (this.img_select.visible) {
                this.showDouble(false);
            }
            else {
                this.showDouble(true);
            }
        };
        SettlementScene2.prototype.showDouble = function (show) {
            this.img_select.visible = show;
            var mult = show ? 2 : 1;
            this.lab_award.text = "+" + GameData.getInstance().defaultConfigs.passGold1 * mult;
        };
        SettlementScene2.prototype.onGetUglify = function () {
            var _this = this;
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            if (this.img_select.visible) {
                this.enableView(false);
                MiniManeger.instance.playViderAd({
                    successFun: function () {
                        _this.getAwardUglify(2);
                        _this.enableView(true);
                    },
                    failFun: function () {
                        _this.enableView(true);
                    },
                    errorFun: function () {
                        _this.enableView(true);
                    }
                });
            }
            else {
                this.getAwardUglify(1);
            }
        };
        SettlementScene2.prototype.getAwardUglify = function (mult) {
            GameMgr.instance.updateBaseData(Prop.Gold, GameData.getInstance().defaultConfigs.passGold1 * mult);
            this.btn_get.visible = this.box_double.visible = false;
            this.btn_shareVideo.visible = false;
            this.btn_restart.visible = this.btn_next.visible = true;
        };
        SettlementScene2.prototype.onRestartUglify = function () {
            var _this = this;
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            if (DeviceUtil.isMZMiniGame()) {
                this.enableView(false);
                MiniManeger.instance.showInsertAd({
                    successFun: function () {
                    },
                    closeFun: function () {
                        _this.enableView(true);
                        _this.restartFun();
                    },
                    errorFun: function () {
                        _this.enableView(true);
                        _this.restartFun();
                    }
                });
            }
            else {
                this.restartFun();
            }
        };
        SettlementScene2.prototype.restartFun = function () {
            var _this = this;
            PowerMgr.instance.changePowerUglify({
                count: -GameData.getInstance().defaultConfigs.powerCost,
                success: function () {
                    EventMgr.getInstance().sendEvent(GameEvent.Type2Restart);
                    EventMgr.getInstance().sendEvent(GameEvent.HIDE_TOP);
                    _this.removeSelf();
                }
            });
        };
        SettlementScene2.prototype.onShareVideo = function () {
            var _this = this;
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            this.enableView(false);
            MiniManeger.instance.shareGameVideo({
                successFun: function () {
                    GameData.getInstance().playerData.shareVideoCount += 1;
                    GameMgr.instance.updateBaseData(Prop.Gold, GameData.getInstance().defaultConfigs.shareRecordAward);
                    _this.btn_shareVideo.disabled = true;
                    _this.enableView(true);
                },
                failFun: function () {
                    _this.enableView(true);
                },
                errorFun: function () {
                    _this.enableView(true);
                }
            });
        };
        SettlementScene2.prototype.onNextUglify = function () {
            var _this = this;
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            if (DeviceUtil.isMZMiniGame()) {
                this.enableView(false);
                MiniManeger.instance.showInsertAd({
                    successFun: function () {
                    },
                    closeFun: function () {
                        _this.enableView(true);
                        _this.nextFun();
                    },
                    errorFun: function () {
                        _this.enableView(true);
                        _this.nextFun();
                    }
                });
            }
            else {
                this.nextFun();
            }
        };
        SettlementScene2.prototype.nextFun = function () {
            var _this = this;
            PowerMgr.instance.changePowerUglify({
                count: -GameData.getInstance().defaultConfigs.powerCost,
                success: function () {
                    EventMgr.getInstance().sendEvent(GameEvent.Type2Next, { level: _this.nextId });
                    _this.removeSelf();
                }
            });
        };
        SettlementScene2.prototype.childrenCreated = function () {
            _super.prototype.childrenCreated.call(this);
            DeviceUtil.adaptationBgImg(this.img_bg);
            this.box_lvAni.scrollRect = new Laya.Rectangle(0, 0, 770, 650);
        };
        SettlementScene2.prototype.addEvent = function () {
            this.btn_home.on(Laya.Event.CLICK, this, this.onHomeUglify);
            this.box_double.on(Laya.Event.CLICK, this, this.onSelect);
            this.btn_restart.on(Laya.Event.CLICK, this, this.onRestartUglify);
            this.btn_get.on(Laya.Event.CLICK, this, this.onGetUglify);
            this.btn_shareVideo.on(Laya.Event.CLICK, this, this.onShareVideo);
            this.btn_next.on(Laya.Event.CLICK, this, this.onNextUglify);
        };
        return SettlementScene2;
    }(PopBaseScene));

    var Type2GameLineToolMgr = (function () {
        function Type2GameLineToolMgr() {
            this.gestureUtil = new ur.DollarRecognizer();
            this.curentLinesPoints = [];
        }
        Type2GameLineToolMgr.getInstance = function () {
            if (!Type2GameLineToolMgr.instance) {
                Type2GameLineToolMgr.instance = new Type2GameLineToolMgr();
            }
            return Type2GameLineToolMgr.instance;
        };
        Type2GameLineToolMgr.prototype.dressingPoints = function (points) {
            if (points.length / 2 > 120) {
                for (var i = 0, len = points.length / 2; i < len; i++) {
                    if (i % 2 == 1) {
                        points.splice(i * 2, 2);
                        i--;
                        len--;
                    }
                }
            }
        };
        Type2GameLineToolMgr.prototype.addLinesPoints = function (templatLinesPoints) {
            this.clearCurentLinesPoints();
            console.log("增加模板数据--", templatLinesPoints);
            var points = [];
            for (var i = 0, len = templatLinesPoints.length; i < len; i++) {
                points = points.concat(templatLinesPoints[i].points);
            }
            this.addOneLinePoints(points);
        };
        Type2GameLineToolMgr.prototype.addOneLinePoints = function (points) {
            if (points.length < 4) {
                console.log("插入标准线段数据过少---");
                return;
            }
            var urPoints = [];
            for (var i = 0, len = points.length / 2; i < len; i++) {
                var urPoint = new ur.Point(points[i * 2], points[i * 2 + 1]);
                urPoints.push(urPoint);
            }
            var name = "level_temp_" + this.curentLinesPoints.length;
            var itemLine = new LinePoints();
            itemLine.name = name;
            itemLine.points = points;
            this.curentLinesPoints.push(itemLine);
            this.gestureUtil.AddGesture(name, urPoints);
        };
        Type2GameLineToolMgr.prototype.clearCurentLinesPoints = function () {
            this.curentLinesPoints = [];
        };
        Type2GameLineToolMgr.prototype.checkAllLinesPoints = function (checkLinesPoints, checkTypeScore) {
            if (checkTypeScore === void 0) { checkTypeScore = 0.1; }
            var points = [];
            for (var i = 0, len = checkLinesPoints.length; i < len; i++) {
                points = points.concat(checkLinesPoints[i].points);
            }
            console.log("点 >>>", JSON.stringify(points));
            var result = this.checkOneLine(points);
            console.log("result >>>", result);
            return result.Score >= checkTypeScore ? true : false;
        };
        Type2GameLineToolMgr.prototype.checkOneLine = function (points) {
            var urPoints = [];
            for (var i = 0, len = points.length / 2; i < len; i++) {
                var urPoint = new ur.Point(points[i * 2], points[i * 2 + 1]);
                urPoints.push(urPoint);
            }
            var result = this.gestureUtil.Recognize(urPoints, false);
            console.log(result.Name, result.Score, result.Time);
            return result;
        };
        Type2GameLineToolMgr.prototype.toGrayBinary = function (pixels, binary, value, sn) {
            var r, g, b, avg = 0, len = pixels.length, s = '';
            for (var i = 0; i < len; i += 4) {
                avg += (.299 * pixels[i] + .587 * pixels[i + 1] + .114 * pixels[i + 2]);
            }
            avg /= (len / 4);
            for (var i = 0; i < len; i += 4) {
                r = .299 * pixels[i];
                g = .587 * pixels[i + 1];
                b = .114 * pixels[i + 2];
                if (binary) {
                    if ((r + g + b) >= (value || avg)) {
                        g = 255;
                        if (sn)
                            s += '1';
                    }
                    else {
                        g = 0;
                        if (sn)
                            s += '0';
                    }
                    g = (r + g + b) > (value || avg) ? 255 : 0;
                }
                else {
                    g = r + g + b;
                }
                pixels[i] = g, pixels[i + 1] = g, pixels[i + 2] = g;
            }
            if (sn)
                return s;
            else
                return pixels;
        };
        Type2GameLineToolMgr.prototype.searchTexture = function (texture1, texture2) {
            var data1 = texture1.getPixels(0, 0, texture1.width, texture1.height);
            data1 = this.toGrayBinary(data1, true, null, false);
            console.log("data1", data1);
            var data2 = texture2.getPixels(0, 0, texture2.width, texture2.height);
            data2 = this.toGrayBinary(data2, true, null, false);
            console.log("data2", data2);
            var tw = texture1.width, th = texture1.height;
            var similar = 0;
            for (var i = 0, len = tw * th; i < len; i++) {
                if (data2[i] == data1[i])
                    similar++;
            }
            similar = (similar / (tw * th)) * 100;
            console.log("匹配比例：", similar);
            return similar;
        };
        Type2GameLineToolMgr.prototype.searchTexture1 = function (texture1, texture2) {
            var drawPixels = texture1.getPixels(0, 0, texture1.width, texture1.height);
            console.log("draw Pixels", drawPixels);
            var imgPixels = texture2.getPixels(0, 0, texture2.width, texture2.height);
            console.log("img Pixels", imgPixels);
            var tw = texture1.width, th = texture1.height;
            var similar = 0;
            var r = 0, g = 0, b = 0, a = 0;
            var r1 = 0, g1 = 0, b1 = 0, a1 = 0;
            for (var i = 0, len = tw * th * 4; i < len; i += 4) {
                r += drawPixels[i];
                g += drawPixels[i + 1];
                b += drawPixels[i + 2];
                a += drawPixels[i + 3];
                r1 += imgPixels[i];
                g1 += imgPixels[i + 1];
                b1 += imgPixels[i + 2];
                a1 += imgPixels[i + 3];
                var rgba1 = "" + drawPixels[i] + drawPixels[i + 1] + drawPixels[i + 2] + drawPixels[i + 3];
                var rgba2 = "" + imgPixels[i] + imgPixels[i + 1] + imgPixels[i + 2] + imgPixels[i + 3];
                if (rgba1 == rgba2)
                    similar++;
            }
            var ratio = (similar / (tw * th)) * 100;
            console.log("rgba draw：", r, g, b, a);
            console.log("rgba img：", r1, g1, b1, a1);
            console.log("匹配比例：", similar, ratio, tw * th);
            return ratio;
        };
        Type2GameLineToolMgr.prototype.test = function (parent) {
            var _this = this;
            Laya.loader.load("resource/assets/imgs/levels/type2/1/lv_1.png", Laya.Handler.create(this, function (texture1) {
                Laya.loader.load("resource/assets/imgs/levels/type2/2/lv_2.png", Laya.Handler.create(_this, function (texture2) {
                    var data1 = texture1.getPixels(0, 0, 256, 239);
                    var data2 = texture2.getPixels(0, 0, 256, 239);
                    var tw = 256, th = 239;
                    var similar = 0;
                    var r = 0, g = 0, b = 0, a = 0;
                    var r1 = 0, g1 = 0, b1 = 0, a1 = 0;
                    for (var i = 0, len = tw * th * 4; i < len; i += 4) {
                        r += data1[i];
                        g += data1[i + 1];
                        b += data1[i + 2];
                        a += data1[i + 3];
                        r1 += data2[i];
                        g1 += data2[i + 1];
                        b1 += data2[i + 2];
                        a1 += data2[i + 3];
                        var rgba1 = "" + data1[i] + data1[i + 1] + data1[i + 2] + data1[i + 3];
                        var rgba2 = "" + data2[i] + data2[i + 1] + data2[i + 2] + data2[i + 3];
                        if (rgba1 == rgba2)
                            similar++;
                    }
                    var ratio = (similar / (tw * th)) * 100;
                    console.log("rgba draw：", r, g, b, a);
                    console.log("rgba img：", r1, g1, b1, a1);
                    console.log("匹配比例：", similar, ratio, tw * th);
                }), null, Laya.Loader.TEXTURE2D);
            }), null, Laya.Loader.TEXTURE2D);
        };
        return Type2GameLineToolMgr;
    }());
    var LinePoints = (function () {
        function LinePoints() {
        }
        return LinePoints;
    }());

    var TipScene2 = (function (_super) {
        __extends(TipScene2, _super);
        function TipScene2(data) {
            var _this = _super.call(this) || this;
            _this.className_key = "TipScene2";
            _this.viewData_ = data;
            _this.skin = "skins/game/type2/TipView2.json";
            return _this;
        }
        TipScene2.prototype.removeEvent = function () {
            this.btn_close.off(Laya.Event.CLICK, this, this.onCloseUglify);
        };
        TipScene2.prototype.onRemoved = function () {
            _super.prototype.onRemoved.call(this);
            this.removeEvent();
            this.viewData_ = null;
        };
        TipScene2.prototype.onCloseUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            this.removeSelf();
        };
        TipScene2.prototype.childrenCreated = function () {
            _super.prototype.childrenCreated.call(this);
        };
        TipScene2.prototype.addEvent = function () {
            this.btn_close.on(Laya.Event.CLICK, this, this.onCloseUglify);
        };
        TipScene2.prototype.initView = function () {
            if (!this.viewData_)
                return;
            var data = this.viewData_;
            this.img_tips.skin = "resource/assets/imgs/levels/type2/" + data.level + "/lv_" + data.level + ".png";
        };
        return TipScene2;
    }(PopBaseScene));

    var GameSceneType2 = (function (_super) {
        __extends(GameSceneType2, _super);
        function GameSceneType2(data) {
            var _this = _super.call(this) || this;
            _this.className_key = "GameSceneType2";
            _this.playSound = false;
            _this.isSuccess = false;
            _this.isEnd = false;
            _this.currentAllPoints = [];
            _this.curentLineColor = "#ff0000";
            _this.deltaY = 0;
            _this.deltaX = 0;
            _this.viewData_ = data;
            _this.skin = "levels/type2/Type2GameScene.json";
            return _this;
        }
        GameSceneType2.prototype.removeEvent = function () {
            this.btn_back.off(Laya.Event.CLICK, this, this.onBackUglify);
            this.btn_skin.off(Laya.Event.CLICK, this, this.onSkinUglify);
            this.btn_clear.off(Laya.Event.CLICK, this, this.onClearUglify);
            this.btn_tip.off(Laya.Event.CLICK, this, this.onTipUglify);
            this.btn_pass.off(Laya.Event.CLICK, this, this.onPassUglify);
            this.box_draw.off(Laya.Event.CLICK, this, this.onDraw);
            EventMgr.getInstance().removeEvent(GameEvent.USE_BRUSH, this, this.updateBrush);
            EventMgr.getInstance().removeEvent(GameEvent.Type2Next, this, this.onNextUglify);
            EventMgr.getInstance().removeEvent(GameEvent.Type2Restart, this, this.onRestartUglify);
        };
        GameSceneType2.prototype.onRemoved = function () {
            _super.prototype.onRemoved.call(this);
            this.removeEvent();
            this.viewData_ = null;
            this.clearUglify();
            if (this.levelSke) {
                this.levelSke.offAll();
                this.levelSke.removeSelf();
                this.levelSke = null;
            }
            if (this.starSke) {
                this.starSke.offAll();
                this.starSke.removeSelf();
                this.starSke = null;
            }
        };
        GameSceneType2.prototype.initView = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            this.mouseEnabled = true;
                            if (!this.grpDraw) {
                                this.grpDraw = new Laya.Sprite();
                                this.img_baseBoard.addChild(this.grpDraw);
                            }
                            this.img_baseBoard.visible = false;
                            this.grpDraw.visible = false;
                            this.deltaY = (Laya.stage.height - 1044 - 60);
                            this.deltaX = (Laya.stage.width - 1036) / 2;
                            this.clearUglify();
                            return [4, this.updateLevel()];
                        case 1:
                            _a.sent();
                            this.addTemplate();
                            this.updateBrush();
                            return [2];
                    }
                });
            });
        };
        GameSceneType2.prototype.addTemplate = function () {
            this.registPointsUglify();
            Laya.stage.on(Laya.Event.MOUSE_DOWN, this, this.onMouseDownUglify);
        };
        GameSceneType2.prototype.registPointsUglify = function () {
            Type2GameLineToolMgr.getInstance().addLinesPoints([{ name: "templat_0", points: this.levelConf.points }]);
        };
        GameSceneType2.prototype.updateBrush = function () {
            return __awaiter(this, void 0, void 0, function () {
                var data;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, SkinMgr.instance.getCurBrushDataUglify()];
                        case 1:
                            data = _a.sent();
                            if (!data)
                                return [2];
                            this.img_baseBoard.skin = "resource/assets/imgs/game/type2/brushs/" + data.icon + ".png";
                            return [2];
                    }
                });
            });
        };
        GameSceneType2.prototype.updateLevel = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _a;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            _a = this;
                            return [4, ConfigManager.instance.getLevelConf2(this.viewData_.level)];
                        case 1:
                            _a.levelConf = _b.sent();
                            console.log("关卡配置", this.levelConf);
                            this.lab_level.text = "关卡" + this.viewData_.level;
                            this.lab_title.text = this.levelConf.title;
                            this.showLevelAni();
                            return [2];
                    }
                });
            });
        };
        GameSceneType2.prototype.showLevelAni = function () {
            var _this = this;
            var url = "resource/assets/imgs/levels/type2/" + this.viewData_.level + "/level" + this.viewData_.level + ".sk";
            if (!this.levelSke) {
                this.levelSke = new Laya.Skeleton();
                this.box_ani.addChild(this.levelSke);
            }
            this.levelSke.load(url, Laya.Handler.create(this, function () {
                if (!_this.levelSke.player)
                    return;
                _this.levelSke.player.playbackRate = 1;
                _this.levelSke.scale(_this.levelConf.idle.scaleX, _this.levelConf.idle.scaleY);
                _this.levelSke.pos(_this.levelConf.idle.x, _this.levelConf.idle.y);
                _this.box_ani.visible = true;
                _this.levelSke.play(_this.levelConf.idle.name, _this.levelConf.idle.loop);
            }));
        };
        GameSceneType2.prototype.showStarAni = function () {
            var _this = this;
            return new Promise(function (resolve) { return __awaiter(_this, void 0, void 0, function () {
                var _a;
                var _this = this;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            if (!!this.starSke) return [3, 2];
                            _a = this;
                            return [4, AnimationManager.instance.creatBoonAnimation("resource/assets/imgs/levels/type2/type2_star.sk")];
                        case 1:
                            _a.starSke = _b.sent();
                            if (!this.starSke)
                                resolve();
                            _b.label = 2;
                        case 2:
                            this.box_ani.addChild(this.starSke);
                            this.starSke.pos(this.levelConf.star.x, this.levelConf.star.y);
                            this.starSke.player.once(Laya.Event.STOPPED, this, function () {
                                _this.starSke.visible = false;
                                _this.starSke.removeSelf();
                                resolve();
                            });
                            this.starSke.visible = true;
                            this.starSke.play(0, false);
                            return [2];
                    }
                });
            }); });
        };
        GameSceneType2.prototype.clearUglify = function () {
            this.btn_pass.visible = false;
            Laya.Tween.clearAll(this.btn_pass);
            this.btn_pass.scale(1, 1);
            this.btn_back.visible = this.btn_skin.visible = this.btn_tip.visible = this.btn_clear.visible = true;
            this.currDraw = null;
            this.grpDraw.removeChildren();
            this.currentAllPoints = [];
            this.img_baseBoard.visible = false;
            this.img_baseBoard.mask = null;
            this.timer.clearAll(this);
            this.lab_tip.text = "";
            this.isSuccess = false;
            this.isEnd = false;
        };
        GameSceneType2.prototype.onMouseDownUglify = function (evt) {
            if (evt.target != this.box_draw)
                return;
            this.timer.clearAll(this);
            if (!this.isSuccess)
                this.lab_tip.text = "绘图中";
            this.currentPoints = [];
            this.currentPoints.push(evt.stageX - this.deltaX);
            this.currentPoints.push(evt.stageY - this.deltaY);
            this.currDraw = new Laya.Sprite();
            this.grpDraw.addChild(this.currDraw);
            this.drawLinesUglify();
            this.img_baseBoard.visible = true;
            this.img_baseBoard.mask = this.grpDraw;
            Laya.stage.on(Laya.Event.MOUSE_MOVE, this, this.onMouseMoveUglify);
            Laya.stage.on(Laya.Event.MOUSE_UP, this, this.onMouseUpUglify);
            Laya.stage.on(Laya.Event.MOUSE_OUT, this, this.onMouseUpUglify);
        };
        GameSceneType2.prototype.onMouseMoveUglify = function (evt) {
            if (evt.target != this.box_draw)
                return;
            if (!this.playSound) {
                this.playSound = true;
                SoundManager.instance.playEffect(SoundConst.Huaxian);
            }
            this.currentPoints.push(evt.stageX - this.deltaX);
            this.currentPoints.push(evt.stageY - this.deltaY);
            this.drawLinesUglify();
        };
        GameSceneType2.prototype.drawLinesUglify = function () {
            this.grpDraw.graphics.clear();
            this.currDraw.graphics.clear();
            this.currDraw.graphics.drawLines(0, 0, this.currentPoints, this.curentLineColor, 10);
        };
        GameSceneType2.prototype.onMouseUpUglify = function (evt) {
            Laya.stage.off(Laya.Event.MOUSE_MOVE, this, this.onMouseMoveUglify);
            Laya.stage.off(Laya.Event.MOUSE_UP, this, this.onMouseUpUglify);
            Laya.stage.off(Laya.Event.MOUSE_OUT, this, this.onMouseUpUglify);
            this.playSound = false;
            this.addCurrentLine();
        };
        GameSceneType2.prototype.addCurrentLine = function () {
            var itemLine = new LinePoints();
            itemLine.name = "templat_" + this.currentAllPoints.length;
            itemLine.points = this.currentPoints;
            this.currentAllPoints.push(itemLine);
            console.log("添加当前线段的数据 >>>", this.currentAllPoints);
            if (this.isSuccess) {
                this.timer.once(2000, this, this.gameOverUglify, [3]);
            }
            else {
                this.lab_tip.text = "校验中";
                this.timer.once(2000, this, this.onCheckUglify);
            }
        };
        GameSceneType2.prototype.onCheckUglify = function () {
            return __awaiter(this, void 0, void 0, function () {
                var isSuc;
                var _this = this;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            isSuc = Type2GameLineToolMgr.getInstance().checkAllLinesPoints(this.currentAllPoints, this.levelConf.perset);
                            console.log("校验 >>>", this.currentAllPoints, isSuc);
                            if (!isSuc) return [3, 2];
                            this.isSuccess = true;
                            this.lab_tip.text = "校验成功";
                            this.btn_back.visible = this.btn_skin.visible = this.btn_tip.visible = this.btn_clear.visible = false;
                            this.btn_pass.visible = true;
                            EffectUtil.showScaleFix(this.btn_pass, 1.2, 500, true);
                            return [4, this.showStarAni()];
                        case 1:
                            _a.sent();
                            this.levelSke.stop();
                            this.levelSke.player.once(Laya.Event.STOPPED, this, function () {
                                !_this.isEnd && _this.timer.once(2000, _this, _this.gameOverUglify, [2]);
                            });
                            this.levelSke.play(this.levelConf.succ.name, this.levelConf.succ.loop);
                            return [3, 3];
                        case 2:
                            this.isSuccess = false;
                            this.lab_tip.text = "校验失败";
                            _a.label = 3;
                        case 3: return [2];
                    }
                });
            });
        };
        GameSceneType2.prototype.onNextUglify = function (data) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            console.log("下一关 >>>", data);
                            EventMgr.getInstance().sendEvent(GameEvent.BUFFER_LOAD, true);
                            this.viewData_.level = data.level;
                            this.clearUglify();
                            return [4, this.updateLevel()];
                        case 1:
                            _a.sent();
                            this.addTemplate();
                            EventMgr.getInstance().sendEvent(GameEvent.BUFFER_LOAD, false);
                            this.mouseEnabled = true;
                            return [2];
                    }
                });
            });
        };
        GameSceneType2.prototype.onRestartUglify = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            console.log("重玩");
                            this.clearUglify();
                            return [4, this.updateLevel()];
                        case 1:
                            _a.sent();
                            this.addTemplate();
                            this.mouseEnabled = true;
                            return [2];
                    }
                });
            });
        };
        GameSceneType2.prototype.onBackUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            EventMgr.getInstance().sendEvent(GameEvent.OPEN_SCENE, { name: "HomeScene" });
        };
        GameSceneType2.prototype.onSkinUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            ViewManager.getInstance().showView(BrushScene, { type: 2 });
        };
        GameSceneType2.prototype.onClearUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            this.clearUglify();
        };
        GameSceneType2.prototype.onTipUglify = function () {
            var _this = this;
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            if (GameData.getInstance().videoOpen) {
                MiniManeger.instance.playViderAd({
                    successFun: function () {
                        ViewManager.getInstance().showView(TipScene2, { level: _this.viewData_.level });
                    },
                    failFun: function () {
                    },
                    errorFun: function () {
                    }
                });
            }
            else {
                MiniManeger.instance.shareAppMessage({
                    sucFun: function () {
                        ViewManager.getInstance().showView(TipScene2, { level: _this.viewData_.level });
                    },
                    failFun: function () {
                    }
                });
            }
        };
        GameSceneType2.prototype.onPassUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            this.gameOverUglify(1);
        };
        GameSceneType2.prototype.gameOverUglify = function (id) {
            console.log("游戏结束", id);
            this.isEnd = true;
            this.timer.clearAll(this);
            this.mouseEnabled = false;
            Laya.stage.off(Laya.Event.MOUSE_DOWN, this, this.onMouseDownUglify);
            EventMgr.getInstance().sendEvent(GameEvent.Type2GameOver, { level: this.viewData_.level });
            this.box_ani.visible = false;
            GameInfoManager.getInstance().saveLevelDataById(this.viewData_.level, this.currentAllPoints);
        };
        GameSceneType2.prototype.onDraw = function () {
        };
        GameSceneType2.prototype.childrenCreated = function () {
            _super.prototype.childrenCreated.call(this);
            DeviceUtil.adaptationBgImg(this.img_bg);
            if (DeviceUtil.getIsIphoneX()) {
                this.btn_back.top += GameData.getInstance().fullScreenOffSet;
                this.lab_level.top += GameData.getInstance().fullScreenOffSet;
            }
            if (GameData.getInstance().isConVersion) {
                this.btn_tip.visible = this.btn_skin.visible = false;
            }
            if (GameData.getInstance().videoOpen) {
                this.btn_tip.getChildByName("icon").skin = "resource/assets/imgs/public/game_icon_4.png";
            }
            else {
                this.btn_tip.getChildByName("icon").skin = "resource/assets/imgs/public/settlement_icon_5.png";
            }
        };
        GameSceneType2.prototype.onAddStage = function () {
            _super.prototype.onAddStage.call(this);
            if (this.isCreate) {
                this.addEvent();
            }
        };
        GameSceneType2.prototype.setData = function (data) {
            this.viewData_ = data;
            if (this.isCreate) {
                this.initView();
            }
        };
        GameSceneType2.prototype.addEvent = function () {
            this.btn_back.on(Laya.Event.CLICK, this, this.onBackUglify);
            this.btn_skin.on(Laya.Event.CLICK, this, this.onSkinUglify);
            this.btn_clear.on(Laya.Event.CLICK, this, this.onClearUglify);
            this.btn_tip.on(Laya.Event.CLICK, this, this.onTipUglify);
            this.btn_pass.on(Laya.Event.CLICK, this, this.onPassUglify);
            this.box_draw.on(Laya.Event.CLICK, this, this.onDraw);
            EventMgr.getInstance().addEvent(GameEvent.USE_BRUSH, this, this.updateBrush);
            EventMgr.getInstance().addEvent(GameEvent.Type2Next, this, this.onNextUglify);
            EventMgr.getInstance().addEvent(GameEvent.Type2Restart, this, this.onRestartUglify);
        };
        return GameSceneType2;
    }(BaseSceneUISkin));

    var ChooseItem2 = (function (_super) {
        __extends(ChooseItem2, _super);
        function ChooseItem2(_data) {
            var _this = _super.call(this) || this;
            _this.className_key = "ChooseItem2";
            _this.viewData_ = _data;
            _this.skin = "skins/game/type2/choose/ChooseItem2.json";
            return _this;
        }
        ChooseItem2.prototype.onRemoved = function () {
            _super.prototype.onRemoved.call(this);
            this.off(Laya.Event.CLICK, this, this.onSelect);
            this.viewData_ = null;
        };
        ChooseItem2.prototype.initView = function () {
            if (!this.viewData_)
                return;
            var data = this.viewData_;
            this.off(Laya.Event.CLICK, this, this.onSelect);
            this.img_pass.visible = this.box_draw.visible = false;
            this.lab_level.text = data.id + "";
            this.img_bg.skin = data.unlock ? "resource/assets/imgs/game/type2/chapter2/checkpoint_baseboard_3.png" : "resource/assets/imgs/game/type2/chapter2/checkpoint_baseboard_4.png";
            this.img_title.skin = data.unlock ? "resource/assets/imgs/game/type2/chapter2/checkpoint_db2.png" : "resource/assets/imgs/game/type2/chapter2/checkpoint_db1.png";
            this.img_lock.visible = !data.unlock;
            if (data.unlock) {
                if (!data.isCur) {
                    this.img_pass.visible = this.box_draw.visible = true;
                    this.drawData = GameInfoManager.getInstance().selectLevelDataById(data.id);
                    this.onDraw();
                }
                this.on(Laya.Event.CLICK, this, this.onSelect);
            }
        };
        ChooseItem2.prototype.onDraw = function () {
            var _this = this;
            if (!this.drawData)
                return;
            if (!this.sp) {
                this.sp = new Laya.Sprite();
                this.box_draw.addChild(this.sp);
            }
            else {
                this.sp.graphics.clear();
            }
            this.drawData.forEach(function (item) {
                var sx = _this.box_draw.width / 1036;
                var sy = _this.box_draw.height / 1044;
                var tempArr = [];
                for (var i = 0; i < item.points.length; i += 2) {
                    tempArr.push(Math.round(item.points[i] * sx));
                    tempArr.push(Math.round(item.points[i + 1] * sy));
                }
                _this.sp.graphics.drawLines(0, 0, tempArr, "#000000", 4);
            });
        };
        ChooseItem2.prototype.onSelect = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            EventMgr.getInstance().sendEvent(GameEvent.Type2Select, this.viewData_.id);
        };
        ChooseItem2.prototype.childrenCreated = function () {
            _super.prototype.childrenCreated.call(this);
        };
        ChooseItem2.prototype.adaptationStage = function () {
        };
        ChooseItem2.prototype.onAddStage = function () {
            if (this.isCreate) {
                this.initView();
            }
        };
        ChooseItem2.prototype.setData = function (data) {
            this.viewData_ = data;
            if (this.isCreate) {
                this.initView();
            }
        };
        return ChooseItem2;
    }(BaseSceneUISkin));

    var ChooseScene2 = (function (_super) {
        __extends(ChooseScene2, _super);
        function ChooseScene2() {
            var _this = _super.call(this) || this;
            _this.className_key = "ChooseScene2";
            _this.showEnterType = null;
            _this.curPage = 1;
            _this.maxPage = 3;
            _this.isPlaying = false;
            _this.distance = 975 + 20;
            _this.skin = "skins/game/type2/choose/ChooseView2.json";
            return _this;
        }
        ChooseScene2.prototype.removeEvent = function () {
            this.btn_last.off(Laya.Event.CLICK, this, this.onLast);
            this.btn_next.off(Laya.Event.CLICK, this, this.onNext);
            this.btn_close.off(Laya.Event.CLICK, this, this.onCloseUglify);
            this.btn_skin.off(Laya.Event.CLICK, this, this.onSkinUglify);
            this.box_level.off(Laya.Event.MOUSE_DOWN, this, this.mouseDownUglify);
            this.box_level.off(Laya.Event.MOUSE_UP, this, this.mouseUpUglify);
            this.box_level.off(Laya.Event.MOUSE_OUT, this, this.mouseUpUglify);
            EventMgr.getInstance().removeEvent(GameEvent.Type2Select, this, this.enterGameUglify);
        };
        ChooseScene2.prototype.onRemoved = function () {
            _super.prototype.onRemoved.call(this);
            this.removeEvent();
            this.levelData = null;
        };
        ChooseScene2.prototype.showInsertAd = function () {
            MiniManeger.instance.showInsertAd({
                successFun: function () {
                },
                closeFun: function () {
                },
                errorFun: function () {
                }
            });
        };
        ChooseScene2.prototype.refreshUIUglify = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _a, i, box_1, start, dataArr, box, i, len, data, item;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            if (!!this.levelData) return [3, 2];
                            _a = this;
                            return [4, PatternMgr.instance.getLevelData2Uglify()];
                        case 1:
                            _a.levelData = _b.sent();
                            this.maxPage = Math.ceil(this.levelData.length / 10);
                            for (i = 0; i < this.maxPage; i++) {
                                box_1 = this.box_level.getChildAt(i);
                                if (!box_1) {
                                    box_1 = new Laya.Box();
                                    box_1.size(975, 397);
                                    box_1.x = (975 + 20) * i;
                                    this.box_level.addChild(box_1);
                                }
                            }
                            _b.label = 2;
                        case 2:
                            start = (this.curPage - 1) * 10;
                            dataArr = this.levelData.slice(start, start + 10);
                            box = this.box_level.getChildAt(this.curPage - 1);
                            for (i = 0, len = dataArr.length; i < len; i++) {
                                data = dataArr[i];
                                item = box.getChildAt(i);
                                if (item) {
                                    item.setData(data);
                                }
                                else {
                                    item = new ChooseItem2(data);
                                    item.x = (i % 5) * (179 + 20);
                                    item.y = Math.floor(i / 5) * (180 + 37);
                                    box.addChild(item);
                                }
                            }
                            this.refreshBtnUglify();
                            this.showLevelAniUglify();
                            return [2];
                    }
                });
            });
        };
        ChooseScene2.prototype.refreshBtnUglify = function () {
            this.btn_last.disabled = this.curPage == 1;
            this.btn_next.disabled = this.curPage == this.maxPage;
        };
        ChooseScene2.prototype.showLevelAniUglify = function () {
            var _this = this;
            var lv = 1 + 10 * (this.curPage - 1);
            var url = "resource/assets/imgs/levels/type2/" + lv + "/level" + lv + ".sk";
            if (!this.levelSke) {
                this.levelSke = new Laya.Skeleton();
                this.box_ani.addChild(this.levelSke);
            }
            this.levelSke.load(url, Laya.Handler.create(this, function () {
                if (!_this.levelSke.player)
                    return;
                _this.levelSke.player.playbackRate = 1;
                _this.levelSke.scale(1, 1);
                _this.levelSke.pos(390, 330);
                _this.box_ani.visible = true;
                _this.levelSke.play(0, true);
            }));
        };
        ChooseScene2.prototype.onLast = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            this.listAni(1);
        };
        ChooseScene2.prototype.onNext = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            this.listAni(-1);
        };
        ChooseScene2.prototype.onCloseUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            this.removeSelf();
        };
        ChooseScene2.prototype.onSkinUglify = function () {
            SoundManager.instance.playEffect(SoundConst.BtnClick);
            EventMgr.getInstance().sendEvent(GameEvent.BUFFER_LOAD, true);
            ResUtil.getIntance().loadGroups(["skin2"], function () {
                EventMgr.getInstance().sendEvent(GameEvent.BUFFER_LOAD, false);
                ViewManager.getInstance().showView(BrushScene, { type: 1 });
            });
        };
        ChooseScene2.prototype.mouseDownUglify = function (evt) {
            if (this.isPlaying || this.maxPage == 1)
                return;
            this.box_level.on(Laya.Event.MOUSE_UP, this, this.mouseUpUglify);
            this.box_level.on(Laya.Event.MOUSE_OUT, this, this.mouseUpUglify);
            this.startX = evt.stageX;
        };
        ChooseScene2.prototype.mouseUpUglify = function (evt) {
            if (this.isPlaying || !this.startX)
                return;
            this.box_level.off(Laya.Event.MOUSE_UP, this, this.mouseUpUglify);
            this.box_level.off(Laya.Event.MOUSE_OUT, this, this.mouseUpUglify);
            var a = evt.stageX - this.startX;
            this.startX = null;
            if (a > 0 && Math.abs(a) >= 100) {
                if (this.curPage == 1)
                    return;
                this.listAni(1);
            }
            else if (a < 0 && Math.abs(a) >= 100) {
                if (this.curPage == this.maxPage)
                    return;
                this.listAni(-1);
            }
        };
        ChooseScene2.prototype.listAni = function (direction, time) {
            if (time === void 0) { time = 300; }
            return __awaiter(this, void 0, void 0, function () {
                var _this = this;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            this.isPlaying = true;
                            this.enableView(false);
                            this.curPage += direction * -1;
                            return [4, this.refreshUIUglify()];
                        case 1:
                            _a.sent();
                            return [4, Promise.all(Array.apply(void 0, Array(this.maxPage)).map(function (v, i) {
                                    return _this.singleAni(i, direction, time);
                                }))];
                        case 2:
                            _a.sent();
                            this.isPlaying = false;
                            this.enableView(true);
                            return [2];
                    }
                });
            });
        };
        ChooseScene2.prototype.singleAni = function (index, direction, time) {
            var _this = this;
            return new Promise(function (resolve) {
                var item = _this.box_level.getChildAt(index);
                var pos = { x: item.x + _this.distance * direction };
                Laya.Tween.to(item, pos, time, null, Laya.Handler.create(_this, function () {
                    resolve();
                }));
            });
        };
        ChooseScene2.prototype.enterGameUglify = function (data) {
            var _this = this;
            PowerMgr.instance.changePowerUglify({
                count: -GameData.getInstance().defaultConfigs.powerCost,
                success: function () {
                    EventMgr.getInstance().sendEvent(GameEvent.BUFFER_LOAD, true);
                    ResUtil.getIntance().loadGroups(["game2", "skin2"], function () {
                        EventMgr.getInstance().sendEvent(GameEvent.BUFFER_LOAD, false);
                        EventMgr.getInstance().sendEvent(GameEvent.OPEN_SCENE, { name: "GameSceneType2", data: { level: data } });
                        _this.removeSelf();
                    });
                }
            });
        };
        ChooseScene2.prototype.childrenCreated = function () {
            _super.prototype.childrenCreated.call(this);
            DeviceUtil.adaptationBgImg(this.img_bg);
            this.box_level.scrollRect = new Laya.Rectangle(0, 0, 975, 397);
            this.box_ani.scrollRect = new Laya.Rectangle(0, 0, 770, 650);
        };
        ChooseScene2.prototype.addEvent = function () {
            this.btn_last.on(Laya.Event.CLICK, this, this.onLast);
            this.btn_next.on(Laya.Event.CLICK, this, this.onNext);
            this.btn_close.on(Laya.Event.CLICK, this, this.onCloseUglify);
            this.btn_skin.on(Laya.Event.CLICK, this, this.onSkinUglify);
            EventMgr.getInstance().addEvent(GameEvent.Type2Select, this, this.enterGameUglify);
        };
        ChooseScene2.prototype.initView = function () {
            if (DeviceUtil.isMZMiniGame())
                this.showInsertAd();
            if (GameData.getInstance().isConVersion) {
                this.btn_skin.visible = false;
            }
            this.refreshUIUglify();
        };
        return ChooseScene2;
    }(PopBaseScene));

    var ViewMgr = (function () {
        function ViewMgr() {
            this.addEvent();
        }
        Object.defineProperty(ViewMgr, "instance", {
            get: function () {
                if (!ViewMgr.ins)
                    ViewMgr.ins = new ViewMgr();
                return ViewMgr.ins;
            },
            enumerable: true,
            configurable: true
        });
        ViewMgr.prototype.registerBufferLoading = function () {
            BufferLoadingManger.getInstance().registerOneBuffer("GameBufferLoading", new GameBufferLoading());
        };
        ViewMgr.prototype.bufferLoading = function (show) {
            if (show) {
                this.showBufferLoading();
            }
            else {
                this.hiddeBufferLoading();
            }
        };
        ViewMgr.prototype.showBufferLoading = function (info) {
            if (info === void 0) { info = ""; }
            BufferLoadingManger.getInstance().showBuffer("GameBufferLoading", info);
            Laya.timer.clear(this, this.hiddeBufferLoading);
            Laya.timer.once(60000, this, this.hiddeBufferLoading);
            BufferLoadingManger.getInstance().bufferGroup.mouseThrough = false;
        };
        ViewMgr.prototype.hiddeBufferLoading = function () {
            Laya.timer.clear(this, this.hiddeBufferLoading);
            BufferLoadingManger.getInstance().hiddBuffer("GameBufferLoading");
            BufferLoadingManger.getInstance().bufferGroup.mouseEnabled = true;
            BufferLoadingManger.getInstance().bufferGroup.mouseThrough = true;
        };
        ViewMgr.prototype.showTopBar = function (mouseEnabled) {
            if (mouseEnabled === void 0) { mouseEnabled = true; }
            if (!this.com_topBar) {
                this.com_topBar = new TopBar();
                BufferLoadingManger.getInstance().bufferGroup.addChild(this.com_topBar);
            }
            this.com_topBar.visible = true;
            this.com_topBar.mouseEnabled = mouseEnabled;
        };
        ViewMgr.prototype.changePos = function (pos) {
            this.com_topBar.pos(pos._x, pos._y);
            if (DeviceUtil.getIsIphoneX())
                this.com_topBar.y += GameData.getInstance().fullScreenOffSet;
        };
        ViewMgr.prototype.hideTopBar = function () {
            if (this.com_topBar) {
                this.com_topBar.visible = false;
            }
        };
        ViewMgr.prototype.openScene = function (evt) {
            ViewManager.getInstance().popLayer.removeChildren();
            switch (evt.name) {
                case "HomeScene":
                    SceneManager.getInstance().openGameScene(HomeScene, evt.data);
                    break;
                case "GameSceneType2":
                    this.opneGameViewType2(evt.data);
                    break;
            }
        };
        ViewMgr.prototype.opneGameViewType2 = function (data) {
            this.hideTopBar();
            SceneManager.getInstance().openGameScene(GameSceneType2, data);
        };
        ViewMgr.prototype.openBuyProp = function (data) {
            PopManager.instance.showPopView({ className: BuyPropScene, data: { type: data.type } });
        };
        ViewMgr.prototype.chooseModel = function (data_) {
            var group = [];
            var className;
            var classData;
            switch (data_.type) {
                case 2:
                    group = ["choose2"];
                    className = ChooseScene2;
                    break;
                default:
            }
            EventMgr.getInstance().sendEvent(GameEvent.BUFFER_LOAD, true);
            ResUtil.getIntance().loadGroups(group, function () {
                ViewManager.getInstance().showView(className, classData);
                EventMgr.getInstance().sendEvent(GameEvent.BUFFER_LOAD, false);
            });
        };
        ViewMgr.prototype.gameOver2 = function (data) {
            if (GameData.getInstance().isConVersion) {
                ViewManager.getInstance().showView(SettlementScene2, data);
            }
            else {
                if (data.level % 2 == 0) {
                    PopManager.instance.showPopView({
                        className: AwardScene,
                        data: {
                            type: 2,
                            data: {
                                fun: function () {
                                    ViewManager.getInstance().showView(SettlementScene2, data);
                                }
                            }
                        }
                    });
                }
                else {
                    ViewManager.getInstance().showView(SettlementScene2, data);
                }
            }
        };
        ViewMgr.prototype.addEvent = function () {
            EventMgr.getInstance().addEvent(GameEvent.BUFFER_LOAD, this, this.bufferLoading);
            EventMgr.getInstance().addEvent(GameEvent.SHOW_TOP, this, this.showTopBar);
            EventMgr.getInstance().addEvent(GameEvent.HIDE_TOP, this, this.hideTopBar);
            EventMgr.getInstance().addEvent(GameEvent.OPEN_BUY_PROP, this, this.openBuyProp);
            EventMgr.getInstance().addEvent(GameEvent.OPEN_SCENE, this, this.openScene);
            EventMgr.getInstance().addEvent(GameEvent.CHANGE_POS, this, this.changePos);
            EventMgr.getInstance().addEvent(GameEvent.Type2GameOver, this, this.gameOver2);
            EventMgr.getInstance().addEvent(GameEvent.CHOOSE_MODEL, this, this.chooseModel);
        };
        return ViewMgr;
    }());
    window['ViewMgr'] = ViewMgr;

    var MiniWeChatGameManager = (function (_super) {
        __extends(MiniWeChatGameManager, _super);
        function MiniWeChatGameManager() {
            var _this = _super !== null && _super.apply(this, arguments) || this;
            _this.hideTime = 0;
            _this.showTime = 0;
            _this.defaultMssage = {
                "title": "我被卡在了第一关，快来帮帮我",
                "imageUrl": "https://package.32yx.com/ecy_game_small/laya/firePeople2/wx_res/share1.jpg",
                "query": ""
            };
            _this.shareInfo = [
                {
                    "title": "我被卡在了第一关，快来帮帮我",
                    "imageUrl": "https://package.32yx.com/ecy_game_small/laya/firePeople2/wx_res/share1.jpg",
                    "query": ""
                }
            ];
            _this.sucTime = 0;
            _this.canShowBanner = true;
            return _this;
        }
        MiniWeChatGameManager.prototype.initMiniGame = function () {
            var _this = this;
            var launchObj = platform.getLaunchOptionsSync();
            if (launchObj) {
                console.log('launchObj>>>>>>>>>>>>>>', launchObj);
            }
            this.getUpdateManager();
            platform.setKeepScreenOn();
            platform.updateShareMenu();
            platform.showShareMenu();
            platform.onShareAppMessage(function () {
                return _this.defaultMssage;
            });
            this.systemInfo = platform.getSystemInfoSync();
            console.log("systemInfo >> ", this.systemInfo);
        };
        MiniWeChatGameManager.prototype.getUserInfo = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    return [2, new Promise(function (resolve) {
                            resolve(null);
                        })];
                });
            });
        };
        MiniWeChatGameManager.prototype.initUserInfo = function () {
            return __awaiter(this, void 0, void 0, function () {
                var info;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4, this.getUserInfo()];
                        case 1:
                            info = _a.sent();
                            if (info == null)
                                return [2, null];
                            GameData.getInstance().userInfo.nick = info.userInfo.nickName;
                            GameData.getInstance().userInfo.avatarUrl = info.userInfo.avatarUrl;
                            MiniManeger.instance.defaultMssage.query = "openid=" + GameData.getInstance().userInfo.openId;
                            platform.onShareAppMessage(function () {
                                return MiniManeger.instance.defaultMssage;
                            });
                            return [2, info];
                    }
                });
            });
        };
        MiniWeChatGameManager.prototype.userButtonSize = function (percentTop, pectendSize, percentLeft) {
            var resInfo = platform.getSystemInfoSync();
            var left = resInfo['windowWidth'] * percentLeft;
            var top = resInfo['windowHeight'] * percentTop;
            var wid = resInfo['windowWidth'] * pectendSize;
            var height = resInfo['windowHeight'] * pectendSize;
        };
        MiniWeChatGameManager.prototype.onShow = function (callBack) {
            var _this = this;
            platform.onShow(function () {
                callBack && callBack();
                _this.showTime = new Date().getTime();
                if (_this.showTime - _this.hideTime >= _this.sucTime) {
                    _this.shareSucful && _this.shareSucful.call(_this.thisObj);
                }
                else {
                    _this.shareFailful && _this.shareFailful.call(_this.thisObj);
                }
                _this.shareSucful = null;
                _this.shareFailful = null;
                _this.thisObj = null;
                EventMgr.getInstance().sendEvent(GameEvent.ONSHOW);
            });
        };
        MiniWeChatGameManager.prototype.onHide = function (callBack) {
            var _this = this;
            platform.onHide(function () {
                callBack && callBack();
                _this.hideTime = new Date().getTime();
                EventMgr.getInstance().sendEvent(GameEvent.ONHIDE);
            });
        };
        MiniWeChatGameManager.prototype.onAudioInterruptionBegin = function (callBack) {
            platform.onAudioInterruptionBegin(function () {
                callBack && callBack();
            });
        };
        MiniWeChatGameManager.prototype.onAudioInterruptionEnd = function (callBack) {
            platform.onAudioInterruptionEnd(function () {
                callBack && callBack();
            });
        };
        MiniWeChatGameManager.prototype.getUpdateManager = function () {
            platform.getUpdateManager();
        };
        MiniWeChatGameManager.prototype.showMoreGame = function (data) {
            return __awaiter(this, void 0, void 0, function () {
                var _this = this;
                return __generator(this, function (_a) {
                    return [2, new Promise(function (resolve) { return __awaiter(_this, void 0, void 0, function () {
                            return __generator(this, function (_a) {
                                return [2];
                            });
                        }); })];
                });
            });
        };
        MiniWeChatGameManager.prototype.getShareInfo = function (query) {
            var shareInfo = this.shareInfo;
            var info = shareInfo[Math.floor(Math.random() * shareInfo.length)];
            if (query) {
                var openId = GameData.getInstance().userInfo.openId;
                query['openid'] = openId;
            }
            info.query = Utils.querStr(query);
            return info;
        };
        MiniWeChatGameManager.prototype.shareAppMessage = function (data) {
            if (!DeviceUtil.isWXMiniGame()) {
                data.sucFun && data.sucFun();
                return;
            }
            if (data == null) {
                data = {};
            }
            this.shareSucful = data.sucFun;
            this.shareFailful = function () {
                TipsManager.getInstance().showDefaultTips('分享失败，请分享到群里');
                data.failFun && data.failFun();
            };
            this.thisObj = data.thisObj;
            this.sucTime = data.time || 3000;
            if (!data.message) {
                data.message = this.getShareInfo({});
            }
            if (DeviceUtil.isQQMiniGame() || DeviceUtil.isWXMiniGame()) {
                platform.shareAppMessage(data.message);
            }
        };
        MiniWeChatGameManager.prototype.playViderAd = function (data) {
            if (!DeviceUtil.isWXMiniGame()) {
                data.successFun && data.successFun();
                return;
            }
            var videoId = GameData.getInstance().videoId;
            if (data.isLongVideo) {
                videoId = GameData.getInstance().longVideoId;
            }
            if (videoId.length <= 0) {
                TipsManager.getInstance().showDefaultTips('开发中');
                data.errorFun && data.errorFun();
                return;
            }
            platform.showLoading({ title: '广告加载中', mask: true });
            var adId = videoId[Math.floor(Math.random() * videoId.length)];
            platform.createRewardedVideoAd(adId, function (res) {
                if (res.isEnded) {
                    data.successFun && data.successFun();
                    SoundManager.instance.playBgMusic(SoundManager.instance.curBgMusic);
                }
                else {
                    data.failFun && data.failFun();
                    SoundManager.instance.playBgMusic(SoundManager.instance.curBgMusic);
                }
                platform.hideLoading({});
            }, function () {
                platform.hideLoading({});
                TipsManager.getInstance().showDefaultTips('网络错误');
                data.errorFun && data.errorFun();
            });
        };
        MiniWeChatGameManager.prototype.showBannerAd = function (offset) {
            if (!DeviceUtil.isWXMiniGame()) {
                return;
            }
            this.canShowBanner = true;
            var bannerId = GameData.getInstance().bannerId;
            if (bannerId.length <= 0) {
                return;
            }
            var adId = bannerId[Math.floor(Math.random() * bannerId.length)];
            if (this.bannerAd == null) {
                var bannerAd = platform.createBannerAd(adId);
                this.bannerAd = bannerAd;
                if (bannerAd == null)
                    return;
                bannerAd.show();
            }
            this.bannerAd.show();
            if (!this.canShowBanner) {
                this.bannerAd.hide();
            }
            if (offset) {
                this.bannerAd.style.left = offset.w - this.bannerAd.style.realWidth / 2 + 0.1;
                this.bannerAd.style.top = offset.h - this.bannerAd.style.realHeight + 0.1;
                offset.callback && offset.callback();
            }
        };
        MiniWeChatGameManager.prototype.hideBanner = function () {
            if (this.bannerAd != null) {
                this.bannerAd.hide();
            }
            this.canShowBanner = false;
        };
        MiniWeChatGameManager.prototype.vibrateShort = function (data) {
            if (!GameData.getInstance().shakeIsOpen)
                return;
            if (DeviceUtil.isQQMiniGame() || DeviceUtil.isWXMiniGame()) {
                platform.vibrateShort(data);
            }
        };
        MiniWeChatGameManager.prototype.vibrateLong = function () {
            if (!GameData.getInstance().shakeIsOpen)
                return;
            if (DeviceUtil.isQQMiniGame() || DeviceUtil.isWXMiniGame()) {
                platform.vibrateLong();
            }
        };
        MiniWeChatGameManager.prototype.adaptImgToClientRect = function (collec_img, stage) {
            if (DeviceUtil.isWXMiniGame()) {
                var systemInfo = platform.getSystemInfoSync();
                var screenHeight = systemInfo['screenHeight'];
                var screenWidth = systemInfo['screenWidth'];
                var rect = platform.getMenuButtonBoundingClientRect();
                collec_img.top = stage.height * (rect['top'] / screenHeight);
                collec_img.right = stage.width * (1 - rect['right'] / screenWidth) + collec_img.width;
            }
        };
        MiniWeChatGameManager.prototype.sendDataToWxOpen = function (data) {
            Laya.MiniAdpter.window.wx.postMessage(data);
        };
        MiniWeChatGameManager.prototype.removeOpenData = function (data) {
            var wxOpenData = data.parent.getChildByName('wxOpenData');
            this.sendDataToWxOpen({ cmd: 'close', data: null });
            if (wxOpenData) {
                wxOpenData.removeSelf();
                wxOpenData.destroy();
                wxOpenData = null;
            }
        };
        MiniWeChatGameManager.prototype.addOpenWxData = function (data) {
            var shareData = MiniManeger.instance.getShareInfo({ id: GameData.getInstance().userInfo.openId });
            this.sendDataToWxOpen({ cmd: 'share', data: JSON.stringify(shareData) });
            var wxOpenData = data.parent.getChildByName('wxOpenData');
            if (wxOpenData) {
                wxOpenData.removeSelf();
                wxOpenData.destroy();
                wxOpenData = null;
            }
            wxOpenData = new Laya.WXOpenDataViewer();
            wxOpenData.name = 'wxOpenData';
            wxOpenData.x = data.x || 0;
            wxOpenData.y = data.y || 0;
            wxOpenData.width = data.width;
            wxOpenData.height = data.height;
            if (data.isCenter) {
                wxOpenData.centerX = 0;
                wxOpenData.centerY = 0;
            }
            else {
                if (data.left != null) {
                    wxOpenData.left = data.left;
                }
                if (data.right != null) {
                    wxOpenData.right = data.right;
                }
                if (data.top != null) {
                    wxOpenData.top = data.top;
                }
                if (data.bottom != null) {
                    wxOpenData.bottom = data.bottom;
                }
            }
            if (data.parent) {
                data.parent.addChild(wxOpenData);
            }
            return wxOpenData;
        };
        return MiniWeChatGameManager;
    }(MiniManeger));

    var GameLoadingView = (function (_super) {
        __extends(GameLoadingView, _super);
        function GameLoadingView() {
            var _this = _super.call(this) || this;
            _this.className_key = "GameLoadingView";
            _this.width = Laya.stage.width;
            _this.height = Laya.stage.height;
            _this.img_bg = new Laya.Image();
            _this.img_bg.skin = "resource/assets/loading/loading_background_1.png";
            _this.addChild(_this.img_bg);
            DeviceUtil.adaptationBgImg(_this.img_bg);
            _this.img_jdt_db = new Laya.Image();
            _this.img_jdt_db.skin = "resource/assets/loading/loading_baseboard_1.png";
            _this.img_jdt_db.sizeGrid = "0,26,0,26";
            _this.img_jdt_db.width = 882;
            _this.img_jdt_db.height = 54;
            _this.img_jdt_db.centerX = 0;
            _this.img_jdt_db.centerY = 0;
            _this.addChild(_this.img_jdt_db);
            _this.img_jdt = new Laya.Image();
            _this.img_jdt.skin = "resource/assets/loading/loading_baseboard_2.png";
            _this.img_jdt.sizeGrid = "0,20,0,20";
            _this.img_jdt.width = 500;
            _this.img_jdt.height = 40;
            _this.img_jdt.x = 5;
            _this.img_jdt.centerY = 0;
            _this.img_jdt_db.addChild(_this.img_jdt);
            var lab = new Laya.Label();
            lab.fontSize = 50;
            lab.font = "SimHei";
            lab.bold = true;
            lab.centerX = 0;
            lab.bottom = -90;
            lab.text = "我来了，我来了……";
            _this.img_jdt_db.addChild(lab);
            _this.box_loadAni = new Laya.Box();
            _this.box_loadAni.width = 150;
            _this.box_loadAni.height = 200;
            _this.box_loadAni.pos(0, -200);
            _this.img_jdt_db.addChild(_this.box_loadAni);
            _this.loadAni = new Laya.Skeleton();
            _this.loadAni.load("resource/assets/loading/loading.sk", Laya.Handler.create(_this, function () {
                _this.loadAni.pos(50, 80);
                _this.box_loadAni.addChild(_this.loadAni);
                _this.loadAni.play(0, true);
            }));
            _this.progress(1, 100);
            return _this;
        }
        GameLoadingView.prototype.childrenCreated = function () {
        };
        GameLoadingView.prototype.showAnimation = function () {
            var _this = this;
            this.box_ani = new Laya.Box();
            this.box_ani.width = Laya.stage.width;
            this.box_ani.height = Laya.stage.height;
            this.box_ani.bgColor = "#000000";
            this.addChild(this.box_ani);
            this.showAniUglify = new Laya.Skeleton();
            this.showAniUglify.load("resource/assets/db/opening.sk", Laya.Handler.create(this, function () {
                _this.showAniUglify.x = Laya.stage.width / 2;
                _this.showAniUglify.y = Laya.stage.height / 2;
                _this.showAniUglify.player && _this.showAniUglify.player.once(Laya.Event.STOPPED, _this, function () {
                    _this.box_ani.once(Laya.Event.CLICK, _this, function () {
                        EventMgr.getInstance().sendEvent(GameEvent.OPEN_SCENE, { name: "HomeScene" });
                        _this.remove();
                    });
                });
                _this.showAniUglify.scale(2, 2);
                _this.box_ani.addChild(_this.showAniUglify);
                _this.showAniUglify.play(0, false);
            }));
        };
        GameLoadingView.prototype.onAwake = function () {
            _super.prototype.onAwake.call(this);
        };
        GameLoadingView.prototype.progress = function (index, len) {
            if (this.img_jdt) {
                this.img_jdt.width = 872 * (index / len);
                this.box_loadAni.x = 810 * (index / len);
            }
        };
        GameLoadingView.prototype.remove = function () {
            if (this && this.parent)
                this.parent.removeChild(this);
            this.box_ani && this.box_ani.offAll();
            this.loadAni && this.loadAni.destroy();
            this.showAniUglify && this.showAniUglify.destroy();
        };
        return GameLoadingView;
    }(BaseSceneUISkin));

    var MZGameMgr = (function (_super) {
        __extends(MZGameMgr, _super);
        function MZGameMgr() {
            var _this = _super !== null && _super.apply(this, arguments) || this;
            _this.url = "https://yxtest.32yx.com/MZMiniGame.fcgi";
            _this.hideTime = 0;
            _this.showTime = 0;
            _this.canShowBanner = true;
            return _this;
        }
        MZGameMgr.prototype.initMiniGame = function () {
            this.systemInfo = qg.getSystemInfoSync();
            console.log("systemInfo >> ", this.systemInfo);
        };
        MZGameMgr.prototype.onShow = function (callBack) {
            var _this = this;
            mz.onShow(function (res) {
                callBack && callBack(res);
                _this.showTime = new Date().getTime();
                EventMgr.getInstance().sendEvent(GameEvent.ONSHOW);
            });
        };
        MZGameMgr.prototype.onHide = function (callBack) {
            var _this = this;
            mz.onHide(function () {
                callBack && callBack();
                _this.hideTime = new Date().getTime();
                EventMgr.getInstance().sendEvent(GameEvent.ONHIDE);
            });
        };
        MZGameMgr.prototype.loginGame = function () {
            var _this = this;
            return new Promise(function (resolve, reject) {
                _this.login().then(function (res) {
                    res = JSON.parse(res);
                    console.log("loginGame success ", res);
                    GameData.getInstance().userInfo.openId = res.value.clientId;
                    GameData.getInstance().userInfo.nick = res.value.nickname;
                    GameData.getInstance().userInfo.avatarUrl = res.value.icon;
                    resolve();
                }).catch(function (err) {
                    _this.getToken().then(function (res) {
                        res = JSON.parse(res);
                        console.log("loginGame success ", res);
                        GameData.getInstance().userInfo.openId = res.value.clientId;
                        GameData.getInstance().userInfo.nick = res.value.nickname;
                        GameData.getInstance().userInfo.avatarUrl = res.value.icon;
                        resolve();
                    }).catch(function (err) {
                        reject();
                    });
                });
            });
        };
        MZGameMgr.prototype.login = function () {
            var _this = this;
            return new Promise(function (resolve, reject) {
                mz.login({
                    success: function (res) {
                        console.log("login success ", res);
                        if (res.token) {
                            var urlappend = "access_token=" + res.token;
                            var data = {
                                msg_type: "10",
                                msg_data: {
                                    url_append: urlappend,
                                }
                            };
                            HttpMgr.getInstance().sendHttp(_this.url, data, function (res) {
                                console.log("getsisson 返回：", res);
                                resolve(res.msg_data);
                            }, function (err) {
                                console.warn("网络请求失败：", err);
                                reject();
                            }, "post");
                        }
                        else {
                            console.warn("登录失败：", res);
                            reject();
                        }
                    },
                    fail: function (res) {
                        console.warn("login fail ", res);
                        switch (res.code) {
                            case 4:
                                console.log("用户取消登录");
                                break;
                            case 20:
                                console.log("用户拒绝授权");
                                break;
                        }
                        reject();
                    }
                });
            });
        };
        MZGameMgr.prototype.getToken = function () {
            var _this = this;
            return new Promise(function (resolve, reject) {
                mz.getToken({
                    success: function (res) {
                        console.log("getToken success ", res);
                        if (res.token) {
                            var urlappend = "access_token=" + res.token;
                            var data = {
                                msg_type: "10",
                                msg_data: {
                                    url_append: urlappend,
                                }
                            };
                            HttpMgr.getInstance().sendHttp(_this.url, data, function (res) {
                                console.log("getsisson 返回：", res);
                                resolve(res.msg_data);
                            }, function (err) {
                                console.warn("网络请求失败：", err);
                                reject();
                            }, "post");
                        }
                        else {
                            console.warn("登录失败：", res);
                            reject();
                        }
                    },
                    fail: function (res) {
                        console.warn("getToken fail ", res);
                        switch (res.code) {
                            case 4:
                                console.log("用户取消登录");
                                break;
                            case 20:
                                console.log("用户拒绝授权");
                                break;
                        }
                        reject();
                    }
                });
            });
        };
        MZGameMgr.prototype.initUserInfo = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    return [2];
                });
            });
        };
        MZGameMgr.prototype.playViderAd = function (data) {
            var _this = this;
            if (!DeviceUtil.isMZMiniGame()) {
                data.successFun && data.successFun();
                return;
            }
            var videoId = GameData.getInstance().videoId;
            if (videoId.length <= 0) {
                TipsManager.getInstance().showDefaultTips("开发中");
                data.errorFun && data.errorFun();
                return;
            }
            if (!this.videoAd) {
                var adId = videoId[Math.floor(Math.random() * videoId.length)];
                this.videoAd = qg.createRewardedVideoAd({
                    adUnitId: adId
                });
                this.videoAd.onLoad(function (res) {
                    console.log("激励视频广告 加载成功", res);
                    _this.videoAd.show();
                });
            }
            var onCloseCall = function (res) {
                console.log("激励视频广告 关闭", res);
                data.successFun && data.successFun();
                _this.videoAd.offClose(onCloseCall);
                _this.videoAd.offError(onErrorCall);
            };
            var onErrorCall = function (err) {
                console.warn("激励视频广告 onError", err);
                data.errorFun && data.errorFun(err);
                _this.videoAd.offClose(onCloseCall);
                _this.videoAd.offError(onErrorCall);
            };
            this.videoAd.onClose(onCloseCall);
            this.videoAd.onError(onErrorCall);
            this.videoAd.load();
        };
        MZGameMgr.prototype.createBanner = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _this = this;
                return __generator(this, function (_a) {
                    return [2, new Promise(function (resolve) {
                            _this.canShowBanner = true;
                            var bannerId = GameData.getInstance().bannerId;
                            if (bannerId.length <= 0) {
                                resolve(null);
                                return;
                            }
                            var adId = bannerId[Math.floor(Math.random() * bannerId.length)];
                            console.log("创建 banner 广告组件-->", adId);
                            var phone = _this.systemInfo;
                            var w = phone.screenWidth;
                            var h = phone.screenHeight;
                            var top = h - 161 - 30;
                            var bannerAd = qg.createBannerAd({
                                adUnitId: adId,
                                style: { top: top, left: 0, width: w, height: 60 }
                            });
                            var errorFun = function (err) {
                                console.warn("banner 广告 onError ", err);
                                resolve(null);
                            };
                            var closeFun = function (err) {
                                console.log("banner 广告 onClose ", err);
                            };
                            var resizeFun = function (res) {
                                bannerAd.style.left = (w - res.width) / 2;
                                bannerAd.style.height = res.height + 20;
                                bannerAd.style.top = h - res.height - 30;
                                console.log("banner 广告 onResize ", res, bannerAd);
                            };
                            var loadFun = function (res) {
                                console.log("banner 广告 onLoad 成功", res);
                                _this.bannerAd = bannerAd;
                                resolve(bannerAd);
                            };
                            bannerAd.onLoad(loadFun);
                            bannerAd.onResize(resizeFun);
                            bannerAd.onError(errorFun);
                            bannerAd.onClose(closeFun);
                            _this.clearBannerFun = function () {
                                if (_this.bannerAd) {
                                    _this.bannerAd.offLoad(loadFun);
                                    _this.bannerAd.offResize(resizeFun);
                                    _this.bannerAd.offError(errorFun);
                                    _this.bannerAd.offClose(closeFun);
                                }
                            };
                        })];
                });
            });
        };
        MZGameMgr.prototype.showBannerAdSp = function () {
            if (this.canShowBanner && this.bannerAd) {
                this.bannerAd.show();
            }
        };
        MZGameMgr.prototype.showBannerAd = function (offset) {
            var _this = this;
            this.canShowBanner = true;
            var bannerId = GameData.getInstance().bannerId;
            if (bannerId.length <= 0)
                return;
            var adId = bannerId[Math.floor(Math.random() * bannerId.length)];
            console.log("创建 banner 广告组件-->", adId);
            var phone = this.systemInfo;
            var w = phone.screenWidth;
            var h = phone.screenHeight;
            var top = h - 161 - 30;
            this.bannerAd = qg.createBannerAd({
                adUnitId: adId,
                style: { top: top, left: 0, width: w, height: 60 }
            });
            var errorFun = function (err) {
                console.warn("banner 广告 onError ", err);
            };
            var closeFun = function (err) {
                console.log("banner 广告 onClose ", err);
            };
            var resizeFun = function (res) {
                _this.bannerAd.style.left = (w - res.width) / 2;
                _this.bannerAd.style.height = res.height + 20;
                _this.bannerAd.style.top = h - res.height - 30;
                console.log("banner 广告 onResize ", res, _this.bannerAd);
            };
            var loadFun = function (res) {
                console.log("banner 广告 onLoad 成功", res);
                _this.bannerAd.show();
                if (!_this.canShowBanner) {
                    _this.bannerAd.hide();
                }
                if (offset) {
                    offset.callback && offset.callback();
                }
            };
            this.bannerAd.onLoad(loadFun);
            this.bannerAd.onResize(resizeFun);
            this.bannerAd.onError(errorFun);
            this.bannerAd.onClose(closeFun);
            this.clearBannerFun = function () {
                if (_this.bannerAd) {
                    _this.bannerAd.offLoad(loadFun);
                    _this.bannerAd.offResize(resizeFun);
                    _this.bannerAd.offError(errorFun);
                    _this.bannerAd.offClose(closeFun);
                }
            };
        };
        MZGameMgr.prototype.hideBanner = function () {
            console.log("隐藏 banner 广告组件-->");
            this.clearBannerFun && this.clearBannerFun();
            this.clearBannerFun = null;
            this.bannerAd && this.bannerAd.hide();
            this.canShowBanner = false;
        };
        MZGameMgr.prototype.showInsertAd = function (data) {
            var _this = this;
            this.canShowBanner = true;
            var intersId = GameData.getInstance().intersId;
            if (intersId.length <= 0)
                return;
            var adId = intersId[Math.floor(Math.random() * intersId.length)];
            console.log("创建插屏广告组件-->", adId);
            if (!this.insertAd) {
                this.insertAd = qg.createInsertAd({
                    adUnitId: adId
                });
                this.insertAd.onLoad(function () {
                    console.log("插屏广告 显示成功");
                    _this.insertAd.show();
                    data.successFun && data.successFun();
                });
            }
            var closeCall = function (res) {
                console.log("插屏广告关闭", res);
                data.closeFun && data.closeFun();
                _this.insertAd.offError(errorCall);
                _this.insertAd.offClose(closeCall);
            };
            var errorCall = function (err) {
                console.log("插屏广告错误", err);
                data.errorFun && data.errorFun();
                _this.insertAd.offError(errorCall);
                _this.insertAd.offClose(closeCall);
            };
            this.insertAd.onError(errorCall);
            this.insertAd.onClose(closeCall);
            this.insertAd.load();
        };
        MZGameMgr.prototype.vibrateShort = function (data) {
            if (!GameData.getInstance().shakeIsOpen)
                return;
            mz.vibrateShort({});
        };
        MZGameMgr.prototype.vibrateLong = function () {
            if (!GameData.getInstance().shakeIsOpen)
                return;
            mz.vibrateLong({});
        };
        return MZGameMgr;
    }(MiniManeger));

    var Main = (function (_super) {
        __extends(Main, _super);
        function Main() {
            var _this = _super.call(this, { width: 1080, height: 1920, exportSceneToJson: true }) || this;
            GameConfig.init();
            if (MiniManeger.ins == null) {
                if (DeviceUtil.isWXMiniGame()) {
                    MiniManeger.ins = new MiniWeChatGameManager();
                }
                else if (DeviceUtil.isTTMiniGame()) ;
                else if (DeviceUtil.isMZMiniGame()) {
                    MiniManeger.ins = new MZGameMgr();
                }
                else {
                    MiniManeger.ins = new MiniWeChatGameManager();
                }
            }
            _this.checkPlatform();
            var onShow = function (obj) {
                console.log("onShow obj = ", obj);
                SoundManager.instance.playBgMusic();
            };
            var onHide = function () {
                console.log("onHide");
                SoundManager.instance.pauseBgMusic();
            };
            var onAudioInterruptionBegin = function (res) {
                console.log("onAudioInterruptionBegin");
            };
            var onAudioInterruptionEnd = function (res) {
                console.log("onAudioInterruptionEnd");
            };
            if (DeviceUtil.isMZMiniGame()) {
                MiniManeger.instance.onShow(onShow);
                MiniManeger.instance.onHide(onHide);
                MiniManeger.instance.initMiniGame();
            }
            else if (DeviceUtil.isMiniGame()) {
                GameData.getInstance().enterGameInfo = platform.getLaunchOptionsSync();
                MiniManeger.instance.onShow(onShow);
                MiniManeger.instance.onHide(onHide);
                MiniManeger.instance.onAudioInterruptionBegin(onAudioInterruptionBegin);
                MiniManeger.instance.onAudioInterruptionEnd(onAudioInterruptionEnd);
                MiniManeger.instance.initMiniGame();
            }
            else {
                Laya.stage.on(Laya.Event.FOCUS, _this, function () {
                    console.log("获取焦点");
                    onShow(null);
                    EventMgr.getInstance().sendEvent(GameEvent.ONSHOW);
                });
                Laya.stage.on(Laya.Event.BLUR, _this, function () {
                    console.log("失去焦点");
                    onHide();
                    EventMgr.getInstance().sendEvent(GameEvent.ONHIDE);
                });
            }
            return _this;
        }
        Main.prototype.checkPlatform = function () {
            console.log("检验平台---");
            var self = this;
            if (window["loadingH5"]) {
                window["loadingH5"](100);
            }
            if (window["loadingView"]) {
                window["loadingView"].loading(100);
            }
            var resUrl = "./";
            GameData.getInstance().gameVersion = 1001;
            if (DeviceUtil.isWXMiniGame()) {
                Laya.timer.once(10000, this, function () {
                    console.log("加速回收---");
                    platform.triggerGC();
                });
                GameData.getInstance().gameVersion = 1002;
                GameData.getInstance().resVersion = '1_4/';
                GameData.getInstance().MinigameResUrlRoot += "wx_res/";
                GameData.getInstance().MinigameResAllUrl = GameData.getInstance().MinigameResUrlRoot + "wx_res_v_z_" + GameData.getInstance().resVersion;
                resUrl = GameData.getInstance().MinigameResAllUrl;
                ResUtil.getIntance().defaultOriginUrl = resUrl;
                ResUtil.getIntance().addVersionPrefix(resUrl);
            }
            else if (DeviceUtil.isTTMiniGame()) {
                Laya.timer.once(10000, this, function () {
                    console.log("加速回收---");
                    platform.triggerGC();
                });
                GameData.getInstance().gameVersion = 1001;
                GameData.getInstance().resVersion = '1_1/';
                GameData.getInstance().MinigameResUrlRoot += "tt_res/";
                GameData.getInstance().MinigameResAllUrl = GameData.getInstance().MinigameResUrlRoot + "tt_res_v_z_" + GameData.getInstance().resVersion;
                resUrl = GameData.getInstance().MinigameResAllUrl;
                ResUtil.getIntance().defaultOriginUrl = resUrl;
                ResUtil.getIntance().addVersionPrefix(resUrl);
            }
            else if (DeviceUtil.isMZMiniGame()) {
                GameData.getInstance().gameVersion = 1001;
                GameData.getInstance().resVersion = '1_2/';
                GameData.getInstance().MinigameResUrlRoot += "mz_res/";
                GameData.getInstance().MinigameResAllUrl = GameData.getInstance().MinigameResUrlRoot + "mz_res_v_z_" + GameData.getInstance().resVersion;
                resUrl = GameData.getInstance().MinigameResAllUrl;
                ResUtil.getIntance().defaultOriginUrl = resUrl;
                ResUtil.getIntance().addVersionPrefix(resUrl);
            }
            self.initDebug();
            self.loadPreLoadRes(resUrl + 'configs/');
        };
        Main.prototype.loadPreLoadRes = function (resUrl) {
            var url = resUrl;
            _super.prototype.initInfos.call(this, url + "infos.json" + ConfigManager.instance.randomVersion);
        };
        Main.prototype.enableFileConfig = function () {
            var _this = this;
            if (DeviceUtil.isTTMiniGame()) {
                MiniManeger.instance.moreSomeAppInfos = [];
                var res = [
                    { "appid": "tt5c622adfc34851be", "title": "杠精大乱斗", "icon": "https://hs.yz061.com/res/down/public/icon/cd/pole_jump.png" },
                    { "appid": "tt4e7138ccd15b7caa", "title": "巴掌王3D", "icon": "https://hs.yz061.com/res/down/public/icon/cd/slap_king.png" },
                    { "appid": "tt7e0808b5e1224cd6", "title": "穿越空间", "icon": "https://hs.yz061.com/res/down/public/icon/cd/cykj.png" },
                    { "appid": "tt9c09eab4032391c1", "title": "消消来了", "icon": "https://hs.yz061.com/res/down/public/icon/cd/xxll.jpg" },
                    { "appid": "tt18956e2887bf2f24", "title": "篮球大作战", "icon": "https://hs.yz061.com/res/down/public/icon/cd/kltl.jpg" },
                    { "appid": "ttfdfc8b4162d6c8ab", "title": "萌兵战争", "icon": "https://hs.yz061.com/res/down/public/icon/cd/mbzz.jpg" },
                    { "appid": "tte3a3951e7c899dfd", "title": "疯狂跳床", "icon": "https://hs.yz061.com/res/down/public/icon/cd/jump.png" },
                    { "appid": "tt546f22d2cb457cd0", "title": "超级购物狂", "icon": "https://hs.yz061.com/res/down/public/icon/cd/crazy_shopping.jpg" },
                    { "appid": "tt8c7bfac613516af9", "title": "快来划水", "icon": "https://hs.yz061.com/res/down/public/icon/cd/klhs.jpg" },
                    { "appid": "ttce8db83051a7f459", "title": "春节小火车", "icon": "https://hs.yz061.com/res/down/public/icon/cd/train.jpg" },
                ];
                for (var i = 0, len = res.length; i < len; i++) {
                    if (res[i].appid != "ttccfcba4153d6c16f") {
                        MiniManeger.instance.moreSomeAppInfos.push(res[i]);
                    }
                }
            }
            GameData.getInstance().initConfig(BaseConst.infos);
            Laya.AtlasInfoManager.enable("fileconfig.json", Laya.Handler.create(this, function () { return __awaiter(_this, void 0, void 0, function () {
                var res_1, self_1, enter_1;
                var _this = this;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (!(DeviceUtil.isQQMiniGame() || DeviceUtil.isWXMiniGame() || DeviceUtil.isTTMiniGame())) return [3, 4];
                            console.log("开始登录");
                            self_1 = this;
                            enter_1 = function (isCreate) {
                                if (isCreate === void 0) { isCreate = false; }
                                return __awaiter(_this, void 0, void 0, function () {
                                    var userInfo;
                                    return __generator(this, function (_a) {
                                        switch (_a.label) {
                                            case 0:
                                                if (isCreate) {
                                                    self_1.loadRes();
                                                    return [2];
                                                }
                                                if (DeviceUtil.isWXMiniGame()) {
                                                    console.log("登陆信息:", res_1);
                                                    GameData.getInstance().userInfo.openId = res_1.openid;
                                                    GameData.getInstance().userInfo.sessionKey = res_1.session_key;
                                                    console.log("用户信息 : ", GameData.getInstance().userInfo);
                                                }
                                                if (!DeviceUtil.isTTMiniGame()) return [3, 2];
                                                return [4, platform.getUserInfo()];
                                            case 1:
                                                userInfo = _a.sent();
                                                console.log("getUserInfo:", userInfo);
                                                GameData.getInstance().userInfo.nick = userInfo.nickName;
                                                GameData.getInstance().userInfo.avatarUrl = userInfo.avatarUrl;
                                                console.log("用户信息 : ", GameData.getInstance().userInfo);
                                                return [3, 3];
                                            case 2:
                                                MiniManeger.instance.initUserInfo();
                                                _a.label = 3;
                                            case 3:
                                                self_1.loadRes();
                                                return [2];
                                        }
                                    });
                                });
                            };
                            if (!DeviceUtil.isTTMiniGame()) return [3, 1];
                            platform.checkSession({
                                success: function () {
                                    return __awaiter(this, void 0, void 0, function () {
                                        var userInfo;
                                        return __generator(this, function (_a) {
                                            switch (_a.label) {
                                                case 0:
                                                    console.log("session未过期");
                                                    return [4, platform.getUserInfo()];
                                                case 1:
                                                    userInfo = _a.sent();
                                                    console.log("getUserInfo:", userInfo);
                                                    if (userInfo) {
                                                        GameData.getInstance().userInfo.nick = userInfo.nickName;
                                                        GameData.getInstance().userInfo.avatarUrl = userInfo.avatarUrl;
                                                        enter_1(true);
                                                    }
                                                    else {
                                                        enter_1(true);
                                                    }
                                                    return [2];
                                            }
                                        });
                                    });
                                },
                                fail: function () {
                                    return __awaiter(this, void 0, void 0, function () {
                                        var userInfo;
                                        return __generator(this, function (_a) {
                                            switch (_a.label) {
                                                case 0:
                                                    console.log("session\u5DF2\u8FC7\u671F\uFF0C\u9700\u8981\u91CD\u65B0\u767B\u5F55");
                                                    return [4, platform.login()];
                                                case 1:
                                                    res_1 = _a.sent();
                                                    if (res_1 == null) {
                                                        enter_1(true);
                                                        return [2];
                                                    }
                                                    res_1 = JSON.parse(res_1);
                                                    return [4, platform.getUserInfo()];
                                                case 2:
                                                    userInfo = _a.sent();
                                                    console.log("getUserInfo:", userInfo);
                                                    if (userInfo) {
                                                        GameData.getInstance().userInfo.nick = userInfo.nickName;
                                                        GameData.getInstance().userInfo.avatarUrl = userInfo.avatarUrl;
                                                        enter_1(true);
                                                    }
                                                    else {
                                                        enter_1(true);
                                                    }
                                                    return [2];
                                            }
                                        });
                                    });
                                }
                            });
                            return [3, 3];
                        case 1: return [4, platform.login()];
                        case 2:
                            res_1 = _a.sent();
                            res_1 = JSON.parse(res_1);
                            enter_1();
                            _a.label = 3;
                        case 3: return [3, 7];
                        case 4:
                            if (!DeviceUtil.isMZMiniGame()) return [3, 6];
                            return [4, MiniManeger.instance.loginGame()];
                        case 5:
                            _a.sent();
                            console.log("用户信息 : ", GameData.getInstance().userInfo);
                            this.loadRes();
                            return [3, 7];
                        case 6:
                            this.loadRes();
                            _a.label = 7;
                        case 7: return [2];
                    }
                });
            }); }));
        };
        Main.prototype.loadRes = function () {
            return __awaiter(this, void 0, void 0, function () {
                var strogeVersion, openId, resUrl, resArr;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            strogeVersion = Laya.LocalStorage.getItem('strogeVersion');
                            if (GameData.getInstance().strogeVersion != strogeVersion) {
                                Laya.LocalStorage.clear();
                            }
                            Laya.LocalStorage.setItem('strogeVersion', GameData.getInstance().strogeVersion);
                            if (!GameData.getInstance().userInfo.openId) {
                                openId = Laya.LocalStorage.getItem("openId");
                                if (openId) {
                                    GameData.getInstance().userInfo.openId = openId;
                                }
                                else {
                                    openId = "fire" + Utils.getRandom(10000, 99999);
                                    GameData.getInstance().userInfo.openId = openId;
                                    Laya.LocalStorage.setItem("openId", openId);
                                }
                                if (!GameData.getInstance().userInfo.nick)
                                    GameData.getInstance().userInfo.nick = openId;
                            }
                            ViewMgr.instance.loadingView = new GameLoadingView();
                            SceneManager.getInstance().openSceneInstance(ViewMgr.instance.loadingView);
                            if (!DeviceUtil.isMZMiniGame()) {
                                MiniManeger.instance.showBannerAd(null);
                                MiniManeger.instance.hideBanner();
                            }
                            resUrl = "";
                            if (DeviceUtil.isWXMiniGame() || DeviceUtil.isQQMiniGame() || DeviceUtil.isTTMiniGame() || DeviceUtil.isMZMiniGame()) {
                                resUrl = GameData.getInstance().MinigameResAllUrl;
                            }
                            console.log("loadRes---", resUrl);
                            return [4, ResUtil.getIntance().loadThms(resUrl + "resource/default.thm.json" + ConfigManager.instance.randomVersion)];
                        case 1:
                            _a.sent();
                            return [4, ResUtil.getIntance().loadRESConfig(resUrl + "resource/default.res.json" + ConfigManager.instance.randomVersion)];
                        case 2:
                            _a.sent();
                            ViewMgr.instance.registerBufferLoading();
                            return [4, ConfigManager.instance.initConfigs()];
                        case 3:
                            _a.sent();
                            return [4, GameInfoManager.getInstance().selectAllGameInfo()];
                        case 4:
                            _a.sent();
                            return [4, GameMgr.instance.initData()];
                        case 5:
                            _a.sent();
                            resArr = ["panel", "public"];
                            this.enterHome(resArr);
                            return [2];
                    }
                });
            });
        };
        Main.prototype.enterHome = function (resArr) {
            var _this = this;
            resArr.push("home");
            ResUtil.getIntance().loadGroups(resArr, function () { return __awaiter(_this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    console.log("res load completed!!!");
                    ViewMgr.instance.loadingView.showAnimation();
                    return [2];
                });
            }); }, function (index, len) {
                ViewMgr.instance.loadingView.progress(index, len);
            });
        };
        return Main;
    }(BaseContent));
    new Main();

}());
