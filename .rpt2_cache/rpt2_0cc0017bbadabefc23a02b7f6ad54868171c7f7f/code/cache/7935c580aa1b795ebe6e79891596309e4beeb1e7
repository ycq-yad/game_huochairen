{
  "code": "import * as tslib_1 from \"tslib\";\r\nimport { PopLastScene } from \"../../PopLastScene\";\r\nimport SoundManager, { SoundConst } from \"../../../manager/SoundManager\";\r\nimport { MiniManeger } from \"../../../minigame/MiniManeger\";\r\nimport GameMgr, { Prop } from \"../../../manager/GameMgr\";\r\nimport AnimationManager from \"../../../manager/AnimationManager\";\r\nimport { GameData } from \"../../../common/GameData\";\r\nimport GameEvent from \"../../../common/GameEvent\";\r\nvar AwardScene = (function (_super) {\r\n    tslib_1.__extends(AwardScene, _super);\r\n    function AwardScene(data_) {\r\n        var _this = _super.call(this) || this;\r\n        _this.className_key = \"AwardScene\";\r\n        _this.clickCount = 0;\r\n        _this.flag = false;\r\n        _this.viewData_ = data_;\r\n        _this.skin = \"skins/uiView/pop/AwardView.json\";\r\n        return _this;\r\n    }\r\n    AwardScene.prototype.removeEvent = function () {\r\n        this.btn_get.off(Laya.Event.CLICK, this, this.onVideoUglify);\r\n        this.lab_get.off(Laya.Event.CLICK, this, this.onGetUglify);\r\n        this.btn_open.off(Laya.Event.CLICK, this, this.onOpenUglify);\r\n    };\r\n    AwardScene.prototype.onRemoved = function () {\r\n        _super.prototype.onRemoved.call(this);\r\n        this.removeEvent();\r\n        EventMgr.getInstance().sendEvent(GameEvent.HIDE_GAME_BOX, this.box_moreGame);\r\n        if (this.viewData_.type == 1) {\r\n        }\r\n        else {\r\n        }\r\n        this.viewData_ = null;\r\n        Laya.Tween.clearAll(this.img_light);\r\n        Laya.Tween.clearAll(this.btn_get);\r\n        Laya.Tween.clearAll(this.btn_open);\r\n    };\r\n    AwardScene.prototype.onVideoUglify = function () {\r\n        SoundManager.instance.playEffect(SoundConst.BtnClick);\r\n        var self = this;\r\n        self.grp_center.mouseEnabled = false;\r\n        if (GameData.getInstance().videoOpen) {\r\n            MiniManeger.instance.playViderAd({\r\n                successFun: function () {\r\n                    self.getAwardUglify(2);\r\n                },\r\n                failFun: function () {\r\n                    self.grp_center.mouseEnabled = true;\r\n                },\r\n                errorFun: function () {\r\n                    self.grp_center.mouseEnabled = true;\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            MiniManeger.instance.shareAppMessage({\r\n                sucFun: function () {\r\n                    self.getAwardUglify(2);\r\n                },\r\n                failFun: function () {\r\n                    self.grp_center.mouseEnabled = true;\r\n                }\r\n            });\r\n        }\r\n    };\r\n    AwardScene.prototype.onGetUglify = function () {\r\n        SoundManager.instance.playEffect(SoundConst.BtnClick);\r\n        this.getAwardUglify(1);\r\n    };\r\n    AwardScene.prototype.getAwardUglify = function (mult) {\r\n        var data = this.viewData_;\r\n        if (data.type == 1) {\r\n            GameMgr.instance.updateBaseData(data.data.id, data.data.num * mult);\r\n            if (data.data && data.data.fun)\r\n                data.data.fun();\r\n        }\r\n        this.grp_center.mouseEnabled = true;\r\n        this.removeSelf();\r\n    };\r\n    AwardScene.prototype.onOpenUglify = function () {\r\n        var _this = this;\r\n        SoundManager.instance.playEffect(SoundConst.BtnClick);\r\n        Laya.timer.clear(this, this.onTimerUglify);\r\n        this.clickCount++;\r\n        this.progressUglify();\r\n        var viewData = this.viewData_.data;\r\n        if (this.clickCount >= 10) {\r\n            this.btn_open.mouseEnabled = false;\r\n            this.btn_open.visible = false;\r\n            Laya.timer.once(GameData.getInstance().bagBtnDelay, this, function () {\r\n                _this.removeSelf();\r\n                ViewManager.getInstance().showView(AwardScene, {\r\n                    type: 1,\r\n                    data: {\r\n                        id: Prop.Power,\r\n                        num: GameData.getInstance().defaultConfigs.powerBag,\r\n                        fun: viewData.fun,\r\n                        flag: true\r\n                    }\r\n                });\r\n            });\r\n        }\r\n        else {\r\n            Laya.timer.loop(700, this, this.onTimerUglify);\r\n            if (this.clickCount == 6) {\r\n                if (this.flag) {\r\n                    this.btn_open.visible = false;\r\n                    if (DeviceUtil.isMZMiniGame()) {\r\n                        MiniManeger.instance.showBannerAdSp();\r\n                    }\r\n                    else {\r\n                        this.showBanner();\r\n                        GameMgr.instance.bannerIsShow = true;\r\n                    }\r\n                    Laya.Tween.to(this.btn_open, { bottom: 425 }, 500, null, Laya.Handler.create(this, function () {\r\n                        _this.btn_open.visible = true;\r\n                    }));\r\n                }\r\n                this.flag = false;\r\n            }\r\n        }\r\n    };\r\n    AwardScene.prototype.onTimerUglify = function () {\r\n        this.clickCount--;\r\n        this.progressUglify();\r\n        if (this.clickCount <= 0) {\r\n            Laya.timer.clear(this, this.onTimerUglify);\r\n        }\r\n    };\r\n    AwardScene.prototype.progressUglify = function () {\r\n        this.img_prog.width = 840 * this.clickCount / 10;\r\n        this.img_expression.skin = this.clickCount % 2 ? \"resource/assets/imgs/home/reward/reward_icon_2.png\" : \"resource/assets/imgs/home/reward/reward_icon_3.png\";\r\n    };\r\n    AwardScene.prototype.childrenCreated = function () {\r\n        _super.prototype.childrenCreated.call(this);\r\n        this.grp_center.width = Laya.stage.width;\r\n        this.grp_center.height = Laya.stage.height;\r\n        if (GameData.getInstance().videoOpen) {\r\n            this.btn_get.getChildByName(\"icon\").skin = \"resource/assets/imgs/public/game_icon_4.png\";\r\n        }\r\n        else {\r\n            this.btn_get.getChildByName(\"icon\").skin = \"resource/assets/imgs/public/settlement_icon_5.png\";\r\n        }\r\n    };\r\n    AwardScene.prototype.addEvent = function () {\r\n        this.btn_get.on(Laya.Event.CLICK, this, this.onVideoUglify);\r\n        this.lab_get.on(Laya.Event.CLICK, this, this.onGetUglify);\r\n        this.btn_open.on(Laya.Event.CLICK, this, this.onOpenUglify);\r\n    };\r\n    AwardScene.prototype.initView = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var data;\r\n            var _this = this;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this.viewData_)\r\n                            return [2];\r\n                        this.btn_get.visible = this.btn_open.visible = this.lab_get.visible = false;\r\n                        this.lab_num.visible = this.img_expression.visible = this.img_progdb.visible = false;\r\n                        AnimationManager.instance.runaroundTween(this.img_light, this);\r\n                        data = this.viewData_;\r\n                        if (!(data.type == 1)) return [3, 1];\r\n                        this.lab_title.text = \"获得奖励\";\r\n                        this.img_icon.skin = GameMgr.instance.getIconUrlById(data.data.id);\r\n                        this.img_icon.scale(3, 3);\r\n                        this.lab_num.visible = true;\r\n                        this.lab_num.text = \"+\" + data.data.num;\r\n                        this.btn_get.visible = true;\r\n                        this.showCloseBtn(this.lab_get);\r\n                        AnimationManager.instance.btnScaleAniLoop(this.btn_get, this);\r\n                        EventMgr.getInstance().sendEvent(GameEvent.SHOW_GAME_BOX, this.box_moreGame);\r\n                        if (DeviceUtil.isWXMiniGame() && GameData.getInstance().touchByMistake) {\r\n                            this.hideBanner();\r\n                            GameMgr.instance.bannerIsShow = false;\r\n                            this.btn_get.bottom = 100;\r\n                            this.lab_get.bottom = 25;\r\n                            Laya.timer.once(1000, this, function () {\r\n                                _this.showBanner();\r\n                                GameMgr.instance.bannerIsShow = true;\r\n                                Laya.Tween.to(_this.btn_get, { bottom: 425 }, 500);\r\n                                Laya.Tween.to(_this.lab_get, { bottom: 350 }, 500);\r\n                            });\r\n                        }\r\n                        return [3, 4];\r\n                    case 1:\r\n                        this.lab_title.text = \"体力书包\";\r\n                        this.img_icon.skin = \"resource/assets/imgs/home/reward/reward_icon_1.png\";\r\n                        this.img_icon.scale(1.5, 1.5);\r\n                        this.img_expression.visible = true;\r\n                        this.img_progdb.visible = true;\r\n                        this.clickCount = 0;\r\n                        this.progressUglify();\r\n                        this.btn_open.bottom = 100;\r\n                        this.btn_open.visible = true;\r\n                        this.btn_open.mouseEnabled = true;\r\n                        if (!(DeviceUtil.isMZMiniGame() && GameData.getInstance().touchByMistake)) return [3, 3];\r\n                        this.flag = true;\r\n                        this.hideBanner();\r\n                        this.btn_open.bottom = 100;\r\n                        this.btn_open.visible = false;\r\n                        return [4, MiniManeger.instance.createBanner()];\r\n                    case 2:\r\n                        _a.sent();\r\n                        this.btn_open.visible = true;\r\n                        return [3, 4];\r\n                    case 3:\r\n                        if ((DeviceUtil.isQQMiniGame() || DeviceUtil.isTTMiniGame() || DeviceUtil.isWXMiniGame()) &&\r\n                            GameData.getInstance().touchByMistake) {\r\n                            this.flag = true;\r\n                            this.hideBanner();\r\n                            GameMgr.instance.bannerIsShow = false;\r\n                            this.btn_open.bottom = 100;\r\n                        }\r\n                        else {\r\n                            this.flag = false;\r\n                            this.btn_open.bottom = 425;\r\n                        }\r\n                        _a.label = 4;\r\n                    case 4: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return AwardScene;\r\n}(PopLastScene));\r\nexport { AwardScene };\r\n",
  "references": [
    "E:/laya/project/laya_firePeople2_git_ts/src/script/views/PopLastScene.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/manager/SoundManager.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/minigame/MiniManeger.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/manager/GameMgr.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/manager/AnimationManager.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/common/GameData.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/common/GameEvent.ts"
  ]
}
