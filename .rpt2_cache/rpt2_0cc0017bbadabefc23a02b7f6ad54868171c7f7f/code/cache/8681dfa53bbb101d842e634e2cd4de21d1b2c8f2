{
  "code": "import * as tslib_1 from \"tslib\";\r\nimport { GameData } from \"../../common/GameData\";\r\nimport { MiniManeger } from \"../../minigame/MiniManeger\";\r\nvar DYChannelMgr = (function () {\r\n    function DYChannelMgr() {\r\n        this.url = \"https://zy.qkxz.com/WxApi/?webid=72\";\r\n        this.version = 1;\r\n        this.nGameID = 0;\r\n        this.gameListInfos = [];\r\n        this.bannerInfos = [];\r\n        this._moreGameList = [];\r\n    }\r\n    Object.defineProperty(DYChannelMgr, \"instance\", {\r\n        get: function () {\r\n            if (!DYChannelMgr.ins)\r\n                DYChannelMgr.ins = new DYChannelMgr();\r\n            return DYChannelMgr.ins;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    DYChannelMgr.prototype.initConfig = function (res) {\r\n        this.url = res.url;\r\n        this.version = res.version;\r\n    };\r\n    DYChannelMgr.prototype.loginGame = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\r\n            var userinfo;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!DeviceUtil.isWXMiniGame()) return [3, 2];\r\n                        return [4, this.WXLogin()];\r\n                    case 1:\r\n                        userinfo = _a.sent();\r\n                        return [3, 4];\r\n                    case 2:\r\n                        if (!DeviceUtil.isTTMiniGame()) return [3, 4];\r\n                        return [4, this.TTLogin()];\r\n                    case 3:\r\n                        userinfo = _a.sent();\r\n                        _a.label = 4;\r\n                    case 4:\r\n                        if (userinfo) {\r\n                            this.openid = userinfo.openid;\r\n                            GameData.getInstance().userInfo.openId = userinfo.openid;\r\n                        }\r\n                        resolve(userinfo);\r\n                        return [2];\r\n                }\r\n            });\r\n        }); });\r\n    };\r\n    DYChannelMgr.prototype.WXLogin = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            wx.login({\r\n                success: function (res) {\r\n                    if (res.code) {\r\n                        console.log(\"code：\", res.code);\r\n                        var obj = {\r\n                            code: res.code,\r\n                            nickName: \"\",\r\n                            avatarUrl: \"\",\r\n                            gender: 0,\r\n                            scene: encodeURIComponent(MiniManeger.instance.launchOption.scene)\r\n                        };\r\n                        HttpMgr.getInstance().sendHttp(_this.url + \"&act=userinfo&version=\" + _this.version + \"&\", obj, function (rev) {\r\n                            var jsonRev = rev.data;\r\n                            console.log(\"DY---> login success\", rev);\r\n                            resolve(jsonRev);\r\n                        }, function (err) {\r\n                            console.warn(\"DY---> login fail = \", err);\r\n                            reject();\r\n                        }, \"get\");\r\n                    }\r\n                    else {\r\n                        console.warn(\"微信登录失败：\", res);\r\n                        reject();\r\n                    }\r\n                },\r\n                fail: function (err) {\r\n                    console.log(\"login调用失败\", err);\r\n                    reject();\r\n                }\r\n            });\r\n        });\r\n    };\r\n    DYChannelMgr.prototype.TTLogin = function () {\r\n        return new Promise(function (resolve, reject) {\r\n        });\r\n    };\r\n    DYChannelMgr.prototype.startGame = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            HttpMgr.getInstance().sendHttp(_this.url + \"&act=index&version=\" + _this.version + \"&openid=\" + _this.openid + \"&\", null, function (rev) {\r\n                var jsonRev = rev.data;\r\n                console.log(\"DY---> startGame rev = \", rev);\r\n                _this.nGameID = jsonRev.id;\r\n                resolve(jsonRev.id);\r\n            }, null, \"get\");\r\n        });\r\n    };\r\n    DYChannelMgr.prototype.endGame = function (obj) {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            HttpMgr.getInstance().sendHttp(_this.url + \"&act=end&version=\" + _this.version + \"&openid=\" + _this.openid + \"&\", obj, function (rev) {\r\n                var jsonRev = rev.data;\r\n                console.log(\"DY---> endGame rev = \", rev);\r\n                resolve(jsonRev);\r\n            }, null, \"get\");\r\n        });\r\n    };\r\n    DYChannelMgr.prototype.clickGame = function (id) {\r\n        HttpMgr.getInstance().sendHttp(this.url + \"&act=game&version=\" + this.version + \"&id=\" + id + \"&openid=\" + this.openid, null, function (rev) {\r\n            console.log(\"DY---> clickGame rev = \", rev);\r\n        }, null, \"get\");\r\n    };\r\n    DYChannelMgr.prototype.toGame = function (id) {\r\n        HttpMgr.getInstance().sendHttp(this.url + \"&act=cgame&version=\" + this.version + \"&id=\" + id + \"&openid=\" + this.openid, null, function (rev) {\r\n            console.log(\"DY---> toGame rev = \", rev);\r\n        }, null, \"get\");\r\n    };\r\n    Object.defineProperty(DYChannelMgr.prototype, \"moreGameList\", {\r\n        get: function () {\r\n            return Utils.copy(this._moreGameList);\r\n        },\r\n        set: function (data) {\r\n            this._moreGameList = data;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    DYChannelMgr.prototype.getGameList = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            var url = _this.url + \"&act=gamelist&version=\" + _this.version + \"&openid=\" + _this.openid + \"&v=\" + Math.random();\r\n            HttpMgr.getInstance().sendHttp(url, null, function (rev) {\r\n                console.log(\"DY---> getGameList rev = \", rev);\r\n                _this.bannerInfos = rev.data.banner;\r\n                _this.gameListInfos = rev.data.gamelist;\r\n                resolve(rev.data.gamelist);\r\n            }, null, \"get\");\r\n        });\r\n    };\r\n    DYChannelMgr.prototype.refreshGameList = function (reload) {\r\n        var _this = this;\r\n        if (reload === void 0) { reload = true; }\r\n        return new Promise(function (resolve) {\r\n            if (!reload && _this._moreGameList && _this._moreGameList.length > 0) {\r\n                resolve();\r\n                return;\r\n            }\r\n            _this.getGameList().then(function () {\r\n                _this._moreGameList = [];\r\n                var nLen = 0;\r\n                if (_this.gameListInfos)\r\n                    nLen = _this.gameListInfos.length;\r\n                for (var i = 0; i < nLen; ++i) {\r\n                    var stData = new MoreGameInfo();\r\n                    stData.ad_id = _this.gameListInfos[i].id;\r\n                    stData.ad_img = _this.gameListInfos[i].img;\r\n                    stData.name = _this.gameListInfos[i].title;\r\n                    stData.ad_appid = _this.gameListInfos[i].appid;\r\n                    stData.url = _this.gameListInfos[i].url;\r\n                    _this._moreGameList.push(stData);\r\n                }\r\n                console.log(\"refreshGameList = \", _this._moreGameList);\r\n                resolve();\r\n            });\r\n        });\r\n    };\r\n    DYChannelMgr.prototype.getRandomIndex = function (nMax) {\r\n        if (!this._moreGameList || this._moreGameList.length <= 0) {\r\n            return [];\r\n        }\r\n        var nRandom = Utils.random(0, this._moreGameList.length - 1);\r\n        var nCount = this._moreGameList.length % 3;\r\n        if (nCount > 0) {\r\n            nCount = 3 - nCount;\r\n        }\r\n        nCount = this._moreGameList.length + nCount;\r\n        if (nCount <= nMax) {\r\n            nCount = nMax;\r\n        }\r\n        var aryInfo = [];\r\n        for (var i = 0; i < nCount; ++i) {\r\n            aryInfo.push(nRandom);\r\n            nRandom += 1;\r\n            if (nRandom >= this._moreGameList.length) {\r\n                nRandom = 0;\r\n            }\r\n        }\r\n        return aryInfo;\r\n    };\r\n    return DYChannelMgr;\r\n}());\r\nexport default DYChannelMgr;\r\nvar DYAuthorize_Cmd = (function () {\r\n    function DYAuthorize_Cmd() {\r\n    }\r\n    return DYAuthorize_Cmd;\r\n}());\r\nexport { DYAuthorize_Cmd };\r\nvar DYAuthorize_Rev = (function () {\r\n    function DYAuthorize_Rev() {\r\n    }\r\n    return DYAuthorize_Rev;\r\n}());\r\nexport { DYAuthorize_Rev };\r\nvar DYEndGame_Cmd = (function () {\r\n    function DYEndGame_Cmd() {\r\n    }\r\n    return DYEndGame_Cmd;\r\n}());\r\nexport { DYEndGame_Cmd };\r\nvar DYGameListItem = (function () {\r\n    function DYGameListItem() {\r\n    }\r\n    return DYGameListItem;\r\n}());\r\nexport { DYGameListItem };\r\nvar MoreGameInfo = (function () {\r\n    function MoreGameInfo() {\r\n        this.ad_id = \"\";\r\n        this.ad_img = \"\";\r\n        this.name = \"\";\r\n        this.ad_appid = \"\";\r\n        this.url = \"\";\r\n    }\r\n    return MoreGameInfo;\r\n}());\r\nexport { MoreGameInfo };\r\n;\r\n",
  "references": [
    "E:/laya/project/laya_firePeople2_git_ts/src/script/common/GameData.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/minigame/MiniManeger.ts"
  ]
}
