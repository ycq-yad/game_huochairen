{
  "code": "import * as tslib_1 from \"tslib\";\r\nimport { MiniManeger } from \"./MiniManeger\";\r\nimport GameEvent from \"../common/GameEvent\";\r\nimport { GameData } from \"../common/GameData\";\r\nvar MZGameMgr = (function (_super) {\r\n    tslib_1.__extends(MZGameMgr, _super);\r\n    function MZGameMgr() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.url = \"https://yxtest.32yx.com/MZMiniGame.fcgi\";\r\n        _this.hideTime = 0;\r\n        _this.showTime = 0;\r\n        _this.canShowBanner = true;\r\n        return _this;\r\n    }\r\n    MZGameMgr.prototype.initMiniGame = function () {\r\n        this.systemInfo = qg.getSystemInfoSync();\r\n        console.log(\"systemInfo >> \", this.systemInfo);\r\n    };\r\n    MZGameMgr.prototype.onShow = function (callBack) {\r\n        var _this = this;\r\n        mz.onShow(function (res) {\r\n            callBack && callBack(res);\r\n            _this.showTime = new Date().getTime();\r\n            EventMgr.getInstance().sendEvent(GameEvent.ONSHOW);\r\n        });\r\n    };\r\n    MZGameMgr.prototype.onHide = function (callBack) {\r\n        var _this = this;\r\n        mz.onHide(function () {\r\n            callBack && callBack();\r\n            _this.hideTime = new Date().getTime();\r\n            EventMgr.getInstance().sendEvent(GameEvent.ONHIDE);\r\n        });\r\n    };\r\n    MZGameMgr.prototype.loginGame = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.login().then(function (res) {\r\n                res = JSON.parse(res);\r\n                console.log(\"loginGame success \", res);\r\n                GameData.getInstance().userInfo.openId = res.value.clientId;\r\n                GameData.getInstance().userInfo.nick = res.value.nickname;\r\n                GameData.getInstance().userInfo.avatarUrl = res.value.icon;\r\n                resolve();\r\n            }).catch(function (err) {\r\n                _this.getToken().then(function (res) {\r\n                    res = JSON.parse(res);\r\n                    console.log(\"loginGame success \", res);\r\n                    GameData.getInstance().userInfo.openId = res.value.clientId;\r\n                    GameData.getInstance().userInfo.nick = res.value.nickname;\r\n                    GameData.getInstance().userInfo.avatarUrl = res.value.icon;\r\n                    resolve();\r\n                }).catch(function (err) {\r\n                    reject();\r\n                });\r\n            });\r\n        });\r\n    };\r\n    MZGameMgr.prototype.login = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            mz.login({\r\n                success: function (res) {\r\n                    console.log(\"login success \", res);\r\n                    if (res.token) {\r\n                        var urlappend = \"access_token=\" + res.token;\r\n                        var data = {\r\n                            msg_type: \"10\",\r\n                            msg_data: {\r\n                                url_append: urlappend,\r\n                            }\r\n                        };\r\n                        HttpMgr.getInstance().sendHttp(_this.url, data, function (res) {\r\n                            console.log(\"getsisson 返回：\", res);\r\n                            resolve(res.msg_data);\r\n                        }, function (err) {\r\n                            console.warn(\"网络请求失败：\", err);\r\n                            reject();\r\n                        }, \"post\");\r\n                    }\r\n                    else {\r\n                        console.warn(\"登录失败：\", res);\r\n                        reject();\r\n                    }\r\n                },\r\n                fail: function (res) {\r\n                    console.warn(\"login fail \", res);\r\n                    switch (res.code) {\r\n                        case 4:\r\n                            console.log(\"用户取消登录\");\r\n                            break;\r\n                        case 20:\r\n                            console.log(\"用户拒绝授权\");\r\n                            break;\r\n                    }\r\n                    reject();\r\n                }\r\n            });\r\n        });\r\n    };\r\n    MZGameMgr.prototype.getToken = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            mz.getToken({\r\n                success: function (res) {\r\n                    console.log(\"getToken success \", res);\r\n                    if (res.token) {\r\n                        var urlappend = \"access_token=\" + res.token;\r\n                        var data = {\r\n                            msg_type: \"10\",\r\n                            msg_data: {\r\n                                url_append: urlappend,\r\n                            }\r\n                        };\r\n                        HttpMgr.getInstance().sendHttp(_this.url, data, function (res) {\r\n                            console.log(\"getsisson 返回：\", res);\r\n                            resolve(res.msg_data);\r\n                        }, function (err) {\r\n                            console.warn(\"网络请求失败：\", err);\r\n                            reject();\r\n                        }, \"post\");\r\n                    }\r\n                    else {\r\n                        console.warn(\"登录失败：\", res);\r\n                        reject();\r\n                    }\r\n                },\r\n                fail: function (res) {\r\n                    console.warn(\"getToken fail \", res);\r\n                    switch (res.code) {\r\n                        case 4:\r\n                            console.log(\"用户取消登录\");\r\n                            break;\r\n                        case 20:\r\n                            console.log(\"用户拒绝授权\");\r\n                            break;\r\n                    }\r\n                    reject();\r\n                }\r\n            });\r\n        });\r\n    };\r\n    MZGameMgr.prototype.initUserInfo = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            return tslib_1.__generator(this, function (_a) {\r\n                return [2];\r\n            });\r\n        });\r\n    };\r\n    MZGameMgr.prototype.playViderAd = function (data) {\r\n        var _this = this;\r\n        if (!DeviceUtil.isMZMiniGame()) {\r\n            data.successFun && data.successFun();\r\n            return;\r\n        }\r\n        var videoId = GameData.getInstance().videoId;\r\n        if (videoId.length <= 0) {\r\n            TipsManager.getInstance().showDefaultTips(\"开发中\");\r\n            data.errorFun && data.errorFun();\r\n            return;\r\n        }\r\n        if (!this.videoAd) {\r\n            var adId = videoId[Math.floor(Math.random() * videoId.length)];\r\n            this.videoAd = qg.createRewardedVideoAd({\r\n                adUnitId: adId\r\n            });\r\n            this.videoAd.onLoad(function (res) {\r\n                console.log(\"激励视频广告 加载成功\", res);\r\n                _this.videoAd.show();\r\n            });\r\n        }\r\n        var onCloseCall = function (res) {\r\n            console.log(\"激励视频广告 关闭\", res);\r\n            data.successFun && data.successFun();\r\n            _this.videoAd.offClose(onCloseCall);\r\n            _this.videoAd.offError(onErrorCall);\r\n        };\r\n        var onErrorCall = function (err) {\r\n            console.warn(\"激励视频广告 onError\", err);\r\n            data.errorFun && data.errorFun(err);\r\n            _this.videoAd.offClose(onCloseCall);\r\n            _this.videoAd.offError(onErrorCall);\r\n        };\r\n        this.videoAd.onClose(onCloseCall);\r\n        this.videoAd.onError(onErrorCall);\r\n        this.videoAd.load();\r\n    };\r\n    MZGameMgr.prototype.createBanner = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                return [2, new Promise(function (resolve) {\r\n                        _this.canShowBanner = true;\r\n                        var bannerId = GameData.getInstance().bannerId;\r\n                        if (bannerId.length <= 0) {\r\n                            resolve(null);\r\n                            return;\r\n                        }\r\n                        var adId = bannerId[Math.floor(Math.random() * bannerId.length)];\r\n                        console.log(\"创建 banner 广告组件-->\", adId);\r\n                        var phone = _this.systemInfo;\r\n                        var w = phone.screenWidth;\r\n                        var h = phone.screenHeight;\r\n                        var top = h - 161 - 30;\r\n                        var bannerAd = qg.createBannerAd({\r\n                            adUnitId: adId,\r\n                            style: { top: top, left: 0, width: w, height: 60 }\r\n                        });\r\n                        var errorFun = function (err) {\r\n                            console.warn(\"banner 广告 onError \", err);\r\n                            resolve(null);\r\n                        };\r\n                        var closeFun = function (err) {\r\n                            console.log(\"banner 广告 onClose \", err);\r\n                        };\r\n                        var resizeFun = function (res) {\r\n                            bannerAd.style.left = (w - res.width) / 2;\r\n                            bannerAd.style.height = res.height + 20;\r\n                            bannerAd.style.top = h - res.height - 30;\r\n                            console.log(\"banner 广告 onResize \", res, bannerAd);\r\n                        };\r\n                        var loadFun = function (res) {\r\n                            console.log(\"banner 广告 onLoad 成功\", res);\r\n                            _this.bannerAd = bannerAd;\r\n                            resolve(bannerAd);\r\n                        };\r\n                        bannerAd.onLoad(loadFun);\r\n                        bannerAd.onResize(resizeFun);\r\n                        bannerAd.onError(errorFun);\r\n                        bannerAd.onClose(closeFun);\r\n                        _this.clearBannerFun = function () {\r\n                            if (_this.bannerAd) {\r\n                                _this.bannerAd.offLoad(loadFun);\r\n                                _this.bannerAd.offResize(resizeFun);\r\n                                _this.bannerAd.offError(errorFun);\r\n                                _this.bannerAd.offClose(closeFun);\r\n                            }\r\n                        };\r\n                    })];\r\n            });\r\n        });\r\n    };\r\n    MZGameMgr.prototype.showBannerAdSp = function () {\r\n        if (this.canShowBanner && this.bannerAd) {\r\n            this.bannerAd.show();\r\n        }\r\n    };\r\n    MZGameMgr.prototype.showBannerAd = function (offset) {\r\n        var _this = this;\r\n        this.canShowBanner = true;\r\n        var bannerId = GameData.getInstance().bannerId;\r\n        if (bannerId.length <= 0)\r\n            return;\r\n        var adId = bannerId[Math.floor(Math.random() * bannerId.length)];\r\n        console.log(\"创建 banner 广告组件-->\", adId);\r\n        var phone = this.systemInfo;\r\n        var w = phone.screenWidth;\r\n        var h = phone.screenHeight;\r\n        var top = h - 161 - 30;\r\n        this.bannerAd = qg.createBannerAd({\r\n            adUnitId: adId,\r\n            style: { top: top, left: 0, width: w, height: 60 }\r\n        });\r\n        var errorFun = function (err) {\r\n            console.warn(\"banner 广告 onError \", err);\r\n        };\r\n        var closeFun = function (err) {\r\n            console.log(\"banner 广告 onClose \", err);\r\n        };\r\n        var resizeFun = function (res) {\r\n            _this.bannerAd.style.left = (w - res.width) / 2;\r\n            _this.bannerAd.style.height = res.height + 20;\r\n            _this.bannerAd.style.top = h - res.height - 30;\r\n            console.log(\"banner 广告 onResize \", res, _this.bannerAd);\r\n        };\r\n        var loadFun = function (res) {\r\n            console.log(\"banner 广告 onLoad 成功\", res);\r\n            _this.bannerAd.show();\r\n            if (!_this.canShowBanner) {\r\n                _this.bannerAd.hide();\r\n            }\r\n            if (offset) {\r\n                offset.callback && offset.callback();\r\n            }\r\n        };\r\n        this.bannerAd.onLoad(loadFun);\r\n        this.bannerAd.onResize(resizeFun);\r\n        this.bannerAd.onError(errorFun);\r\n        this.bannerAd.onClose(closeFun);\r\n        this.clearBannerFun = function () {\r\n            if (_this.bannerAd) {\r\n                _this.bannerAd.offLoad(loadFun);\r\n                _this.bannerAd.offResize(resizeFun);\r\n                _this.bannerAd.offError(errorFun);\r\n                _this.bannerAd.offClose(closeFun);\r\n            }\r\n        };\r\n    };\r\n    MZGameMgr.prototype.hideBanner = function () {\r\n        console.log(\"隐藏 banner 广告组件-->\");\r\n        this.clearBannerFun && this.clearBannerFun();\r\n        this.clearBannerFun = null;\r\n        this.bannerAd && this.bannerAd.hide();\r\n        this.canShowBanner = false;\r\n    };\r\n    MZGameMgr.prototype.showInsertAd = function (data) {\r\n        var _this = this;\r\n        this.canShowBanner = true;\r\n        var intersId = GameData.getInstance().intersId;\r\n        if (intersId.length <= 0)\r\n            return;\r\n        var adId = intersId[Math.floor(Math.random() * intersId.length)];\r\n        console.log(\"创建插屏广告组件-->\", adId);\r\n        if (!this.insertAd) {\r\n            this.insertAd = qg.createInsertAd({\r\n                adUnitId: adId\r\n            });\r\n            this.insertAd.onLoad(function () {\r\n                console.log(\"插屏广告 显示成功\");\r\n                _this.insertAd.show();\r\n                data.successFun && data.successFun();\r\n            });\r\n        }\r\n        var closeCall = function (res) {\r\n            console.log(\"插屏广告关闭\", res);\r\n            data.closeFun && data.closeFun();\r\n            _this.insertAd.offError(errorCall);\r\n            _this.insertAd.offClose(closeCall);\r\n        };\r\n        var errorCall = function (err) {\r\n            console.log(\"插屏广告错误\", err);\r\n            data.errorFun && data.errorFun();\r\n            _this.insertAd.offError(errorCall);\r\n            _this.insertAd.offClose(closeCall);\r\n        };\r\n        this.insertAd.onError(errorCall);\r\n        this.insertAd.onClose(closeCall);\r\n        this.insertAd.load();\r\n    };\r\n    MZGameMgr.prototype.vibrateShort = function (data) {\r\n        if (!GameData.getInstance().shakeIsOpen)\r\n            return;\r\n        mz.vibrateShort({});\r\n    };\r\n    MZGameMgr.prototype.vibrateLong = function () {\r\n        if (!GameData.getInstance().shakeIsOpen)\r\n            return;\r\n        mz.vibrateLong({});\r\n    };\r\n    return MZGameMgr;\r\n}(MiniManeger));\r\nexport { MZGameMgr };\r\n",
  "references": [
    "E:/laya/project/laya_firePeople2_git_ts/src/script/minigame/MiniManeger.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/common/GameEvent.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/common/GameData.ts"
  ]
}
