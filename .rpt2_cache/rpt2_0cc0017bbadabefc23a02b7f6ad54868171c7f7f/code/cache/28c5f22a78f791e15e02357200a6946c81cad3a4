{
  "code": "import * as tslib_1 from \"tslib\";\r\nimport SoundManager, { SoundConst } from \"../../manager/SoundManager\";\r\nimport { GameData } from \"../../common/GameData\";\r\nimport PowerMgr from \"../../manager/PowerMgr\";\r\nimport GameEvent from \"../../common/GameEvent\";\r\nvar TopBar = (function (_super) {\r\n    tslib_1.__extends(TopBar, _super);\r\n    function TopBar() {\r\n        var _this = _super.call(this) || this;\r\n        _this.className_key = \"TopBar\";\r\n        _this.name = \"TopBar\";\r\n        _this.skin = \"skins/uiView/TopBar.json\";\r\n        return _this;\r\n    }\r\n    TopBar.prototype.adaptationStage = function () {\r\n        this.size(580, 77);\r\n    };\r\n    TopBar.prototype.onAddStage = function () {\r\n        _super.prototype.onAddStage.call(this);\r\n        if (this.isCreate) {\r\n            this.initView();\r\n            this.addEvent();\r\n        }\r\n    };\r\n    TopBar.prototype.addEvent = function () {\r\n        this.btn_power.on(Laya.Event.CLICK, this, this.onPower);\r\n        this.btn_gold.on(Laya.Event.CLICK, this, this.onGold);\r\n        EventMgr.getInstance().addEvent(GameEvent.REFRESH_TOP, this, this.refresh);\r\n        EventMgr.getInstance().addEvent(GameEvent.POWER_REPLY_STATUS, this, this.updataShow);\r\n        EventMgr.getInstance().addEvent(GameEvent.ONSHOW, this, this.updatePower);\r\n    };\r\n    TopBar.prototype.initView = function () {\r\n        this.pos(30, 30);\r\n        if (DeviceUtil.getIsIphoneX())\r\n            this.y += GameData.getInstance().fullScreenOffSet;\r\n        this.updatePower();\r\n        this.refresh();\r\n    };\r\n    TopBar.prototype.refresh = function () {\r\n        this.lab_power.text = PowerMgr.instance.power + \"/\" + GameData.getInstance().defaultConfigs.rePowerLimit;\r\n        this.lab_gold.text = GameData.getInstance().playerData.gold + \"\";\r\n    };\r\n    TopBar.prototype.updatePower = function () {\r\n        var surTime = PowerMgr.instance.spaceTimeRestorePowerUglify();\r\n        this.surplusTime = Math.floor(surTime / 1000);\r\n        console.log(\"updatePower\", this.surplusTime);\r\n        if (this.surplusTime) {\r\n            this.lab_time.text = Utils.formatTime(this.surplusTime);\r\n            this.downTime();\r\n        }\r\n        else {\r\n            Laya.timer.clearAll(this);\r\n            this.lab_time.text = \"\";\r\n        }\r\n    };\r\n    TopBar.prototype.downTime = function () {\r\n        var _this = this;\r\n        Laya.timer.clearAll(this);\r\n        Laya.timer.loop(1000, this, function () {\r\n            _this.surplusTime--;\r\n            if (_this.surplusTime) {\r\n                _this.lab_time.text = Utils.formatTime(_this.surplusTime);\r\n            }\r\n            else {\r\n                _this.lab_time.text = \"\";\r\n                Laya.timer.clearAll(_this);\r\n                PowerMgr.instance.changePowerUglify({ count: 1, isNatural: true });\r\n                _this.updatePower();\r\n            }\r\n        });\r\n    };\r\n    TopBar.prototype.updataShow = function (type) {\r\n        if (type == 1) {\r\n            this.lab_time.text = \"\";\r\n            Laya.timer.clearAll(this);\r\n        }\r\n        else {\r\n            this.updatePower();\r\n        }\r\n    };\r\n    TopBar.prototype.onPower = function () {\r\n        SoundManager.instance.playEffect(SoundConst.BtnClick);\r\n        EventMgr.getInstance().sendEvent(GameEvent.OPEN_BUY_PROP, { type: 1 });\r\n    };\r\n    TopBar.prototype.onGold = function () {\r\n        SoundManager.instance.playEffect(SoundConst.BtnClick);\r\n        EventMgr.getInstance().sendEvent(GameEvent.OPEN_BUY_PROP, { type: 2 });\r\n    };\r\n    TopBar.prototype.removeEvent = function () {\r\n        this.btn_power.off(Laya.Event.CLICK, this, this.onPower);\r\n        this.btn_gold.off(Laya.Event.CLICK, this, this.onGold);\r\n        EventMgr.getInstance().removeEvent(GameEvent.REFRESH_TOP, this, this.refresh);\r\n        EventMgr.getInstance().removeEvent(GameEvent.POWER_REPLY_STATUS, this, this.updataShow);\r\n        EventMgr.getInstance().removeEvent(GameEvent.ONSHOW, this, this.updatePower);\r\n    };\r\n    TopBar.prototype.onRemoved = function () {\r\n        _super.prototype.onRemoved.call(this);\r\n        this.removeEvent();\r\n    };\r\n    return TopBar;\r\n}(BaseSceneUISkin));\r\nexport { TopBar };\r\n",
  "references": [
    "E:/laya/project/laya_firePeople2_git_ts/src/script/manager/SoundManager.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/common/GameData.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/manager/PowerMgr.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/common/GameEvent.ts"
  ]
}
