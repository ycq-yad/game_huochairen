{
  "code": "import * as tslib_1 from \"tslib\";\r\nimport GameConfig from \"./GameConfig\";\r\nimport ViewMgr from \"./script/manager/ViewMgr\";\r\nimport { MiniManeger } from \"./script/minigame/MiniManeger\";\r\nimport SoundManager from \"./script/manager/SoundManager\";\r\nimport { GameData } from \"./script/common/GameData\";\r\nimport GameEvent from \"./script/common/GameEvent\";\r\nimport ConfigManager from \"./script/manager/ConfigManager\";\r\nimport GameMgr from \"./script/manager/GameMgr\";\r\nimport GameLoadingView from \"./script/loading/GameLoadingView\";\r\nimport GameInfoManager from \"./script/manager/GameInfoManager\";\r\nimport { MZGameMgr } from \"./script/minigame/MZGameMgr\";\r\nimport { TTGameMgr } from \"./script/minigame/TTGameMgr\";\r\nimport { QQGameMgr } from \"./script/minigame/QQGameMgr\";\r\nimport { WXGameMgr } from \"./script/minigame/WXGameMgr\";\r\nimport DYChannelMgr from \"./script/manager/channel/DYChannelMgr\";\r\nvar Main = (function (_super) {\r\n    tslib_1.__extends(Main, _super);\r\n    function Main() {\r\n        var _this = _super.call(this, { width: 1080, height: 1920, exportSceneToJson: true }) || this;\r\n        GameConfig.init();\r\n        if (MiniManeger.ins == null) {\r\n            if (DeviceUtil.isWXMiniGame()) {\r\n                MiniManeger.ins = new WXGameMgr();\r\n            }\r\n            else if (DeviceUtil.isTTMiniGame()) {\r\n                MiniManeger.ins = new TTGameMgr();\r\n            }\r\n            else if (DeviceUtil.isMZMiniGame()) {\r\n                MiniManeger.ins = new MZGameMgr();\r\n            }\r\n            else if (DeviceUtil.isQQMiniGame()) {\r\n                MiniManeger.ins = new QQGameMgr();\r\n            }\r\n            else {\r\n                MiniManeger.ins = new MiniManeger();\r\n            }\r\n        }\r\n        _this.checkPlatform();\r\n        var onShow = function (obj) {\r\n            console.log(\"onShow obj = \", obj);\r\n            SoundManager.instance.playBgMusic();\r\n        };\r\n        var onHide = function (obj) {\r\n            console.log(\"onHide obj = \", obj);\r\n            SoundManager.instance.pauseBgMusic();\r\n        };\r\n        var onAudioInterruptionBegin = function (res) {\r\n            console.log(\"onAudioInterruptionBegin\");\r\n        };\r\n        var onAudioInterruptionEnd = function (res) {\r\n            console.log(\"onAudioInterruptionEnd\");\r\n        };\r\n        if (DeviceUtil.isMZMiniGame()) {\r\n            MiniManeger.instance.onShow(onShow);\r\n            MiniManeger.instance.onHide(onHide);\r\n            MiniManeger.instance.initMiniGame();\r\n        }\r\n        else if (DeviceUtil.isMiniGame()) {\r\n            MiniManeger.instance.onShow(onShow);\r\n            MiniManeger.instance.onHide(onHide);\r\n            MiniManeger.instance.onAudioInterruptionBegin(onAudioInterruptionBegin);\r\n            MiniManeger.instance.onAudioInterruptionEnd(onAudioInterruptionEnd);\r\n            MiniManeger.instance.initMiniGame();\r\n        }\r\n        else {\r\n            Laya.stage.on(Laya.Event.FOCUS, _this, function () {\r\n                console.log(\"获取焦点\");\r\n                onShow(null);\r\n                EventMgr.getInstance().sendEvent(GameEvent.ONSHOW);\r\n            });\r\n            Laya.stage.on(Laya.Event.BLUR, _this, function () {\r\n                console.log(\"失去焦点\");\r\n                onHide(null);\r\n                EventMgr.getInstance().sendEvent(GameEvent.ONHIDE);\r\n            });\r\n        }\r\n        return _this;\r\n    }\r\n    Main.prototype.checkPlatform = function () {\r\n        console.log(\"检验平台---\");\r\n        var self = this;\r\n        if (window[\"loadingH5\"]) {\r\n            window[\"loadingH5\"](100);\r\n        }\r\n        if (window[\"loadingView\"]) {\r\n            window[\"loadingView\"].loading(100);\r\n        }\r\n        var resUrl = \"./\";\r\n        GameData.getInstance().gameVersion = 1001;\r\n        if (DeviceUtil.isWXMiniGame()) {\r\n            GameData.getInstance().gameVersion = 1001;\r\n            GameData.getInstance().resVersion = '1_9/';\r\n            GameData.getInstance().MinigameResUrlRoot += \"wx_res/\";\r\n            GameData.getInstance().MinigameResAllUrl = GameData.getInstance().MinigameResUrlRoot + \"wx_res_v_z_\" + GameData.getInstance().resVersion;\r\n            resUrl = GameData.getInstance().MinigameResAllUrl;\r\n            ResUtil.getIntance().defaultOriginUrl = resUrl;\r\n            ResUtil.getIntance().addVersionPrefix(resUrl);\r\n        }\r\n        else if (DeviceUtil.isTTMiniGame()) {\r\n            GameData.getInstance().gameVersion = 1001;\r\n            GameData.getInstance().resVersion = '1_3/';\r\n            GameData.getInstance().MinigameResUrlRoot += \"tt_res/\";\r\n            GameData.getInstance().MinigameResAllUrl = GameData.getInstance().MinigameResUrlRoot + \"tt_res_v_z_\" + GameData.getInstance().resVersion;\r\n            resUrl = GameData.getInstance().MinigameResAllUrl;\r\n            ResUtil.getIntance().defaultOriginUrl = resUrl;\r\n            ResUtil.getIntance().addVersionPrefix(resUrl);\r\n        }\r\n        else if (DeviceUtil.isMZMiniGame()) {\r\n            GameData.getInstance().gameVersion = 1001;\r\n            GameData.getInstance().resVersion = '1_4/';\r\n            GameData.getInstance().MinigameResUrlRoot += \"mz_res/\";\r\n            GameData.getInstance().MinigameResAllUrl = GameData.getInstance().MinigameResUrlRoot + \"mz_res_v_z_\" + GameData.getInstance().resVersion;\r\n            resUrl = GameData.getInstance().MinigameResAllUrl;\r\n            ResUtil.getIntance().defaultOriginUrl = resUrl;\r\n            ResUtil.getIntance().addVersionPrefix(resUrl);\r\n        }\r\n        else if (DeviceUtil.isQQMiniGame()) {\r\n            GameData.getInstance().gameVersion = 1001;\r\n            GameData.getInstance().resVersion = '1_3/';\r\n            GameData.getInstance().MinigameResUrlRoot += \"qq_res/\";\r\n            GameData.getInstance().MinigameResAllUrl = GameData.getInstance().MinigameResUrlRoot + \"qq_res_v_z_\" + GameData.getInstance().resVersion;\r\n            resUrl = GameData.getInstance().MinigameResAllUrl;\r\n            ResUtil.getIntance().defaultOriginUrl = resUrl;\r\n            ResUtil.getIntance().addVersionPrefix(resUrl);\r\n        }\r\n        else {\r\n        }\r\n        self.initDebug();\r\n        self.loadPreLoadRes(resUrl + 'configs/');\r\n    };\r\n    Main.prototype.loadPreLoadRes = function (resUrl) {\r\n        var url = resUrl;\r\n        _super.prototype.initInfos.call(this, url + \"infos.json\" + ConfigManager.instance.randomVersion);\r\n    };\r\n    Main.prototype.enableFileConfig = function () {\r\n        var _this = this;\r\n        GameData.getInstance().initConfig(BaseConst.infos);\r\n        if (DeviceUtil.isTTMiniGame() || DeviceUtil.isQQMiniGame() || DeviceUtil.isWXMiniGame()) {\r\n            MiniManeger.instance.infos = BaseConst.infos[\"platformInfos\"];\r\n        }\r\n        Laya.AtlasInfoManager.enable(\"fileconfig.json\" + ConfigManager.instance.randomVersion, Laya.Handler.create(this, function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!DeviceUtil.isMiniGame()) return [3, 5];\r\n                        if (!DeviceUtil.isWXMiniGame()) return [3, 2];\r\n                        DYChannelMgr.instance.initConfig(BaseConst.infos[\"channelInfos\"]);\r\n                        return [4, DYChannelMgr.instance.loginGame()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [3, 4];\r\n                    case 2: return [4, MiniManeger.instance.loginGame()];\r\n                    case 3:\r\n                        _a.sent();\r\n                        _a.label = 4;\r\n                    case 4:\r\n                        console.log(\"用户信息 : \", GameData.getInstance().userInfo);\r\n                        this.loadRes();\r\n                        return [3, 6];\r\n                    case 5:\r\n                        this.loadRes();\r\n                        _a.label = 6;\r\n                    case 6: return [2];\r\n                }\r\n            });\r\n        }); }));\r\n    };\r\n    Main.prototype.loadRes = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var strogeVersion, openId, resUrl, resArr;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        strogeVersion = Laya.LocalStorage.getItem('strogeVersion');\r\n                        if (GameData.getInstance().strogeVersion != strogeVersion) {\r\n                            Laya.LocalStorage.clear();\r\n                        }\r\n                        Laya.LocalStorage.setItem('strogeVersion', GameData.getInstance().strogeVersion);\r\n                        if (!GameData.getInstance().userInfo.openId) {\r\n                            openId = Laya.LocalStorage.getItem(\"openId\");\r\n                            if (openId) {\r\n                                GameData.getInstance().userInfo.openId = openId;\r\n                            }\r\n                            else {\r\n                                openId = \"fire2\" + Utils.getRandom(10000, 99999);\r\n                                GameData.getInstance().userInfo.openId = openId;\r\n                                Laya.LocalStorage.setItem(\"openId\", openId);\r\n                            }\r\n                            if (!GameData.getInstance().userInfo.nick)\r\n                                GameData.getInstance().userInfo.nick = openId;\r\n                        }\r\n                        ViewMgr.instance.loadingView = new GameLoadingView();\r\n                        SceneManager.getInstance().openSceneInstance(ViewMgr.instance.loadingView);\r\n                        if (!DeviceUtil.isMZMiniGame()) {\r\n                            MiniManeger.instance.showBannerAd(null);\r\n                            MiniManeger.instance.hideBanner();\r\n                        }\r\n                        resUrl = \"\";\r\n                        if (DeviceUtil.isMiniGame()) {\r\n                            resUrl = GameData.getInstance().MinigameResAllUrl;\r\n                        }\r\n                        console.log(\"loadRes---\", resUrl);\r\n                        return [4, ResUtil.getIntance().loadThms(resUrl + \"resource/default.thm.json\" + ConfigManager.instance.randomVersion)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4, ResUtil.getIntance().loadRESConfig(resUrl + \"resource/default.res.json\" + ConfigManager.instance.randomVersion)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        ViewMgr.instance.registerBufferLoading();\r\n                        return [4, ConfigManager.instance.initConfigs()];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [4, GameInfoManager.getInstance().selectAllGameInfo()];\r\n                    case 4:\r\n                        _a.sent();\r\n                        return [4, GameMgr.instance.initData()];\r\n                    case 5:\r\n                        _a.sent();\r\n                        if (GameData.getInstance().isTestVersion) {\r\n                            GameData.getInstance().level = { \"103\": { passLv: 50, curLv: 50 } };\r\n                        }\r\n                        resArr = [\"panel\", \"public\"];\r\n                        this.enterHome(resArr);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Main.prototype.enterHome = function (resArr) {\r\n        var _this = this;\r\n        console.log(\"enterHome\", Laya.stage.width, Laya.stage.height, Laya.Browser.width, Laya.Browser.height);\r\n        resArr.push(\"home\");\r\n        ResUtil.getIntance().loadGroups(resArr, function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {\r\n            return tslib_1.__generator(this, function (_a) {\r\n                console.log(\"res load completed!!!\");\r\n                ViewMgr.instance.loadingView.showAnimation();\r\n                return [2];\r\n            });\r\n        }); }, function (index, len) {\r\n            ViewMgr.instance.loadingView.progress(index, len);\r\n        });\r\n    };\r\n    return Main;\r\n}(BaseContent));\r\nnew Main();\r\n",
  "references": [
    "E:/laya/project/laya_firePeople2_git_ts/src/GameConfig.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/manager/ViewMgr.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/minigame/MiniManeger.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/manager/SoundManager.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/common/GameData.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/common/GameEvent.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/manager/ConfigManager.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/manager/GameMgr.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/loading/GameLoadingView.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/manager/GameInfoManager.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/minigame/MZGameMgr.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/minigame/TTGameMgr.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/minigame/QQGameMgr.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/minigame/WXGameMgr.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/manager/channel/DYChannelMgr.ts"
  ]
}
