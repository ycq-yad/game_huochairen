{
  "code": "import * as tslib_1 from \"tslib\";\r\nimport { PopBaseScene } from \"../../PopBaseScene\";\r\nimport { GameData } from \"../../../common/GameData\";\r\nimport SoundManager, { SoundConst } from \"../../../manager/SoundManager\";\r\nimport { MiniManeger } from \"../../../minigame/MiniManeger\";\r\nimport GameMgr, { Prop } from \"../../../manager/GameMgr\";\r\nimport GameEvent from \"../../../common/GameEvent\";\r\nimport PatternMgr from \"../../../manager/PatternMgr\";\r\nimport AnimationManager from \"../../../manager/AnimationManager\";\r\nimport PowerMgr from \"../../../manager/PowerMgr\";\r\nvar SettlementScene2 = (function (_super) {\r\n    tslib_1.__extends(SettlementScene2, _super);\r\n    function SettlementScene2(data) {\r\n        var _this = _super.call(this) || this;\r\n        _this.className_key = \"SettlementScene2\";\r\n        _this.showEnterType = null;\r\n        _this.viewData_ = data;\r\n        _this.skin = \"skins/game/type2/SettlementView2.json\";\r\n        return _this;\r\n    }\r\n    SettlementScene2.prototype.removeEvent = function () {\r\n        this.btn_home.off(Laya.Event.CLICK, this, this.onHomeUglify);\r\n        this.box_double.off(Laya.Event.CLICK, this, this.onSelect);\r\n        this.btn_restart.off(Laya.Event.CLICK, this, this.onRestartUglify);\r\n        this.btn_get.off(Laya.Event.CLICK, this, this.onGetUglify);\r\n        this.btn_shareVideo.off(Laya.Event.CLICK, this, this.onShareVideo);\r\n        this.btn_next.off(Laya.Event.CLICK, this, this.onNextUglify);\r\n        if (DeviceUtil.isQQMiniGame())\r\n            this.btn_moreGame.off(Laya.Event.CLICK, this, this.onMoreGame);\r\n    };\r\n    SettlementScene2.prototype.onRemoved = function () {\r\n        _super.prototype.onRemoved.call(this);\r\n        this.removeEvent();\r\n        EventMgr.getInstance().sendEvent(GameEvent.HIDE_TOP);\r\n        this.viewData_ = null;\r\n    };\r\n    SettlementScene2.prototype.initView = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var data, _a;\r\n            var _this = this;\r\n            return tslib_1.__generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        this.hideBanner();\r\n                        EventMgr.getInstance().sendEvent(GameEvent.SHOW_TOP);\r\n                        EventMgr.getInstance().sendEvent(GameEvent.CHANGE_POS, { _x: 30, _y: 30 });\r\n                        SoundManager.instance.playEffect(SoundConst.Win2);\r\n                        if (!this.viewData_)\r\n                            return [2];\r\n                        data = this.viewData_;\r\n                        this.btn_get.visible = true;\r\n                        if (DeviceUtil.isQQMiniGame())\r\n                            this.btn_moreGame.visible = false;\r\n                        this.btn_restart.visible = this.btn_next.visible = false;\r\n                        this.lab_award.text = \"+\" + GameData.getInstance().defaultConfigs.passGold2;\r\n                        if (DeviceUtil.isTTMiniGame()) {\r\n                            this.btn_shareVideo.visible = true;\r\n                            this.btn_shareVideo.disabled = false;\r\n                            this.btn_shareVideo.getChildByName(\"num\").text = \"+\" + GameData.getInstance().defaultConfigs.shareRecordAward;\r\n                            this.btn_get.centerX = -220;\r\n                        }\r\n                        else {\r\n                            this.btn_shareVideo.visible = false;\r\n                            this.btn_get.centerX = 0;\r\n                        }\r\n                        if (GameData.getInstance().isConVersion || !GameData.getInstance().videoOpen) {\r\n                            this.showDouble(false);\r\n                            this.box_double.visible = false;\r\n                        }\r\n                        else {\r\n                            this.box_double.visible = true;\r\n                            this.showDouble(GameData.getInstance().selectDoule);\r\n                        }\r\n                        _a = this;\r\n                        return [4, PatternMgr.instance.updateLevelUglify({ pattern: 103, curLv: data.level })];\r\n                    case 1:\r\n                        _a.nextId = _b.sent();\r\n                        if (!(DeviceUtil.isMZMiniGame() && GameData.getInstance().touchByMistake)) return [3, 3];\r\n                        this.box_double.y = 46;\r\n                        this.box_bottom.bottom = 150;\r\n                        return [4, MiniManeger.instance.createBanner()];\r\n                    case 2:\r\n                        _b.sent();\r\n                        Laya.timer.once(1000, this, function () {\r\n                            MiniManeger.instance.showBannerAdSp();\r\n                            Laya.Tween.to(_this.box_bottom, { bottom: 400 }, 500);\r\n                        });\r\n                        return [3, 4];\r\n                    case 3:\r\n                        if ((DeviceUtil.isQQMiniGame() || DeviceUtil.isTTMiniGame()) &&\r\n                            GameData.getInstance().touchByMistake) {\r\n                            this.box_double.y = 46;\r\n                            this.box_bottom.bottom = 150;\r\n                            Laya.timer.once(1500, this, function () {\r\n                                _this.showBanner();\r\n                                Laya.Tween.to(_this.box_bottom, { bottom: 400 }, 500);\r\n                            });\r\n                        }\r\n                        else {\r\n                            this.box_double.y = 0;\r\n                            this.box_bottom.bottom = 400;\r\n                            this.showBanner();\r\n                        }\r\n                        _b.label = 4;\r\n                    case 4:\r\n                        this.showLevelAniUglify();\r\n                        this.showAniUglify();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SettlementScene2.prototype.showLevelAniUglify = function () {\r\n        var _this = this;\r\n        var lv = this.nextId;\r\n        if (this.viewData_.level == lv) {\r\n            this.lab_tip.visible = true;\r\n            this.box_lvAni.visible = false;\r\n        }\r\n        else {\r\n            this.lab_tip.visible = false;\r\n            var url = \"resource/assets/imgs/levels/type2/\" + lv + \"/level\" + lv + \".sk\";\r\n            if (!this.levelSke) {\r\n                this.levelSke = new Laya.Skeleton();\r\n                this.box_lvAni.addChild(this.levelSke);\r\n            }\r\n            this.levelSke.load(url, Laya.Handler.create(this, function () {\r\n                if (!_this.levelSke.player)\r\n                    return;\r\n                _this.levelSke.player.playbackRate = 1;\r\n                _this.levelSke.scale(1, 1);\r\n                _this.levelSke.pos(390, 350);\r\n                _this.box_lvAni.visible = true;\r\n                _this.levelSke.play(0, true);\r\n            }));\r\n        }\r\n    };\r\n    SettlementScene2.prototype.showAniUglify = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var _a;\r\n            var _this = this;\r\n            return tslib_1.__generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        if (!!this.succSke) return [3, 2];\r\n                        _a = this;\r\n                        return [4, AnimationManager.instance.creatBoonAnimation(\"resource/assets/db/victory1.sk\")];\r\n                    case 1:\r\n                        _a.succSke = _b.sent();\r\n                        this.box_ani.addChild(this.succSke);\r\n                        this.succSke.scale(2, 2);\r\n                        this.succSke.pos(540, 400);\r\n                        _b.label = 2;\r\n                    case 2:\r\n                        this.box_ani.visible = true;\r\n                        this.succSke.player.once(Laya.Event.STOPPED, this, function () {\r\n                            _this.box_ani.visible = false;\r\n                        });\r\n                        this.succSke.play(0, false);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SettlementScene2.prototype.onHomeUglify = function () {\r\n        SoundManager.instance.playEffect(SoundConst.BtnClick);\r\n        EventMgr.getInstance().sendEvent(GameEvent.OPEN_SCENE, { name: \"HomeScene\" });\r\n        this.removeSelf();\r\n    };\r\n    SettlementScene2.prototype.onSelect = function () {\r\n        SoundManager.instance.playEffect(SoundConst.BtnClick);\r\n        if (this.img_select.visible) {\r\n            this.showDouble(false);\r\n        }\r\n        else {\r\n            this.showDouble(true);\r\n        }\r\n    };\r\n    SettlementScene2.prototype.showDouble = function (show) {\r\n        this.img_select.visible = show;\r\n        var mult = show ? 2 : 1;\r\n        this.lab_award.text = \"+\" + GameData.getInstance().defaultConfigs.passGold1 * mult;\r\n    };\r\n    SettlementScene2.prototype.onGetUglify = function () {\r\n        var _this = this;\r\n        SoundManager.instance.playEffect(SoundConst.BtnClick);\r\n        if (this.img_select.visible) {\r\n            this.enableView(false);\r\n            MiniManeger.instance.playViderAd({\r\n                successFun: function () {\r\n                    _this.getAwardUglify(2);\r\n                    _this.enableView(true);\r\n                },\r\n                failFun: function () {\r\n                    _this.enableView(true);\r\n                },\r\n                errorFun: function () {\r\n                    _this.enableView(true);\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            this.getAwardUglify(1);\r\n        }\r\n    };\r\n    SettlementScene2.prototype.getAwardUglify = function (mult) {\r\n        GameMgr.instance.updateBaseData(Prop.Gold, GameData.getInstance().defaultConfigs.passGold1 * mult);\r\n        this.btn_get.visible = this.box_double.visible = false;\r\n        this.btn_shareVideo.visible = false;\r\n        if (DeviceUtil.isQQMiniGame())\r\n            this.btn_moreGame.visible = true;\r\n        this.btn_restart.visible = this.btn_next.visible = true;\r\n    };\r\n    SettlementScene2.prototype.onRestartUglify = function () {\r\n        var _this = this;\r\n        SoundManager.instance.playEffect(SoundConst.BtnClick);\r\n        if (DeviceUtil.isMZMiniGame() || DeviceUtil.isTTMiniGame()) {\r\n            this.enableView(false);\r\n            MiniManeger.instance.showInsertAd({\r\n                successFun: function () {\r\n                },\r\n                closeFun: function () {\r\n                    _this.enableView(true);\r\n                    _this.restartFun();\r\n                },\r\n                errorFun: function () {\r\n                    _this.enableView(true);\r\n                    _this.restartFun();\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            this.restartFun();\r\n        }\r\n    };\r\n    SettlementScene2.prototype.restartFun = function () {\r\n        var _this = this;\r\n        PowerMgr.instance.changePowerUglify({\r\n            count: -GameData.getInstance().defaultConfigs.powerCost,\r\n            success: function () {\r\n                EventMgr.getInstance().sendEvent(GameEvent.Type2Restart);\r\n                EventMgr.getInstance().sendEvent(GameEvent.HIDE_TOP);\r\n                _this.removeSelf();\r\n            }\r\n        });\r\n    };\r\n    SettlementScene2.prototype.onShareVideo = function () {\r\n        var _this = this;\r\n        SoundManager.instance.playEffect(SoundConst.BtnClick);\r\n        this.enableView(false);\r\n        MiniManeger.instance.shareGameVideo({\r\n            successFun: function () {\r\n                GameData.getInstance().playerData.shareVideoCount += 1;\r\n                GameMgr.instance.updateBaseData(Prop.Gold, GameData.getInstance().defaultConfigs.shareRecordAward);\r\n                _this.btn_shareVideo.disabled = true;\r\n                _this.enableView(true);\r\n            },\r\n            failFun: function () {\r\n                _this.enableView(true);\r\n            },\r\n            errorFun: function () {\r\n                _this.enableView(true);\r\n            }\r\n        });\r\n    };\r\n    SettlementScene2.prototype.onNextUglify = function () {\r\n        var _this = this;\r\n        SoundManager.instance.playEffect(SoundConst.BtnClick);\r\n        if (DeviceUtil.isMZMiniGame() || DeviceUtil.isTTMiniGame()) {\r\n            this.enableView(false);\r\n            MiniManeger.instance.showInsertAd({\r\n                successFun: function () {\r\n                },\r\n                closeFun: function () {\r\n                    _this.enableView(true);\r\n                    _this.nextFun();\r\n                },\r\n                errorFun: function () {\r\n                    _this.enableView(true);\r\n                    _this.nextFun();\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            this.nextFun();\r\n        }\r\n    };\r\n    SettlementScene2.prototype.nextFun = function () {\r\n        var _this = this;\r\n        PowerMgr.instance.changePowerUglify({\r\n            count: -GameData.getInstance().defaultConfigs.powerCost,\r\n            success: function () {\r\n                EventMgr.getInstance().sendEvent(GameEvent.Type2Next, { level: _this.nextId });\r\n                _this.removeSelf();\r\n            }\r\n        });\r\n    };\r\n    SettlementScene2.prototype.onMoreGame = function () {\r\n        SoundManager.instance.playEffect(SoundConst.BtnClick);\r\n        MiniManeger.instance.showAppBoxAd({});\r\n    };\r\n    SettlementScene2.prototype.childrenCreated = function () {\r\n        _super.prototype.childrenCreated.call(this);\r\n        DeviceUtil.adaptationBgImg(this.img_bg);\r\n        this.box_lvAni.scrollRect = new Laya.Rectangle(0, 0, 770, 650);\r\n    };\r\n    SettlementScene2.prototype.addEvent = function () {\r\n        this.btn_home.on(Laya.Event.CLICK, this, this.onHomeUglify);\r\n        this.box_double.on(Laya.Event.CLICK, this, this.onSelect);\r\n        this.btn_restart.on(Laya.Event.CLICK, this, this.onRestartUglify);\r\n        this.btn_get.on(Laya.Event.CLICK, this, this.onGetUglify);\r\n        this.btn_shareVideo.on(Laya.Event.CLICK, this, this.onShareVideo);\r\n        this.btn_next.on(Laya.Event.CLICK, this, this.onNextUglify);\r\n        if (DeviceUtil.isQQMiniGame())\r\n            this.btn_moreGame.on(Laya.Event.CLICK, this, this.onMoreGame);\r\n    };\r\n    return SettlementScene2;\r\n}(PopBaseScene));\r\nexport { SettlementScene2 };\r\n",
  "references": [
    "E:/laya/project/laya_firePeople2_git_ts/src/script/views/PopBaseScene.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/common/GameData.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/manager/SoundManager.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/minigame/MiniManeger.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/manager/GameMgr.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/common/GameEvent.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/manager/PatternMgr.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/manager/AnimationManager.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/manager/PowerMgr.ts"
  ]
}
