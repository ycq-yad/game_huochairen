{
  "code": "import * as tslib_1 from \"tslib\";\r\nimport { PopBaseScene } from \"../../../PopBaseScene\";\r\nimport GameEvent from \"../../../../common/GameEvent\";\r\nimport ChooseItem2 from \"./ChooseItem2\";\r\nimport SoundManager, { SoundConst } from \"../../../../manager/SoundManager\";\r\nimport PatternMgr from \"../../../../manager/PatternMgr\";\r\nimport { BrushScene } from \"../brush/BrushScene\";\r\nimport PowerMgr from \"../../../../manager/PowerMgr\";\r\nimport { GameData } from \"../../../../common/GameData\";\r\nimport { MiniManeger } from \"../../../../minigame/MiniManeger\";\r\nvar ChooseScene2 = (function (_super) {\r\n    tslib_1.__extends(ChooseScene2, _super);\r\n    function ChooseScene2() {\r\n        var _this = _super.call(this) || this;\r\n        _this.className_key = \"ChooseScene2\";\r\n        _this.showEnterType = null;\r\n        _this.curPage = 1;\r\n        _this.maxPage = 3;\r\n        _this.isPlaying = false;\r\n        _this.distance = 975 + 20;\r\n        _this.skin = \"skins/game/type2/choose/ChooseView2.json\";\r\n        return _this;\r\n    }\r\n    ChooseScene2.prototype.removeEvent = function () {\r\n        this.btn_last.off(Laya.Event.CLICK, this, this.onLast);\r\n        this.btn_next.off(Laya.Event.CLICK, this, this.onNext);\r\n        this.btn_close.off(Laya.Event.CLICK, this, this.onCloseUglify);\r\n        this.btn_skin.off(Laya.Event.CLICK, this, this.onSkinUglify);\r\n        this.box_level.off(Laya.Event.MOUSE_DOWN, this, this.mouseDownUglify);\r\n        this.box_level.off(Laya.Event.MOUSE_UP, this, this.mouseUpUglify);\r\n        this.box_level.off(Laya.Event.MOUSE_OUT, this, this.mouseUpUglify);\r\n        EventMgr.getInstance().removeEvent(GameEvent.Type2Select, this, this.enterGameUglify);\r\n    };\r\n    ChooseScene2.prototype.onRemoved = function () {\r\n        _super.prototype.onRemoved.call(this);\r\n        this.removeEvent();\r\n        this.levelData = null;\r\n    };\r\n    ChooseScene2.prototype.showInsertAd = function () {\r\n        MiniManeger.instance.showInsertAd({\r\n            successFun: function () {\r\n            },\r\n            closeFun: function () {\r\n            },\r\n            errorFun: function () {\r\n            }\r\n        });\r\n    };\r\n    ChooseScene2.prototype.refreshUIUglify = function () {\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var _a, i, box_1, start, dataArr, box, i, len, data, item;\r\n            return tslib_1.__generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        if (!!this.levelData) return [3, 2];\r\n                        _a = this;\r\n                        return [4, PatternMgr.instance.getLevelData2Uglify()];\r\n                    case 1:\r\n                        _a.levelData = _b.sent();\r\n                        this.maxPage = Math.ceil(this.levelData.length / 10);\r\n                        for (i = 0; i < this.maxPage; i++) {\r\n                            box_1 = this.box_level.getChildAt(i);\r\n                            if (!box_1) {\r\n                                box_1 = new Laya.Box();\r\n                                box_1.size(975, 397);\r\n                                box_1.x = (975 + 20) * i;\r\n                                this.box_level.addChild(box_1);\r\n                            }\r\n                        }\r\n                        _b.label = 2;\r\n                    case 2:\r\n                        start = (this.curPage - 1) * 10;\r\n                        dataArr = this.levelData.slice(start, start + 10);\r\n                        box = this.box_level.getChildAt(this.curPage - 1);\r\n                        for (i = 0, len = dataArr.length; i < len; i++) {\r\n                            data = dataArr[i];\r\n                            item = box.getChildAt(i);\r\n                            if (item) {\r\n                                item.setData(data);\r\n                            }\r\n                            else {\r\n                                item = new ChooseItem2(data);\r\n                                item.x = (i % 5) * (179 + 20);\r\n                                item.y = Math.floor(i / 5) * (180 + 37);\r\n                                box.addChild(item);\r\n                            }\r\n                        }\r\n                        this.refreshBtnUglify();\r\n                        this.showLevelAniUglify();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ChooseScene2.prototype.refreshBtnUglify = function () {\r\n        this.btn_last.disabled = this.curPage == 1;\r\n        this.btn_next.disabled = this.curPage == this.maxPage;\r\n    };\r\n    ChooseScene2.prototype.showLevelAniUglify = function () {\r\n        var _this = this;\r\n        var lv = 1 + 10 * (this.curPage - 1);\r\n        var url = \"resource/assets/imgs/levels/type2/\" + lv + \"/level\" + lv + \".sk\";\r\n        if (!this.levelSke) {\r\n            this.levelSke = new Laya.Skeleton();\r\n            this.box_ani.addChild(this.levelSke);\r\n        }\r\n        this.levelSke.load(url, Laya.Handler.create(this, function () {\r\n            if (!_this.levelSke.player)\r\n                return;\r\n            _this.levelSke.player.playbackRate = 1;\r\n            _this.levelSke.scale(1, 1);\r\n            _this.levelSke.pos(390, 330);\r\n            _this.box_ani.visible = true;\r\n            _this.levelSke.play(0, true);\r\n        }));\r\n    };\r\n    ChooseScene2.prototype.onLast = function () {\r\n        SoundManager.instance.playEffect(SoundConst.BtnClick);\r\n        this.listAni(1);\r\n    };\r\n    ChooseScene2.prototype.onNext = function () {\r\n        SoundManager.instance.playEffect(SoundConst.BtnClick);\r\n        this.listAni(-1);\r\n    };\r\n    ChooseScene2.prototype.onCloseUglify = function () {\r\n        SoundManager.instance.playEffect(SoundConst.BtnClick);\r\n        this.removeSelf();\r\n    };\r\n    ChooseScene2.prototype.onSkinUglify = function () {\r\n        SoundManager.instance.playEffect(SoundConst.BtnClick);\r\n        EventMgr.getInstance().sendEvent(GameEvent.BUFFER_LOAD, true);\r\n        ResUtil.getIntance().loadGroups([\"skin2\"], function () {\r\n            EventMgr.getInstance().sendEvent(GameEvent.BUFFER_LOAD, false);\r\n            ViewManager.getInstance().showView(BrushScene, { type: 1 });\r\n        });\r\n    };\r\n    ChooseScene2.prototype.mouseDownUglify = function (evt) {\r\n        if (this.isPlaying || this.maxPage == 1)\r\n            return;\r\n        this.box_level.on(Laya.Event.MOUSE_UP, this, this.mouseUpUglify);\r\n        this.box_level.on(Laya.Event.MOUSE_OUT, this, this.mouseUpUglify);\r\n        this.startX = evt.stageX;\r\n    };\r\n    ChooseScene2.prototype.mouseUpUglify = function (evt) {\r\n        if (this.isPlaying || !this.startX)\r\n            return;\r\n        this.box_level.off(Laya.Event.MOUSE_UP, this, this.mouseUpUglify);\r\n        this.box_level.off(Laya.Event.MOUSE_OUT, this, this.mouseUpUglify);\r\n        var a = evt.stageX - this.startX;\r\n        this.startX = null;\r\n        if (a > 0 && Math.abs(a) >= 100) {\r\n            if (this.curPage == 1)\r\n                return;\r\n            this.listAni(1);\r\n        }\r\n        else if (a < 0 && Math.abs(a) >= 100) {\r\n            if (this.curPage == this.maxPage)\r\n                return;\r\n            this.listAni(-1);\r\n        }\r\n    };\r\n    ChooseScene2.prototype.listAni = function (direction, time) {\r\n        if (time === void 0) { time = 300; }\r\n        return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return tslib_1.__generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.isPlaying = true;\r\n                        this.enableView(false);\r\n                        this.curPage += direction * -1;\r\n                        return [4, this.refreshUIUglify()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4, Promise.all(Array.apply(void 0, Array(this.maxPage)).map(function (v, i) {\r\n                                return _this.singleAni(i, direction, time);\r\n                            }))];\r\n                    case 2:\r\n                        _a.sent();\r\n                        this.isPlaying = false;\r\n                        this.enableView(true);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ChooseScene2.prototype.singleAni = function (index, direction, time) {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            var item = _this.box_level.getChildAt(index);\r\n            var pos = { x: item.x + _this.distance * direction };\r\n            Laya.Tween.to(item, pos, time, null, Laya.Handler.create(_this, function () {\r\n                resolve();\r\n            }));\r\n        });\r\n    };\r\n    ChooseScene2.prototype.enterGameUglify = function (data) {\r\n        var _this = this;\r\n        PowerMgr.instance.changePowerUglify({\r\n            count: -GameData.getInstance().defaultConfigs.powerCost,\r\n            success: function () {\r\n                EventMgr.getInstance().sendEvent(GameEvent.BUFFER_LOAD, true);\r\n                ResUtil.getIntance().loadGroups([\"game2\", \"skin2\"], function () {\r\n                    EventMgr.getInstance().sendEvent(GameEvent.BUFFER_LOAD, false);\r\n                    EventMgr.getInstance().sendEvent(GameEvent.OPEN_SCENE, { name: \"GameSceneType2\", data: { level: data } });\r\n                    _this.removeSelf();\r\n                });\r\n            }\r\n        });\r\n    };\r\n    ChooseScene2.prototype.childrenCreated = function () {\r\n        _super.prototype.childrenCreated.call(this);\r\n        DeviceUtil.adaptationBgImg(this.img_bg);\r\n        this.box_level.scrollRect = new Laya.Rectangle(0, 0, 975, 397);\r\n        this.box_ani.scrollRect = new Laya.Rectangle(0, 0, 770, 650);\r\n    };\r\n    ChooseScene2.prototype.addEvent = function () {\r\n        this.btn_last.on(Laya.Event.CLICK, this, this.onLast);\r\n        this.btn_next.on(Laya.Event.CLICK, this, this.onNext);\r\n        this.btn_close.on(Laya.Event.CLICK, this, this.onCloseUglify);\r\n        this.btn_skin.on(Laya.Event.CLICK, this, this.onSkinUglify);\r\n        EventMgr.getInstance().addEvent(GameEvent.Type2Select, this, this.enterGameUglify);\r\n    };\r\n    ChooseScene2.prototype.initView = function () {\r\n        if (DeviceUtil.isMZMiniGame() || DeviceUtil.isTTMiniGame())\r\n            this.showInsertAd();\r\n        if (GameData.getInstance().isConVersion) {\r\n            this.btn_skin.visible = false;\r\n        }\r\n        this.refreshUIUglify();\r\n    };\r\n    return ChooseScene2;\r\n}(PopBaseScene));\r\nexport { ChooseScene2 };\r\n",
  "references": [
    "E:/laya/project/laya_firePeople2_git_ts/src/script/views/PopBaseScene.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/common/GameDataType.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/common/GameEvent.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/views/games/type2/choose/ChooseItem2.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/manager/SoundManager.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/manager/PatternMgr.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/views/games/type2/brush/BrushScene.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/manager/PowerMgr.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/common/GameData.ts",
    "E:/laya/project/laya_firePeople2_git_ts/src/script/minigame/MiniManeger.ts"
  ]
}
